≥
7H:\AlphaMedic\AlphaMedic\Rest\App_Start\Startup.Auth.cs
	namespace 	
Rest
 
{ 
public 

partial 
class 
Startup  
{ 
private 
void 
ConfigureAuth "
(" #
IAppBuilder# .
app/ 2
)2 3
{ 	
var 
issuer 
= 
$str 1
;1 2
var 
secret 
= 
TextEncodings &
.& '
	Base64Url' 0
.0 1
Decode1 7
(7 8 
ConfigurationManager $
.$ %
AppSettings% 0
[0 1
$str1 D
]D E
)E F
;F G
app"" 
."" 
UseCors"" 
("" 
	Microsoft"" !
.""! "
Owin""" &
.""& '
Cors""' +
.""+ ,
CorsOptions"", 7
.""7 8
AllowAll""8 @
)""@ A
;""A B
var$$ 
OAuthOptions$$ 
=$$ 
new$$ "+
OAuthAuthorizationServerOptions$$# B
{%% 
TokenEndpointPath&& !
=&&" #
new&&$ '

PathString&&( 2
(&&2 3
$str&&3 ;
)&&; <
,&&< =
Provider'' 
='' 
new'' *
ApplicationOAuthServerProvider'' =
(''= >
)''> ?
,''? @%
AccessTokenExpireTimeSpan(( )
=((* +
TimeSpan((, 4
.((4 5
FromDays((5 =
(((= >
$num((> @
)((@ A
,((A B
AccessTokenFormat** !
=**" #
new**$ '
CustomJwtFormat**( 7
(**7 8
issuer**8 >
)**> ?
,**? @
AllowInsecureHttp,, !
=,," #
true,,$ (
}-- 
;-- 
app.. 
... '
UseOAuthAuthorizationServer.. +
(..+ ,
OAuthOptions.., 8
)..8 9
;..9 :
app55 
.55 &
UseJwtBearerAuthentication55 *
(55* +
new66 *
JwtBearerAuthenticationOptions66 2
{77 
AuthenticationMode88 &
=88' (
AuthenticationMode88) ;
.88; <
Active88< B
,88B C
AllowedAudiences99 $
=99% &
new99' *
[99* +
]99+ ,
{99- . 
ConfigurationManager99/ C
.99C D
AppSettings99D O
[99O P
$str99P _
]99_ `
}99a b
,99b c(
IssuerSecurityTokenProviders:: 0
=::1 2
new::3 6(
IIssuerSecurityTokenProvider::7 S
[::S T
]::T U
{;; 
new<< 3
'SymmetricKeyIssuerSecurityTokenProvider<< B
(<<B C
issuer<<C I
,<<I J
secret<<K Q
)<<Q R
}== 
}>> 
)?? 
;?? 
}@@ 	
}AA 
}BB Ó
7H:\AlphaMedic\AlphaMedic\Rest\App_Start\WebApiConfig.cs
	namespace 	
Rest
 
{		 
public

 

static

 
class

 
WebApiConfig

 $
{ 
public 
static 
void 
Register #
(# $
HttpConfiguration$ 5
config6 <
)< =
{ 	
config 
. "
MapHttpAttributeRoutes )
() *
)* +
;+ ,
config 
. 
Routes 
. 
MapHttpRoute &
(& '
name 
: 
$str "
," #
routeTemplate 
: 
$str 6
,6 7
defaults 
: 
new 
{ 
id  "
=# $
RouteParameter% 3
.3 4
Optional4 <
}= >
) 
; 
} 	
} 
}   åæ
CH:\AlphaMedic\AlphaMedic\Rest\Controllers\AppointmentsController.cs
	namespace 	
Rest
 
. 
Controllers 
{ 
[ 
RoutePrefix 
( 
$str #
)# $
]$ %
public 

class "
AppointmentsController '
:( )
ApiController* 7
{ 
private 
readonly 
AlphaMedicContext *
db+ -
=. /
new0 3
AlphaMedicContext4 E
(E F
)F G
;G H
[ 	
Route	 
( 
$str 
) 
] 
[ 	
	Authorize	 
( 
Roles 
= 
Roles  
.  !
Receptionist! -
+. /
$str0 3
+4 5
Roles6 ;
.; <

AllDoctors< F
)F G
]G H
public 
IHttpActionResult  
GetAppointments! 0
(0 1
DateTime1 9
?9 :

periodFrom; E
,E F
DateTimeG O
?O P

periodTillQ [
,[ \
AppointmentState 
? 
state #
=$ %
null& *
,* +
int, /
page0 4
=5 6
$num7 8
,8 9
int: =
itemsPerPage> J
=K L
$numM O
,O P
intQ T
?T U
doctorV \
=] ^
null_ c
,c d
inte h
?h i

departmentj t
=u v
nullw {
){ |
{ 	
var 
list 
= 
db 
. 
Appointments &
.& '
Where' ,
(, -
x- .
=>. 0
x0 1
.1 2
State2 7
!=7 9
AppointmentState9 I
.I J
FinishedJ R
)R S
.S T
ToArrayT [
([ \
)\ ]
;] ^
if 
( 
doctor 
!= 
null 
) 
{   
list!! 
=!! 
list!! 
.!! 
Where!! !
(!!! "
x!!" #
=>!!$ &
x!!' (
.!!( )
DoctorId!!) 1
==!!2 4
doctor!!5 ;
)!!; <
.!!< =
ToArray!!= D
(!!D E
)!!E F
;!!F G
}"" 
if$$ 
($$ 

department$$ 
!=$$ 
null$$ "
)$$" #
{%% 
list&& 
=&& 
list&& 
.&& 
Where&& !
(&&! "
x&&" #
=>&&$ &
x&&' (
.&&( )
Doctor&&) /
!=&&0 2
null&&3 7
&&&&8 :
x&&; <
.&&< =
Doctor&&= C
.&&C D
DepartmentId&&D P
==&&Q S

department&&T ^
)&&^ _
.&&_ `
ToArray&&` g
(&&g h
)&&h i
;&&i j
}'' 
if)) 
()) 

periodFrom)) 
!=)) 
null)) "
&&))# %

periodTill))& 0
!=))1 3
null))4 8
)))8 9
{** 
list++ 
=++ 
list++ 
.++ 
Where++ !
(++! "
x++" #
=>++$ &
x++' (
.++( )
Date++) -
>=++. 0

periodFrom++1 ;
&&++< >
x++? @
.++@ A
Date++A E
<=++F H

periodTill++I S
)++S T
.++T U
ToArray++U \
(++\ ]
)++] ^
;++^ _
},, 
if.. 
(.. 

periodFrom.. 
!=.. 
null.. "
).." #
{// 
list00 
=00 
list00 
.00 
Where00 !
(00! "
x00" #
=>00$ &
x00' (
.00( )
Date00) -
>=00. 0

periodFrom001 ;
)00; <
.00< =
ToArray00= D
(00D E
)00E F
;00F G
}11 
if33 
(33 

periodTill33 
!=33 
null33 "
)33" #
{44 
list55 
=55 
list55 
.55 
Where55 !
(55! "
x55" #
=>55$ &
x55' (
.55( )
Date55) -
<=55. 0

periodTill551 ;
)55; <
.55< =
ToArray55= D
(55D E
)55E F
;55F G
}66 
if88 
(88 
state88 
!=88 
null88 
)88 
{99 
list:: 
=:: 
list:: 
.:: 
Where:: !
(::! "
x::" #
=>::$ &
x::' (
.::( )
State::) .
==::/ 1
state::2 7
)::7 8
.::8 9
ToArray::9 @
(::@ A
)::A B
;::B C
};; 
var>> 
f>> 
=>> 
list>> 
.>> 
Where>> 
(>> 
x>>  
=>>>! #
x>>$ %
.>>% &
Checked>>& -
==>>. 0
false>>1 6
)>>6 7
.>>7 8
Select>>8 >
(>>> ?
x>>? @
=>>>A C
new>>D G
{?? 
x@@ 
.@@ 
AppointmentId@@ 
,@@  
xAA 
.AA 
DoctorIdAA 
,AA 
DoctorBB 
=BB 
newBB 
{BB 
NameBB #
=BB$ %
xBB& '
.BB' (
DoctorBB( .
?BB. /
.BB/ 0
NameBB0 4
,BB4 5
SurnameBB6 =
=BB> ?
xBB@ A
.BBA B
DoctorBBB H
?BBH I
.BBI J
SurnameBBJ Q
}BBR S
,BBS T
xCC 
.CC 
DateCC 
,CC 
xDD 
.DD 
DurationDD 
,DD 
StateEE 
=EE 
xEE 
.EE 
StateEE 
.EE  
ToStringEE  (
(EE( )
)EE) *
,EE* +
}FF 
)FF 
.FF 
OrderByDescendingFF  
(FF  !
xFF! "
=>FF# %
xFF& '
.FF' (
AppointmentIdFF( 5
)FF5 6
.FF6 7
ToArrayFF7 >
(FF> ?
)FF? @
;FF@ A
varHH 
aHH 
=HH 
listHH 
.HH 
WhereHH 
(HH 
xHH  
=>HH! #
xHH$ %
.HH% &
DateHH& *
==HH+ -
nullHH. 2
)HH2 3
.HH3 4
SelectHH4 :
(HH: ;
xHH; <
=>HH= ?
newHH@ C
{II 
xJJ 
.JJ 
AppointmentIdJJ 
,JJ  
xKK 
.KK 
DoctorIdKK 
,KK 
DoctorLL 
=LL 
newLL 
{LL 
NameLL #
=LL$ %
xLL& '
.LL' (
DoctorLL( .
?LL. /
.LL/ 0
NameLL0 4
,LL4 5
SurnameLL6 =
=LL> ?
xLL@ A
.LLA B
DoctorLLB H
?LLH I
.LLI J
SurnameLLJ Q
}LLR S
,LLS T
xMM 
.MM 
DateMM 
,MM 
xNN 
.NN 
DurationNN 
,NN 
StateOO 
=OO 
xOO 
.OO 
StateOO 
.OO  
ToStringOO  (
(OO( )
)OO) *
}PP 
)PP 
.PP 
ToArrayPP 
(PP 
)PP 
;PP 
varSS 
bSS 
=SS 
listSS 
.SS 
WhereSS 
(SS 
xSS  
=>SS! #
xSS$ %
.SS% &
DateSS& *
!=SS+ -
nullSS. 2
)SS2 3
.SS3 4
SelectSS4 :
(SS: ;
xSS; <
=>SS= ?
newSS@ C
{TT 
xUU 
.UU 
AppointmentIdUU 
,UU  
xVV 
.VV 
DoctorIdVV 
,VV 
DoctorWW 
=WW 
newWW 
{WW 
NameWW #
=WW$ %
xWW& '
.WW' (
DoctorWW( .
?WW. /
.WW/ 0
NameWW0 4
,WW4 5
SurnameWW6 =
=WW> ?
xWW@ A
.WWA B
DoctorWWB H
?WWH I
.WWI J
SurnameWWJ Q
}WWR S
,WWS T
xXX 
.XX 
DateXX 
,XX 
xYY 
.YY 
DurationYY 
,YY 
StateZZ 
=ZZ 
xZZ 
.ZZ 
StateZZ 
.ZZ  
ToStringZZ  (
(ZZ( )
)ZZ) *
}[[ 
)[[ 
.[[ 
OrderBy[[ 
([[ 
x[[ 
=>[[ 
x[[ 
.[[ 
Date[[ "
)[[" #
.[[# $
ToArray[[$ +
([[+ ,
)[[, -
;[[- .
var\\ 
c\\ 
=\\ 
(\\ 
f\\ 
.\\ 
Concat\\ 
(\\ 
a\\ 
)\\  
)\\  !
.\\! "
Concat\\" (
(\\( )
b\\) *
)\\* +
.\\+ ,
Distinct\\, 4
(\\4 5
)\\5 6
;\\6 7
var__ 

usersPaged__ 
=__ 
c__ 
.__ 
Skip__ #
(__# $
(__$ %
page__% )
-__* +
$num__, -
)__- .
*__/ 0
itemsPerPage__1 =
)__= >
.__> ?
Take__? C
(__C D
itemsPerPage__D P
)__P Q
.__Q R
ToList__R X
(__X Y
)__Y Z
;__Z [
var`` 
json`` 
=`` 
new`` 
{aa 
countbb 
=bb 
cbb 
.bb 
Countbb 
(bb  
)bb  !
,bb! "
datacc 
=cc 

usersPagedcc !
}dd 
;dd 
returnff 
Okff 
(ff 
jsonff 
)ff 
;ff 
}gg 	
[kk 	
Routekk	 
(kk 
$strkk 
)kk 
]kk 
[ll 	
	Authorizell	 
(ll 
Rolesll 
=ll 
Rolesll  
.ll  !

AllDoctorsll! +
+ll, -
$strll. 1
+ll2 3
Rolesll4 9
.ll9 :
Patientll: A
+llB C
$strllD G
+llH I
RolesllJ O
.llO P
ReceptionistllP \
)ll\ ]
]ll] ^
[mm 	
ResponseTypemm	 
(mm 
typeofmm 
(mm 
Appointmentmm (
)mm( )
)mm) *
]mm* +
publicnn 
IHttpActionResultnn  
GetAppointmentnn! /
(nn/ 0
intnn0 3
idnn4 6
)nn6 7
{oo 	
varqq 
currentUserqq 
=qq 
dbqq  
.qq  !
Usersqq! &
.qq& '
FirstOrDefaultqq' 5
(qq5 6
xqq6 7
=>qq8 :
xqq; <
.qq< =
Emailqq= B
==qqC E
thisqqF J
.qqJ K
UserqqK O
.qqO P
IdentityqqP X
.qqX Y
NameqqY ]
)qq] ^
;qq^ _
ifss 
(ss 
currentUserss 
==ss 
nullss #
)ss# $
{tt 
returnuu 
Contentuu 
(uu 
HttpStatusCodeuu -
.uu- .
NotFounduu. 6
,uu6 7
Messagesuu8 @
.uu@ A
UserNotFounduuA M
)uuM N
;uuN O
}vv 
varxx 
appointmentxx 
=xx 
dbxx  
.xx  !
Appointmentsxx! -
.xx- .
FirstOrDefaultxx. <
(xx< =
xxx= >
=>xx? A
xxxB C
.xxC D
AppointmentIdxxD Q
==xxR T
idxxU W
)xxW X
;xxX Y
ifzz 
(zz 
appointmentzz 
==zz 
nullzz #
)zz# $
{{{ 
return|| 
Content|| 
(|| 
HttpStatusCode|| -
.||- .
NotFound||. 6
,||6 7
Messages||8 @
.||@ A
AppointmentNotFound||A T
)||T U
;||U V
}}} 
if 
( 
this 
. 
User 
. 
IsInRole "
(" #
Roles# (
.( )
Patient) 0
)0 1
&&2 4
appointment5 @
.@ A
	PatientIdA J
!=K M
currentUserN Y
.Y Z
UserIdZ `
)` a
{
ÄÄ 
return
ÅÅ 
Content
ÅÅ 
(
ÅÅ 
HttpStatusCode
ÅÅ -
.
ÅÅ- .
	Forbidden
ÅÅ. 7
,
ÅÅ7 8
Messages
ÅÅ9 A
.
ÅÅA B
AccsesDenied
ÅÅB N
)
ÅÅN O
;
ÅÅO P
}
ÇÇ 
if
ÑÑ 
(
ÑÑ 
Tools
ÑÑ 
.
ÑÑ 
AnyRole
ÑÑ 
(
ÑÑ 
this
ÑÑ "
.
ÑÑ" #
User
ÑÑ# '
,
ÑÑ' (
Roles
ÑÑ) .
.
ÑÑ. /
DoctorRoles
ÑÑ/ :
)
ÑÑ: ;
&&
ÑÑ< >
appointment
ÑÑ? J
.
ÑÑJ K
Doctor
ÑÑK Q
.
ÑÑQ R
UserId
ÑÑR X
!=
ÑÑY [
currentUser
ÑÑ\ g
.
ÑÑg h
UserId
ÑÑh n
)
ÑÑn o
{
ÖÖ 
return
ÜÜ 
Content
ÜÜ 
(
ÜÜ 
HttpStatusCode
ÜÜ -
.
ÜÜ- .
	Forbidden
ÜÜ. 7
,
ÜÜ7 8
Messages
ÜÜ9 A
.
ÜÜA B
AccsesDenied
ÜÜB N
)
ÜÜN O
;
ÜÜO P
}
áá 
try
ââ 
{
ää 
var
åå 
a
åå 
=
åå 
new
åå 
{
çç 
DoctorFullName
éé "
=
éé# $
appointment
éé% 0
.
éé0 1
Doctor
éé1 7
!=
éé8 :
null
éé; ?
?
éé@ A
appointment
ééB M
.
ééM N
Doctor
ééN T
.
ééT U
Name
ééU Y
+
ééZ [
$str
éé\ _
+
éé` a
appointment
ééb m
.
éém n
Doctor
één t
.
éét u
Surname
ééu |
:
éé} ~
nulléé É
,ééÉ Ñ
DoctorURLImage
èè "
=
èè# $
appointment
èè% 0
.
èè0 1
Doctor
èè1 7
!=
èè8 :
null
èè; ?
?
èè@ A
	Constants
èèB K
.
èèK L

ThisServer
èèL V
+
èèW X
appointment
èèY d
.
èèd e
Doctor
èèe k
.
èèk l
URLImage
èèl t
:
èèu v
null
èèw {
,
èè{ |
DoctorId
êê 
=
êê 
appointment
êê *
.
êê* +
DoctorId
êê+ 3
,
êê3 4
	PatientId
ëë 
=
ëë 
appointment
ëë  +
.
ëë+ ,
	PatientId
ëë, 5
,
ëë5 6
PatientFullName
íí #
=
íí$ %
appointment
íí& 1
.
íí1 2
Patient
íí2 9
.
íí9 :
Name
íí: >
+
íí? @
$str
ííA D
+
ííE F
appointment
ííG R
.
ííR S
Patient
ííS Z
.
ííZ [
Surname
íí[ b
,
ííb c
PatientURLImage
ìì #
=
ìì$ %
	Constants
ìì& /
.
ìì/ 0

ThisServer
ìì0 :
+
ìì; <
appointment
ìì= H
.
ììH I
Patient
ììI P
.
ììP Q
URLImage
ììQ Y
,
ììY Z
Date
îî 
=
îî 
appointment
îî &
.
îî& '
Date
îî' +
,
îî+ ,
Description
ïï 
=
ïï  !
appointment
ïï" -
.
ïï- .
Description
ïï. 9
,
ïï9 :
Duration
ññ 
=
ññ 
appointment
ññ *
.
ññ* +
Duration
ññ+ 3
,
ññ3 4
State
óó 
=
óó 
appointment
óó '
.
óó' (
State
óó( -
.
óó- .
ToString
óó. 6
(
óó6 7
)
óó7 8
,
óó8 9
ProcedureType
òò !
=
òò" #
appointment
òò$ /
.
òò/ 0
	Procedure
òò0 9
==
òò: <
null
òò= A
?
òòB C
null
òòD H
:
òòI J
appointment
òòK V
.
òòV W
	Procedure
òòW `
.
òò` a
GetType
òòa h
(
òòh i
)
òòi j
.
òòj k
BaseType
òòk s
.
òòs t
Name
òòt x
,
òòx y
Checked
ôô 
=
ôô 
appointment
ôô )
.
ôô) *
Checked
ôô* 1
}
öö 
;
öö 
return
õõ 
Ok
õõ 
(
õõ 
a
õõ 
)
õõ 
;
õõ 
}
úú 
catch
ùù 
(
ùù 
	Exception
ùù 
ex
ùù 
)
ùù  
{
ûû 
return
üü !
InternalServerError
üü *
(
üü* +
ex
üü+ -
)
üü- .
;
üü. /
}
†† 
}
•• 	
[
ßß 	
HttpPut
ßß	 
]
ßß 
[
®® 	
	Authorize
®®	 
(
®® 
Roles
®® 
=
®® 
Roles
®®  
.
®®  !
Receptionist
®®! -
+
®®. /
$str
®®0 3
+
®®4 5
Roles
®®6 ;
.
®®; <

AllDoctors
®®< F
)
®®F G
]
®®G H
[
©© 	
Route
©©	 
(
©© 
$str
©© 
)
©© 
]
©© 
[
™™ 	
ResponseType
™™	 
(
™™ 
typeof
™™ 
(
™™ 
void
™™ !
)
™™! "
)
™™" #
]
™™# $
public
´´ 
IHttpActionResult
´´  )
UpdateAndConfirmAppointment
´´! <
(
´´< =
int
´´= @
id
´´A C
,
´´C D
Appointment
´´E P
appointment
´´Q \
)
´´\ ]
{
¨¨ 	
var
≠≠ 
currentUser
≠≠ 
=
≠≠ 
db
≠≠  
.
≠≠  !
Users
≠≠! &
.
≠≠& '
FirstOrDefault
≠≠' 5
(
≠≠5 6
x
≠≠6 7
=>
≠≠8 :
x
≠≠; <
.
≠≠< =
Email
≠≠= B
==
≠≠C E
this
≠≠F J
.
≠≠J K
User
≠≠K O
.
≠≠O P
Identity
≠≠P X
.
≠≠X Y
Name
≠≠Y ]
)
≠≠] ^
;
≠≠^ _
if
ÆÆ 
(
ÆÆ 
appointment
ÆÆ 
.
ÆÆ 
DoctorId
ÆÆ $
!=
ÆÆ% '
currentUser
ÆÆ( 3
.
ÆÆ3 4
UserId
ÆÆ4 :
&&
ÆÆ; =
Tools
ÆÆ> C
.
ÆÆC D
AnyRole
ÆÆD K
(
ÆÆK L
this
ÆÆL P
.
ÆÆP Q
User
ÆÆQ U
,
ÆÆU V
Roles
ÆÆW \
.
ÆÆ\ ]
DoctorRoles
ÆÆ] h
)
ÆÆh i
)
ÆÆi j
{
ØØ 
return
∞∞ 
Content
∞∞ 
(
∞∞ 
HttpStatusCode
∞∞ -
.
∞∞- .
	Forbidden
∞∞. 7
,
∞∞7 8
Messages
∞∞9 A
.
∞∞A B
AccsesDenied
∞∞B N
)
∞∞N O
;
∞∞O P
}
±± 
appointment
≥≥ 
.
≥≥ 
AppointmentId
≥≥ %
=
≥≥& '
id
≥≥( *
;
≥≥* +
db
µµ 
.
µµ 
Entry
µµ 
(
µµ 
appointment
µµ  
)
µµ  !
.
µµ! "
State
µµ" '
=
µµ( )
EntityState
µµ* 5
.
µµ5 6
Modified
µµ6 >
;
µµ> ?
try
∑∑ 
{
∏∏ 
db
ππ 
.
ππ 
SaveChanges
ππ 
(
ππ 
)
ππ  
;
ππ  !
}
∫∫ 
catch
ªª 
(
ªª *
DbUpdateConcurrencyException
ªª /
)
ªª/ 0
{
ºº 
if
ΩΩ 
(
ΩΩ 
!
ΩΩ 
AppointmentExists
ΩΩ #
(
ΩΩ# $
id
ΩΩ$ &
)
ΩΩ& '
)
ΩΩ' (
{
ææ 
return
øø 
NotFound
øø #
(
øø# $
)
øø$ %
;
øø% &
}
¿¿ 
throw
¡¡ 
;
¡¡ 
}
¬¬ 
return
ƒƒ 

StatusCode
ƒƒ 
(
ƒƒ 
HttpStatusCode
ƒƒ ,
.
ƒƒ, -
	NoContent
ƒƒ- 6
)
ƒƒ6 7
;
ƒƒ7 8
}
≈≈ 	
[
»» 	
HttpPost
»»	 
]
»» 
[
…… 	
Route
……	 
(
…… 
$str
……  
)
……  !
]
……! "
[
   	
ResponseType
  	 
(
   
typeof
   
(
   
void
   !
)
  ! "
)
  " #
]
  # $
public
ÀÀ 
IHttpActionResult
ÀÀ  %
CheckDateForAppointment
ÀÀ! 8
(
ÀÀ8 9
Appointment
ÀÀ9 D
appointment
ÀÀE P
)
ÀÀP Q
{
ÃÃ 	
var
ÕÕ 
appoints
ÕÕ 
=
ÕÕ 
db
ÕÕ 
.
ÕÕ 
Appointments
ÕÕ *
.
ÕÕ* +
Where
ÕÕ+ 0
(
ÕÕ0 1
x
ÕÕ1 2
=>
ÕÕ3 5
x
ÕÕ6 7
.
ÕÕ7 8
DoctorId
ÕÕ8 @
==
ÕÕA C
appointment
ÕÕD O
.
ÕÕO P
DoctorId
ÕÕP X
&&
ÕÕY [
x
ÕÕ\ ]
.
ÕÕ] ^
Date
ÕÕ^ b
>=
ÕÕc e
DateTime
ÕÕf n
.
ÕÕn o
Now
ÕÕo r
)
ÕÕr s
.
ÕÕs t
ToArray
ÕÕt {
(
ÕÕ{ |
)
ÕÕ| }
;
ÕÕ} ~
if
œœ	 
(
œœ 
appointment
œœ 
.
œœ 
Date
œœ 
==
œœ  
null
œœ! %
||
œœ& (
appointment
œœ) 4
.
œœ4 5
Duration
œœ5 =
==
œœ> @
null
œœA E
)
œœE F
return
œœG M
Ok
œœN P
(
œœP Q
)
œœQ R
;
œœR S
foreach
––	 
(
–– 
var
–– 
list
–– 
in
–– 
appoints
–– &
)
––& '
{
——	 

if
““
 
(
““ 
list
““ 
.
““ 
Date
““ 
==
““ 
null
““ 
||
““  "
list
““# '
.
““' (
Duration
““( 0
==
““1 3
null
““4 8
)
““8 9
continue
““: B
;
““B C
var
””
 
tmp
”” 
=
”” 
list
”” 
.
”” 
Date
”” 
+
”” 
list
””  $
.
””$ %
Duration
””% -
;
””- .
var
‘‘
 
enterApp
‘‘ 
=
‘‘ 
appointment
‘‘ $
.
‘‘$ %
Date
‘‘% )
+
‘‘* +
appointment
‘‘, 7
.
‘‘7 8
Duration
‘‘8 @
;
‘‘@ A
if
’’
 
(
’’ 
(
’’ 
appointment
’’ 
.
’’ 
Date
’’ 
==
’’  "
list
’’# '
.
’’' (
Date
’’( ,
)
’’, -
||
’’. 0
(
÷÷ 
enterApp
÷÷ 
==
÷÷ 
tmp
÷÷ 
)
÷÷ 
||
÷÷  "
(
◊◊ 
(
◊◊ 
appointment
◊◊ 
.
◊◊ 
Date
◊◊  
)
◊◊  !
>=
◊◊" $
list
◊◊% )
.
◊◊) *
Date
◊◊* .
&&
◊◊/ 1
(
◊◊2 3
appointment
◊◊3 >
.
◊◊> ?
Date
◊◊? C
)
◊◊C D
<=
◊◊E G
tmp
◊◊H K
)
◊◊K L
||
◊◊M O
(
ÿÿ 
(
ÿÿ 
appointment
ÿÿ 
.
ÿÿ 
Date
ÿÿ  
)
ÿÿ  !
>=
ÿÿ" $
list
ÿÿ% )
.
ÿÿ) *
Date
ÿÿ* .
&&
ÿÿ/ 1
enterApp
ÿÿ2 :
<=
ÿÿ; =
tmp
ÿÿ> A
)
ÿÿA B
||
ÿÿC E
(
ŸŸ 
appointment
ŸŸ 
.
ŸŸ 
Date
ŸŸ 
<=
ŸŸ  "
list
ŸŸ# '
.
ŸŸ' (
Date
ŸŸ( ,
&&
ŸŸ- /
enterApp
ŸŸ0 8
>=
ŸŸ9 ;
list
ŸŸ< @
.
ŸŸ@ A
Date
ŸŸA E
)
ŸŸE F
||
ŸŸG I
(
⁄⁄ 
appointment
⁄⁄ 
.
⁄⁄ 
Date
⁄⁄ 
<=
⁄⁄  "
list
⁄⁄# '
.
⁄⁄' (
Date
⁄⁄( ,
&&
⁄⁄- /
enterApp
⁄⁄0 8
>=
⁄⁄9 ;
tmp
⁄⁄< ?
)
⁄⁄? @
)
⁄⁄@ A
{
€€
 
return
‹‹ 
NotFound
‹‹ 
(
‹‹ 
)
‹‹ 
;
‹‹ 
}
››
 
}
ﬁﬁ	 

return
ﬂﬂ	 
Ok
ﬂﬂ 
(
ﬂﬂ 
)
ﬂﬂ 
;
ﬂﬂ 
}
·· 	
[
‰‰ 	
HttpPost
‰‰	 
]
‰‰ 
[
ÂÂ 	
Route
ÂÂ	 
(
ÂÂ 
$str
ÂÂ "
)
ÂÂ" #
]
ÂÂ# $
[
ÊÊ 	
ResponseType
ÊÊ	 
(
ÊÊ 
typeof
ÊÊ 
(
ÊÊ 
void
ÊÊ !
)
ÊÊ! "
)
ÊÊ" #
]
ÊÊ# $
public
ÁÁ 
IHttpActionResult
ÁÁ  
	SendEmail
ÁÁ! *
(
ÁÁ* +
int
ÁÁ+ .
id
ÁÁ/ 1
,
ÁÁ1 2
EmailPostDto
ÁÁ3 ?
emailPostDto
ÁÁ@ L
)
ÁÁL M
{
ËË 	
if
ÈÈ 
(
ÈÈ 
emailPostDto
ÈÈ 
.
ÈÈ 

EmailState
ÈÈ '
==
ÈÈ( *
EmailPostState
ÈÈ+ 9
.
ÈÈ9 :
delete
ÈÈ: @
&&
ÈÈA C
(
ÈÈD E
emailPostDto
ÈÈE Q
.
ÈÈQ R
appointment
ÈÈR ]
==
ÈÈ^ `
null
ÈÈa e
||
ÈÈf h
emailPostDto
ÈÈi u
.
ÈÈu v
appointmentÈÈv Å
.ÈÈÅ Ç
DateÈÈÇ Ü
<ÈÈá à
DateTimeÈÈâ ë
.ÈÈë í
NowÈÈí ï
)ÈÈï ñ
)ÈÈñ ó
{
ÍÍ 
return
ÎÎ 

BadRequest
ÎÎ !
(
ÎÎ! "
)
ÎÎ" #
;
ÎÎ# $
}
ÏÏ 

EmailInput
ÓÓ 

emailInput
ÓÓ !
=
ÓÓ" #
new
ÓÓ$ '

EmailInput
ÓÓ( 2
(
ÓÓ2 3
)
ÓÓ3 4
;
ÓÓ4 5
var
ÔÔ 
pat
ÔÔ 
=
ÔÔ 
db
ÔÔ 
.
ÔÔ 
Patients
ÔÔ !
.
ÔÔ! "
Find
ÔÔ" &
(
ÔÔ& '
emailPostDto
ÔÔ' 3
.
ÔÔ3 4
appointment
ÔÔ4 ?
.
ÔÔ? @
	PatientId
ÔÔ@ I
)
ÔÔI J
;
ÔÔJ K

emailInput
 
.
 
UserName
 
=
  !
pat
" %
.
% &
FullName
& .
;
. /

emailInput
ÒÒ 
.
ÒÒ 
Email
ÒÒ 
=
ÒÒ 
pat
ÒÒ "
.
ÒÒ" #
Email
ÒÒ# (
;
ÒÒ( )
switch
ÛÛ 
(
ÛÛ 
emailPostDto
ÛÛ  
.
ÛÛ  !

EmailState
ÛÛ! +
)
ÛÛ+ ,
{
ÙÙ 
case
ıı 
EmailPostState
ıı #
.
ıı# $
confirm
ıı$ +
:
ıı+ ,
{
ˆˆ 

emailInput
˜˜ "
.
˜˜" #
Subject
˜˜# *
=
˜˜+ ,
$str
˜˜- C
;
˜˜C D

emailInput
¯¯ "
.
¯¯" #
Body
¯¯# '
=
¯¯( )
$"
˘˘ 5
'Hello! \nYou reserved to apointment on 
˘˘ B
{
˘˘B C
emailPostDto
˘˘C O
.
˘˘O P
appointment
˘˘P [
.
˘˘[ \
Date
˘˘\ `
}
˘˘` a
\nYour doctor:
˘˘a o
{
˘˘o p
db
˘˘p r
.
˘˘r s
Doctors
˘˘s z
.
˘˘z {
Find
˘˘{ 
(˘˘ Ä
emailPostDto˘˘Ä å
.˘˘å ç
appointment˘˘ç ò
.˘˘ò ô
DoctorId˘˘ô °
)˘˘° ¢
.˘˘¢ £
FullName˘˘£ ´
}˘˘´ ¨Å
q\nPlease delete appointment and register one more if It`s date doesn`t suitable for you\nBest regard,\nAlphaMedic˘˘¨ ù
"˘˘ù û
;˘˘û ü
break
˙˙ 
;
˙˙ 
}
˚˚ 
case
˝˝ 
EmailPostState
˝˝ #
.
˝˝# $
delete
˝˝$ *
:
˝˝* +
{
˛˛ 

emailInput
ˇˇ "
.
ˇˇ" #
Subject
ˇˇ# *
=
ˇˇ+ ,
$str
ˇˇ- C
;
ˇˇC D

emailInput
ÄÄ "
.
ÄÄ" #
Body
ÄÄ# '
=
ÄÄ( )
$str
ÄÄ* y
+
ÄÄz {
emailPostDtoÄÄ| à
.ÄÄà â
appointmentÄÄâ î
.ÄÄî ï
DateÄÄï ô
+ÄÄö õ
$str
ÅÅ *
+
ÅÅ+ ,
emailPostDto
ÅÅ- 9
.
ÅÅ9 :
appointment
ÅÅ: E
.
ÅÅE F
Description
ÅÅF Q
+
ÅÅR S
$str
ÇÇ R
+
ÇÇS T
$str
ÉÉ S
;
ÉÉS T
break
ÑÑ 
;
ÑÑ 
}
ÖÖ 
case
áá 
EmailPostState
áá #
.
áá# $
change
áá$ *
:
áá* +
{
àà 

emailInput
ââ "
.
ââ" #
Subject
ââ# *
=
ââ+ ,
$str
ââ- B
;
ââB C

emailInput
ää "
.
ää" #
Body
ää# '
=
ää( )
$str
ää* y
+
ääz {
emailPostDtoää| à
.ääà â
appointmentääâ î
.ääî ï
Dateääï ô
+ääö õ
$strääú ¨
+ää≠ Æ
db
ãã 
.
ãã 
Doctors
ãã "
.
ãã" #
Find
ãã# '
(
ãã' (
emailPostDto
ãã( 4
.
ãã4 5
appointment
ãã5 @
.
ãã@ A
DoctorId
ããA I
)
ããI J
?
ããJ K
.
ããK L
FullName
ããL T
+
ããU V
$strããW  
;ãã  À
break
åå 
;
åå 
}
çç 
}
èè 
try
êê 
{
ëë 
}
ìì 
catch
îî 
(
îî 
	Exception
îî 
)
îî 
{
ïï 
return
ññ 

BadRequest
ññ !
(
ññ! "
)
ññ" #
;
ññ# $
}
óó 
return
ôô 
Ok
ôô 
(
ôô 
)
ôô 
;
ôô 
}
õõ 	
[
ûû 	
Route
ûû	 
(
ûû 
$str
ûû (
)
ûû( )
]
ûû) *
public
üü 

IQueryable
üü +
GetDoctorAppointmentsAsEvents
üü 7
(
üü7 8
int
üü8 ;
id
üü< >
)
üü> ?
{
†† 	
var
¢¢ 
a
¢¢ 
=
¢¢ 
db
¢¢ 
.
¢¢ 
Appointments
¢¢ #
.
¢¢# $
Where
¢¢$ )
(
¢¢) *
x
¢¢* +
=>
¢¢, .
x
¢¢/ 0
.
¢¢0 1
State
¢¢1 6
==
¢¢7 9
AppointmentState
¢¢: J
.
¢¢J K
Accepted
¢¢K S
&&
¢¢T V
x
¢¢W X
.
¢¢X Y
Doctor
¢¢Y _
.
¢¢_ `

ScheduleId
¢¢` j
==
¢¢k m
id
¢¢n p
&&
¢¢q s
x
¢¢t u
.
¢¢u v
Date
¢¢v z
!=
¢¢{ }
null¢¢~ Ç
&&¢¢É Ö
(¢¢Ü á
bool¢¢á ã
)¢¢ã å
x¢¢å ç
.¢¢ç é
Patient¢¢é ï
.¢¢ï ñ
Active¢¢ñ ú
)¢¢ú ù
.¢¢ù û
ToArray¢¢û •
(¢¢• ¶
)¢¢¶ ß
;¢¢ß ®
var
££ 
b
££ 
=
££ 
a
££ 
.
££ 
Select
££ 
(
££ 
e
££ 
=>
££ !
new
££" %
{
§§ 
url
•• 
=
•• 
$str
•• *
+
••+ ,
e
••- .
.
••. /
AppointmentId
••/ <
.
••< =
ToString
••= E
(
••E F
)
••F G
,
••G H
start
¶¶ 
=
¶¶ 
e
¶¶ 
.
¶¶ 
Date
¶¶ 
,
¶¶ 
finish
ßß 
=
ßß 
e
ßß 
.
ßß 
Date
ßß 
+
ßß  !
e
ßß" #
.
ßß# $
Duration
ßß$ ,
,
ßß, -
title
®® 
=
®® 
e
®® 
.
®® 
Patient
®® !
.
®®! "
Name
®®" &
+
®®' (
$str
®®) ,
+
®®- .
e
®®/ 0
.
®®0 1
Patient
®®1 8
.
®®8 9
Surname
®®9 @
}
©© 
)
™™ 
;
™™ 
return
≠≠ 
b
≠≠ 
.
≠≠ 
AsQueryable
≠≠  
(
≠≠  !
)
≠≠! "
;
≠≠" #
}
ÆÆ 	
[
±± 	
Route
±±	 
(
±± 
$str
±± 
)
±± 
]
±± 
[
≤≤ 	
ResponseType
≤≤	 
(
≤≤ 
typeof
≤≤ 
(
≤≤ 
Appointment
≤≤ (
)
≤≤( )
)
≤≤) *
]
≤≤* +
[
≥≥ 	
	Authorize
≥≥	 
(
≥≥ 
Roles
≥≥ 
=
≥≥ 
Roles
≥≥  
.
≥≥  !
Receptionist
≥≥! -
+
≥≥. /
$str
≥≥0 3
+
≥≥4 5
Roles
≥≥6 ;
.
≥≥; <
Patient
≥≥< C
+
≥≥D E
$str
≥≥F I
+
≥≥J K
Roles
≥≥L Q
.
≥≥Q R

AllDoctors
≥≥R \
)
≥≥\ ]
]
≥≥] ^
public
¥¥ 
IHttpActionResult
¥¥  
PostAppointment
¥¥! 0
(
¥¥0 1
Appointment
¥¥1 <
appointment
¥¥= H
)
¥¥H I
{
µµ 	
if
∂∂ 
(
∂∂ 
db
∂∂ 
.
∂∂ 
	Employees
∂∂ 
.
∂∂ 
Any
∂∂  
(
∂∂  !
x
∂∂! "
=>
∂∂# %
x
∂∂& '
.
∂∂' (
UserId
∂∂( .
==
∂∂/ 1
appointment
∂∂2 =
.
∂∂= >
	PatientId
∂∂> G
)
∂∂G H
)
∂∂H I
{
∑∑ 
return
∏∏ 

BadRequest
∏∏ !
(
∏∏! "
$str
∏∏" K
)
∏∏K L
;
∏∏L M
}
ππ 
if
ªª 
(
ªª 
appointment
ªª 
.
ªª 
Date
ªª  
<
ªª! "
DateTime
ªª# +
.
ªª+ ,
UtcNow
ªª, 2
)
ªª2 3
{
ºº 
return
ΩΩ 

BadRequest
ΩΩ !
(
ΩΩ! "
$str
ΩΩ" .
)
ΩΩ. /
;
ΩΩ/ 0
}
ææ 
appointment
¿¿ 
.
¿¿ 
Doctor
¿¿ 
=
¿¿  
db
¿¿! #
.
¿¿# $
Doctors
¿¿$ +
.
¿¿+ ,
Include
¿¿, 3
(
¿¿3 4
c
¿¿4 5
=>
¿¿6 8
c
¿¿9 :
.
¿¿: ;
Schedule
¿¿; C
)
¿¿C D
.
¿¿D E
FirstOrDefault
¡¡ !
(
¡¡! "
d
¡¡" #
=>
¡¡$ &
d
¡¡' (
.
¡¡( )
UserId
¡¡) /
==
¡¡0 2
appointment
¡¡3 >
.
¡¡> ?
DoctorId
¡¡? G
)
¡¡G H
;
¡¡H I
appointment
¬¬ 
.
¬¬ 
Patient
¬¬ 
=
¬¬  !
db
¬¬" $
.
¬¬$ %
Patients
¬¬% -
.
¬¬- .
Include
¬¬. 5
(
¬¬5 6
c
¬¬6 7
=>
¬¬8 :
c
¬¬; <
.
¬¬< =
MedicalHistory
¬¬= K
)
¬¬K L
.
¬¬L M
FirstOrDefault
√√ 
(
√√ 
p
√√  
=>
√√! #
p
√√$ %
.
√√% &
UserId
√√& ,
==
√√- /
appointment
√√0 ;
.
√√; <
	PatientId
√√< E
)
√√E F
;
√√F G
if
≈≈ 
(
≈≈ 
!
≈≈ 

ModelState
≈≈ 
.
≈≈ 
IsValid
≈≈ #
)
≈≈# $
{
∆∆ 
return
«« 

BadRequest
«« !
(
««! "

ModelState
««" ,
)
««, -
;
««- .
}
»» 
db
   
.
   
Appointments
   
.
   
Add
   
(
    
appointment
    +
)
  + ,
;
  , -
db
ÀÀ 
.
ÀÀ 
SaveChanges
ÀÀ 
(
ÀÀ 
)
ÀÀ 
;
ÀÀ 
return
ÕÕ 
Ok
ÕÕ 
(
ÕÕ 
new
ÕÕ 
{
ŒŒ 
Id
œœ 
=
œœ 
appointment
œœ  
.
œœ  !
AppointmentId
œœ! .
,
œœ. /
Date
–– 
=
–– 
appointment
–– "
.
––" #
Date
––# '
}
—— 
)
—— 
;
—— 
}
”” 	
[
÷÷ 	
Route
÷÷	 
(
÷÷ 
$str
÷÷ 
)
÷÷ 
]
÷÷ 
[
◊◊ 	
ResponseType
◊◊	 
(
◊◊ 
typeof
◊◊ 
(
◊◊ 
Appointment
◊◊ (
)
◊◊( )
)
◊◊) *
]
◊◊* +
[
ÿÿ 	
	Authorize
ÿÿ	 
(
ÿÿ 
Roles
ÿÿ 
=
ÿÿ 
Roles
ÿÿ  
.
ÿÿ  !
Receptionist
ÿÿ! -
+
ÿÿ. /
$str
ÿÿ0 3
+
ÿÿ4 5
Roles
ÿÿ6 ;
.
ÿÿ; <
Patient
ÿÿ< C
)
ÿÿC D
]
ÿÿD E
public
ŸŸ 
IHttpActionResult
ŸŸ  
DeleteAppointment
ŸŸ! 2
(
ŸŸ2 3
int
ŸŸ3 6
id
ŸŸ7 9
)
ŸŸ9 :
{
⁄⁄ 	
var
€€ 
appointment
€€ 
=
€€ 
db
€€  
.
€€  !
Appointments
€€! -
.
€€- .
Find
€€. 2
(
€€2 3
id
€€3 5
)
€€5 6
;
€€6 7
if
‹‹ 
(
‹‹ 
appointment
‹‹ 
==
‹‹ 
null
‹‹ #
)
‹‹# $
{
›› 
return
ﬁﬁ 
NotFound
ﬁﬁ 
(
ﬁﬁ  
)
ﬁﬁ  !
;
ﬁﬁ! "
}
ﬂﬂ 
var
‡‡ 
proc
‡‡ 
=
‡‡ 
db
‡‡ 
.
‡‡ 

Procedures
‡‡ $
.
‡‡$ %
Find
‡‡% )
(
‡‡) *
id
‡‡* ,
)
‡‡, -
;
‡‡- .
try
·· 
{
‚‚ 
if
„„ 
(
„„ 
proc
„„ 
!=
„„ 
null
„„  
)
„„  !
{
‰‰ 
db
ÂÂ 
.
ÂÂ 

Procedures
ÂÂ !
.
ÂÂ! "
Remove
ÂÂ" (
(
ÂÂ( )
proc
ÂÂ) -
)
ÂÂ- .
;
ÂÂ. /
db
ÊÊ 
.
ÊÊ 
SaveChanges
ÊÊ "
(
ÊÊ" #
)
ÊÊ# $
;
ÊÊ$ %
}
ÁÁ 
db
ËË 
.
ËË 
Appointments
ËË 
.
ËË  
Remove
ËË  &
(
ËË& '
appointment
ËË' 2
)
ËË2 3
;
ËË3 4
db
ÈÈ 
.
ÈÈ 
SaveChanges
ÈÈ 
(
ÈÈ 
)
ÈÈ  
;
ÈÈ  !
}
ÍÍ 
catch
ÎÎ 
(
ÎÎ 
	Exception
ÎÎ 
)
ÎÎ 
{
ÏÏ 
return
ÌÌ 
NotFound
ÌÌ 
(
ÌÌ  
)
ÌÌ  !
;
ÌÌ! "
}
ÓÓ 
return
ÔÔ 
Ok
ÔÔ 
(
ÔÔ 
appointment
ÔÔ !
)
ÔÔ! "
;
ÔÔ" #
}
 	
	protected
ÚÚ 
override
ÚÚ 
void
ÚÚ 
Dispose
ÚÚ  '
(
ÚÚ' (
bool
ÚÚ( ,
	disposing
ÚÚ- 6
)
ÚÚ6 7
{
ÛÛ 	
if
ÙÙ 
(
ÙÙ 
	disposing
ÙÙ 
)
ÙÙ 
{
ıı 
db
ˆˆ 
.
ˆˆ 
Dispose
ˆˆ 
(
ˆˆ 
)
ˆˆ 
;
ˆˆ 
}
˜˜ 
base
¯¯ 
.
¯¯ 
Dispose
¯¯ 
(
¯¯ 
	disposing
¯¯ "
)
¯¯" #
;
¯¯# $
}
˘˘ 	
private
˚˚ 
bool
˚˚ 
AppointmentExists
˚˚ &
(
˚˚& '
int
˚˚' *
id
˚˚+ -
)
˚˚- .
{
¸¸ 	
return
˝˝ 
db
˝˝ 
.
˝˝ 
Appointments
˝˝ "
.
˝˝" #
Count
˝˝# (
(
˝˝( )
e
˝˝) *
=>
˝˝+ -
e
˝˝. /
.
˝˝/ 0
AppointmentId
˝˝0 =
==
˝˝> @
id
˝˝A C
)
˝˝C D
>
˝˝E F
$num
˝˝G H
;
˝˝H I
}
˛˛ 	
}
ˇˇ 
}ÄÄ Ío
BH:\AlphaMedic\AlphaMedic\Rest\Controllers\DepartmentsController.cs
	namespace 	
Rest
 
. 
Controllers 
{ 
[ 
RoutePrefix 
( 
$str "
)" #
]# $
public 

class !
DepartmentsController &
:' (
ApiController) 6
{ 
private 
readonly 
AlphaMedicContext *
db+ -
=. /
new0 3
AlphaMedicContext4 E
(E F
)F G
;G H
public !
DepartmentsController $
($ %
)% &
{' (
}) *
public !
DepartmentsController $
($ %
AlphaMedicContext% 6
context7 >
)> ?
{ 	
db 
= 
context 
; 
} 	
[ 	
Route	 
( 
$str 
) 
] 
public 
IEnumerable 
< 
DepartmentDto (
>( )
GetDepartments* 8
(8 9
)9 :
{ 	
try 
{ 
return 
db 
. 
Departments %
.% &
Select& ,
(, -
x- .
=>/ 1
new2 5
DepartmentDto6 C
{   
Name!! 
=!! 
x!! 
.!! 
Name!! !
,!!! "
Description"" 
=""  !
x""" #
.""# $
Description""$ /
,""/ 0
DepartmentId##  
=##! "
x### $
.##$ %
DepartmentId##% 1
}$$ 
)%% 
;%% 
}&& 
catch'' 
('' "
NullReferenceException'' )
)'') *
{(( 
return)) 

Enumerable)) !
.))! "
Empty))" '
<))' (
DepartmentDto))( 5
>))5 6
())6 7
)))7 8
.))8 9
AsQueryable))9 D
())D E
)))E F
;))F G
}** 
}++ 	
[-- 	
Route--	 
(-- 
$str-- 
)-- 
]-- 
public.. 
IHttpActionResult..  
GetDepartment..! .
(... /
int../ 2
id..3 5
,..5 6
[..7 8
FromUri..8 ?
]..? @
bool..A E
all..F I
=..J K
true..L P
)..P Q
{// 	
var00 

department00 
=00 
db00 
.00  
Departments00  +
.00+ ,
FirstOrDefault00, :
(00: ;
x00; <
=>00= ?
x00@ A
.00A B
DepartmentId00B N
==00O Q
id00R T
)00T U
;00U V
if11 
(11 

department11 
==11 
null11 "
)11" #
{22 
return33 
NotFound33 
(33  
)33  !
;33! "
}44 
var66 
doc66 
=66 

department66  
.66  !
Doctors66! (
.66( )
FirstOrDefault66) 7
(667 8
x668 9
=>66: <
x66= >
.66> ?

DoctorType66? I
==66J L

DoctorType66M W
.66W X
HeadDepartment66X f
)66f g
;66g h
var88 
	feedbacks88 
=88 

department88 &
.88& '
	Feedbacks88' 0
.880 1
Select881 7
(887 8
x888 9
=>88: <
new88= @
FeedbackDto88A L
{99 
Date:: 
=:: 
x:: 
.:: 
Date:: 
,:: 
Description;; 
=;; 
x;; 
.;;  
Description;;  +
,;;+ ,
DepartmentId<< 
=<< 
x<<  
.<<  !
DepartmentId<<! -
,<<- .

FeedbackId== 
=== 
x== 
.== 

FeedbackId== )
,==) *
PatientFullName>> 
=>>  !
(>>" #
x>># $
.>>$ %
Patient>>% ,
==>>- /
null>>0 4
?>>5 6
$str>>7 B
:>>C D
x>>E F
.>>F G
Patient>>G N
.>>N O
Name>>O S
+>>T U
$str>>V Y
+>>Z [
x>>\ ]
.>>] ^
Patient>>^ e
.>>e f
Surname>>f m
)>>m n
,>>n o
PatientURLImage?? 
=??  !
(??" #
x??# $
.??$ %
Patient??% ,
==??- /
null??0 4
???5 6
	Constants??7 @
.??@ A

ThisServer??A K
+??L M
	Constants??N W
.??W X
DefaultPatientImage??X k
:??l m
	Constants??n w
.??w x

ThisServer	??x Ç
+
??É Ñ
x
??Ö Ü
.
??Ü á
Patient
??á é
.
??é è
URLImage
??è ó
)
??ó ò
}@@ 
)@@ 
;@@ 
ShortUserDtoBB 
HeadDepartmentBB '
=BB( )
nullBB* .
;BB. /
ifDD 
(DD 
docDD 
!=DD 
nullDD 
)DD 
{EE 
HeadDepartmentFF 
=FF  
newFF! $
ShortUserDtoFF% 1
{GG 
SurnameHH 
=HH 
docHH !
.HH! "
SurnameHH" )
,HH) *
NameII 
=II 
docII 
.II 
NameII #
,II# $
UserIdJJ 
=JJ 
docJJ  
.JJ  !
UserIdJJ! '
}KK 
;KK 
}LL 
varMM 
aMM 
=MM 
newMM 
DepartmentFullDtoMM )
{NN 
HeadDepartmentOO 
=OO  
HeadDepartmentOO! /
,OO/ 0
DepartmentIdPP 
=PP 

departmentPP )
.PP) *
DepartmentIdPP* 6
,PP6 7
DescriptionQQ 
=QQ 

departmentQQ (
.QQ( )
DescriptionQQ) 4
,QQ4 5
NameRR 
=RR 

departmentRR !
.RR! "
NameRR" &
,RR& '
	FeedbacksSS 
=SS 
allSS 
==SS  "
trueSS# '
?SS( )
	feedbacksSS* 3
.SS3 4
ToArraySS4 ;
(SS; <
)SS< =
:SS> ?
	feedbacksSS@ I
.SSI J
SkipSSJ N
(SSN O
MathSSO S
.SSS T
MaxSST W
(SSW X
$numSSX Y
,SSY Z

departmentSS[ e
.SSe f
	FeedbacksSSf o
.SSo p
CountSSp u
-SSv w
$numSSx y
)SSy z
)SSz {
.SS{ |
ToArray	SS| É
(
SSÉ Ñ
)
SSÑ Ö
,
SSÖ Ü
FeedbacksCountTT 
=TT  

departmentTT! +
.TT+ ,
	FeedbacksTT, 5
.TT5 6
CountTT6 ;
,TT; <
URLImageUU 
=UU 
	ConstantsUU $
.UU$ %

ThisServerUU% /
+UU0 1

departmentUU2 <
.UU< =
URLImageUU= E
}VV 
;VV 
returnWW 
OkWW 
(WW 
aWW 
)WW 
;WW 
}XX 	
[ZZ 	
RouteZZ	 
(ZZ 
$strZZ !
)ZZ! "
]ZZ" #
public[[ 
IEnumerable[[ 
<[[ 
	DoctorDto[[ $
>[[$ % 
GetDepartmentDoctors[[& :
([[: ;
int[[; >
id[[? A
)[[A B
{\\ 	
try]] 
{^^ 
return__ 
db__ 
.__ 
Doctors__ !
.__! "
Where__" '
(__' (
d__( )
=>__* ,
d__- .
.__. /
DepartmentId__/ ;
==__< >
id__? A
)__A B
.`` 
Select`` 
(`` 
x`` 
=>``  
newaa 
	DoctorDtoaa '
{bb 
UserIdcc $
=cc% &
xcc' (
.cc( )
UserIdcc) /
,cc/ 0
Namedd "
=dd# $
xdd% &
.dd& '
Namedd' +
,dd+ ,
Surnameee %
=ee& '
xee( )
.ee) *
Surnameee* 1
,ee1 2
DepartmentIdff *
=ff+ ,
(ff- .
xff. /
.ff/ 0

Departmentff0 :
!=ff; =
nullff> B
?ffC D
xffE F
.ffF G

DepartmentffG Q
.ffQ R
DepartmentIdffR ^
:ff_ `
defaultffa h
(ffh i
intffi l
)ffl m
)ffm n
,ffn o
DepartmentNamegg ,
=gg- .
(gg/ 0
xgg0 1
.gg1 2

Departmentgg2 <
!=gg= ?
nullgg@ D
?ggE F
xggG H
.ggH I

DepartmentggI S
.ggS T
NameggT X
:ggY Z
stringgg[ a
.gga b
Emptyggb g
)ggg h
,ggh i
Degreehh $
=hh% &
xhh' (
.hh( )
Degreehh) /
,hh/ 0
	Educationii '
=ii( )
xii* +
.ii+ ,
	Educationii, 5
,ii5 6
StartWorkingTimejj .
=jj/ 0
(jj1 2
xjj2 3
.jj3 4
Schedulejj4 <
!=jj= ?
nulljj@ D
?jjE F
xjjG H
.jjH I
SchedulejjI Q
.jjQ R
StartWorkingTimejjR b
:jjc d
defaultjje l
(jjl m
TimeSpanjjm u
)jju v
)jjv w
,jjw x
FinishWorkingTimekk /
=kk0 1
(kk2 3
xkk3 4
.kk4 5
Schedulekk5 =
!=kk> @
nullkkA E
?kkF G
xkkH I
.kkI J
SchedulekkJ R
.kkR S
FinishWorkingTimekkS d
:kke f
defaultkkg n
(kkn o
TimeSpankko w
)kkw x
)kkx y
,kky z
URLImagell &
=ll' (
	Constantsll) 2
.ll2 3

ThisServerll3 =
+ll> ?
xll@ A
.llA B
URLImagellB J
,llJ K
}mm 
)mm 
.mm 
ToArraymm $
(mm$ %
)mm% &
;mm& '
}nn 
catchoo 
(oo "
NullReferenceExceptionoo )
)oo) *
{pp 
returnqq 

Enumerableqq !
.qq! "
Emptyqq" '
<qq' (
	DoctorDtoqq( 1
>qq1 2
(qq2 3
)qq3 4
;qq4 5
}rr 
}ss 	
[vv 	
Routevv	 
(vv 
$strvv 
)vv 
]vv 
[ww 	
	Authorizeww	 
(ww 
Rolesww 
=ww 
Rolesww 
.ww 
Administratorww ,
)ww, -
]ww- .
publicxx 
IHttpActionResultxx  
PostDepartmentxx! /
(xx/ 0

Departmentxx0 :

departmentxx; E
)xxE F
{yy 	
ifzz 
(zz 
!zz 

ModelStatezz 
.zz 
IsValidzz #
)zz# $
{{{ 
return|| 

BadRequest|| !
(||! "

ModelState||" ,
)||, -
;||- .
}}} 
try~~ 
{ 
db
ÄÄ 
.
ÄÄ 
Departments
ÄÄ 
.
ÄÄ 
Add
ÄÄ "
(
ÄÄ" #

department
ÄÄ# -
)
ÄÄ- .
;
ÄÄ. /
db
ÅÅ 
.
ÅÅ 
SaveChanges
ÅÅ 
(
ÅÅ 
)
ÅÅ  
;
ÅÅ  !
}
ÇÇ 
catch
ÉÉ 
(
ÉÉ 
	Exception
ÉÉ 
)
ÉÉ 
{
ÑÑ 
return
ÖÖ !
InternalServerError
ÖÖ *
(
ÖÖ* +
)
ÖÖ+ ,
;
ÖÖ, -
}
ÜÜ 
return
áá 
Ok
áá 
(
áá 

department
áá  
.
áá  !
DepartmentId
áá! -
)
áá- .
;
áá. /
}
àà 	
[
ää 	
Route
ää	 
(
ää 
$str
ää 
)
ää 
]
ää 
[
ãã 	
	Authorize
ãã	 
(
ãã 
Roles
ãã 
=
ãã 
Roles
ãã 
.
ãã 
Administrator
ãã ,
)
ãã, -
]
ãã- .
public
åå 
IHttpActionResult
åå  
PatchDepartment
åå! 0
(
åå0 1
int
åå1 4
id
åå5 7
,
åå7 8
JsonPatchDocument
åå9 J
<
ååJ K

Department
ååK U
>
ååU V
	patchData
ååW `
)
åå` a
{
çç 	
var
éé 

department
éé 
=
éé 
db
éé 
.
éé  
Departments
éé  +
.
éé+ ,
Find
éé, 0
(
éé0 1
id
éé1 3
)
éé3 4
;
éé4 5
	patchData
êê 
.
êê 
ApplyTo
êê 
(
êê 

department
êê (
)
êê( )
;
êê) *
try
íí 
{
ìì 
db
îî 
.
îî 
SaveChanges
îî 
(
îî 
)
îî  
;
îî  !
}
ïï 
catch
ññ 
(
ññ )
DbEntityValidationException
ññ .
)
ññ. /
{
óó 
return
òò 

BadRequest
òò !
(
òò! "
)
òò" #
;
òò# $
}
ôô 
return
öö 
Ok
öö 
(
öö 
)
öö 
;
öö 
}
õõ 	
	protected
ùù 
override
ùù 
void
ùù 
Dispose
ùù  '
(
ùù' (
bool
ùù( ,
	disposing
ùù- 6
)
ùù6 7
{
ûû 	
if
üü 
(
üü 
	disposing
üü 
)
üü 
{
†† 
db
°° 
.
°° 
Dispose
°° 
(
°° 
)
°° 
;
°° 
}
¢¢ 
base
££ 
.
££ 
Dispose
££ 
(
££ 
	disposing
££ "
)
££" #
;
££# $
}
§§ 	
}
•• 
}¶¶ ›Ü
>H:\AlphaMedic\AlphaMedic\Rest\Controllers\DoctorsController.cs
	namespace 	
Rest
 
. 
Controllers 
{ 
[ 
RoutePrefix 
( 
$str 
) 
]  
public 

class 
DoctorsController "
:# $
ApiController% 2
{ 
private 
AlphaMedicContext !
db" $
=% &
new' *
AlphaMedicContext+ <
(< =
)= >
;> ?
public 
DoctorsController  
(  !
)! "
{# $
}% &
public 
DoctorsController  
(  !
AlphaMedicContext! 2
context3 :
): ;
{ 	
this 
. 
db 
= 
context 
; 
} 	
[ 	
Route	 
( 
$str 
) 
] 
public   
IHttpActionResult    
GetUsers  ! )
(  ) *
int  * -
page  . 2
=  3 4
$num  5 6
,  6 7
int  8 ;
itemsPerPage  < H
=  I J
$num  K M
,  M N
string  O U
sortBy  V \
=  ] ^
$str  _ i
,  i j
bool  k o
reverse  p w
=  x y
false  z 
,	   Ä
string
  Å á
search
  à é
=
  è ê
null
  ë ï
,
  ï ñ
int
  ó ö
?
  ö õ

department
  ú ¶
=
  ß ®
null
  © ≠
,
  ≠ Æ
bool
  Ø ≥
?
  ≥ ¥
isActive
  µ Ω
=
  æ ø
null
  ¿ ƒ
)
  ƒ ≈
{!! 	
var"" 
users"" 
="" 
db"" 
."" 
Doctors"" "
.""" #
Select""# )
("") *
x""* +
=>"", .
new""/ 2
	DoctorDto""3 <
{## 
UserId$$ 
=$$ 
x$$ 
.$$ 
UserId$$ !
,$$! "
DoctorId%% 
=%% 
x%% 
.%% 
UserId%% #
,%%# $
URLImage&& 
=&& 
	Constants&& $
.&&$ %

ThisServer&&% /
+&&0 1
x&&2 3
.&&3 4
URLImage&&4 <
,&&< =
Name'' 
='' 
x'' 
.'' 
Name'' 
,'' 
Surname(( 
=(( 
x(( 
.(( 
Surname(( #
,((# $
Degree)) 
=)) 
x)) 
.)) 
Degree)) !
,))! "
DepartmentId** 
=** 
x**  
.**  !
DepartmentId**! -
,**- .
	Education++ 
=++ 
x++ 
.++ 
	Education++ '
,++' (

DoctorType,, 
=,, 
x,, 
.,, 

DoctorType,, )
.,,) *
ToString,,* 2
(,,2 3
),,3 4
,,,4 5
DoctorTypeInt-- 
=-- 
x--  !
.--! "

DoctorType--" ,
,--, -
DepartmentName.. 
=..  
(..! "
x.." #
...# $

Department..$ .
!=../ 1
null..2 6
?..7 8
x..9 :
...: ;

Department..; E
...E F
Name..F J
:..K L
null..M Q
)..Q R
,..R S
Active// 
=// 
x// 
.// 
Active// !
}00 
)00 
;00 
if22 
(22 

department22 
!=22 
null22 "
)22" #
{33 
users44 
=44 
users44 
.44 
Where44 #
(44# $
x44$ %
=>44& (
x44) *
.44* +
DepartmentId44+ 7
==448 :

department44; E
)44E F
;44F G
}55 
if77 
(77 
isActive77 
!=77 
null77  
)77  !
{88 
users99 
=99 
users99 
.99 
Where99 #
(99# $
x99$ %
=>99& (
x99) *
.99* +
Active99+ 1
==992 4
isActive995 =
)99= >
;99> ?
}:: 
if<< 
(<< 
!<< 
string<< 
.<< 
IsNullOrWhiteSpace<< *
(<<* +
search<<+ 1
)<<1 2
)<<2 3
{== 
search>> 
=>> 
search>> 
.>>  
ToLower>>  '
(>>' (
)>>( )
;>>) *
users?? 
=?? 
users?? 
.?? 
Where?? #
(??# $
x??$ %
=>??& (
(@@ 
x@@ 
.@@ 
Name@@ 
+@@ 
x@@ 
.@@  
Surname@@  '
)@@' (
.@@( )
ToLower@@) 0
(@@0 1
)@@1 2
.@@2 3
Contains@@3 ;
(@@; <
search@@< B
.@@B C
Replace@@C J
(@@J K
$str@@K N
,@@N O
$str@@P R
)@@R S
)@@S T
||@@U W
(AA 
xAA 
.AA 
SurnameAA 
+AA  
xAA! "
.AA" #
NameAA# '
)AA' (
.AA( )
ToLowerAA) 0
(AA0 1
)AA1 2
.AA2 3
ContainsAA3 ;
(AA; <
searchAA< B
.AAB C
ReplaceAAC J
(AAJ K
$strAAK N
,AAN O
$strAAP R
)AAR S
)AAS T
)AAT U
;AAU V
}BB 
usersEE 
=EE 
usersEE 
.EE 
OrderByEE !
(EE! "
sortByEE" (
+EE) *
(EE+ ,
reverseEE, 3
?EE4 5
$strEE6 C
:EED E
$strEEF H
)EEH I
)EEI J
;EEJ K
varHH 

usersPagedHH 
=HH 
usersHH "
.HH" #
SkipHH# '
(HH' (
(HH( )
pageHH) -
-HH. /
$numHH0 1
)HH1 2
*HH3 4
itemsPerPageHH5 A
)HHA B
.HHB C
TakeHHC G
(HHG H
itemsPerPageHHH T
)HHT U
;HHU V
varKK 
jsonKK 
=KK 
newKK 
JsonDtoKK "
(KK" #
)KK# $
{LL 
countMM 
=MM 
usersMM 
.MM 
CountMM #
(MM# $
)MM$ %
,MM% &
dataNN 
=NN 

usersPagedNN !
.NN! "
ToArrayNN" )
(NN) *
)NN* +
}OO 
;OO 
returnQQ 
OkQQ 
(QQ 
jsonQQ 
)QQ 
;QQ 
}RR 	
[TT 	
HttpGetTT	 
]TT 
[UU 	
RouteUU	 
(UU 
$strUU #
)UU# $
]UU$ %
publicVV 
IHttpActionResultVV  
GetDurationsVV! -
(VV- .
intVV. 1
idVV2 4
)VV4 5
{WW 	
varXX 
	durationsXX 
=XX 
dbXX 
.XX 
AppointmentsXX +
.XX+ ,
WhereXX, 1
(XX1 2
xXX2 3
=>XX4 6
xYY 
.YY 
StateYY 
==YY 
AppointmentStateYY '
.YY' (
AcceptedYY( 0
&&YY1 3
xZZ 
.ZZ 
DoctorIdZZ 
==ZZ 
idZZ 
&&ZZ 
x[[ 
.[[ 
Date[[ 
>=[[ 
DateTime[[ 
.[[ 
Now[[ "
)\\ 
.\\ 
OrderBy\\ 
(\\ 
$str\\ 
)\\ 
;\\ 
var^^ 
durs^^ 
=^^ 
new^^ 
List^^ 
<^^  
object^^  &
>^^& '
(^^' (
)^^( )
;^^) *
foreach__ 
(__ 
var__ 
d__ 
in__  
	durations__! *
)__* +
{`` 
varaa 

finishTimeaa 
=aa  
daa! "
.aa" #
Dateaa# '
+aa( )
daa* +
.aa+ ,
Durationaa, 4
;aa4 5
dursbb 
.bb 
Addbb 
(bb 
newcc 
{dd 
Startee 
=ee 
dee  !
.ee! "
Dateee" &
,ee& '
Finishff 
=ff  

finishTimeff! +
}gg 
)hh 
;hh 
}ii 
returnjj 
Okjj 
(jj 
dursjj 
)jj 
;jj 
}kk 	
[oo 	
Routeoo	 
(oo 
$stroo "
)oo" #
]oo# $
publicpp 
IHttpActionResultpp  !
GetDoctorFromSchedulepp! 6
(pp6 7
intpp7 :
idpp; =
)pp= >
{qq 	
varss 
docss 
=ss 
dbss 
.ss 
Doctorsss  
.ss  !
FirstOrDefaultss! /
(ss/ 0
xss0 1
=>ss2 4
xss5 6
.ss6 7

ScheduleIdss7 A
==ssB D
idssE G
)ssG H
;ssH I
returntt 
Oktt 
(tt 
newtt 
{uu 
docvv 
.vv 
UserIdvv 
,vv 
FullNameww 
=ww 
docww 
.ww 
Nameww #
+ww$ %
$strww& )
+ww* +
docww, /
.ww/ 0
Surnameww0 7
,ww7 8
URLImagexx 
=xx 
	Constantsxx $
.xx$ %

ThisServerxx% /
+xx0 1
docxx2 5
.xx5 6
URLImagexx6 >
,xx> ?
docyy 
.yy 
Scheduleyy 
.yy 
StartWorkingTimeyy -
,yy- .
doczz 
.zz 
Schedulezz 
.zz 
FinishWorkingTimezz .
,zz. /
doc{{ 
.{{ 

ScheduleId{{ 
}|| 
)|| 
;|| 
}~~ 	
[
ÇÇ 	
Route
ÇÇ	 
(
ÇÇ 
$str
ÇÇ 
)
ÇÇ 
]
ÇÇ 
public
ÉÉ 
IHttpActionResult
ÉÉ  
	GetDoctor
ÉÉ! *
(
ÉÉ* +
int
ÉÉ+ .
id
ÉÉ/ 1
,
ÉÉ1 2
[
ÉÉ3 4
FromUri
ÉÉ4 ;
]
ÉÉ; <
bool
ÉÉ= A
all
ÉÉB E
=
ÉÉF G
true
ÉÉH L
)
ÉÉL M
{
ÑÑ 	
Doctor
ÖÖ 
doctor
ÖÖ 
=
ÖÖ 
db
ÖÖ 
.
ÖÖ 
Doctors
ÖÖ &
.
ÖÖ& '
FirstOrDefault
ÖÖ' 5
(
ÖÖ5 6
x
ÖÖ6 7
=>
ÖÖ8 :
x
ÖÖ; <
.
ÖÖ< =
UserId
ÖÖ= C
==
ÖÖD F
id
ÖÖG I
&&
ÖÖJ L
x
ÖÖM N
.
ÖÖN O
Active
ÖÖO U
!=
ÖÖV X
false
ÖÖY ^
)
ÖÖ^ _
;
ÖÖ_ `
if
ÜÜ 
(
ÜÜ 
doctor
ÜÜ 
==
ÜÜ 
null
ÜÜ 
)
ÜÜ 
{
áá 
return
àà 
NotFound
àà 
(
àà  
)
àà  !
;
àà! "
}
ââ 
var
ãã 
	feedbacks
ãã 
=
ãã 
doctor
ãã "
.
ãã" #
	Feedbacks
ãã# ,
.
ãã, -
Select
ãã- 3
(
ãã3 4
x
ãã4 5
=>
ãã6 8
new
ãã9 <
{
åå 
x
çç 
.
çç 
Date
çç 
,
çç 
x
éé 
.
éé 
Description
éé 
,
éé 
x
èè 
.
èè 
DoctorId
èè 
,
èè 
x
êê 
.
êê 

FeedbackId
êê 
,
êê 
PatientFullName
ëë 
=
ëë  !
(
íí 
x
íí 
.
íí 
Patient
íí 
==
íí 
null
íí "
?
íí# $
$str
íí% 0
:
íí1 2
x
íí3 4
.
íí4 5
Patient
íí5 <
.
íí< =
Name
íí= A
+
ííB C
$str
ííD G
+
ííH I
x
ííJ K
.
ííK L
Patient
ííL S
.
ííS T
Surname
ííT [
)
íí[ \
,
íí\ ]
PatientURLImage
ìì 
=
ìì  !
(
ìì" #
x
ìì# $
.
ìì$ %
Patient
ìì% ,
==
ìì- /
null
ìì0 4
?
ìì5 6
	Constants
ìì7 @
.
ìì@ A

ThisServer
ììA K
+
ììL M
	Constants
ììN W
.
ììW X!
DefaultPatientImage
ììX k
:
ììl m
	Constants
ììn w
.
ììw x

ThisServerììx Ç
+ììÉ Ñ
xììÖ Ü
.ììÜ á
Patientììá é
.ììé è
URLImageììè ó
)ììó ò
}
îî 
)
îî 
;
îî 
var
ññ 
res
ññ 
=
ññ 
new
ññ 
{
óó 
doctor
òò 
.
òò 
DepartmentId
òò #
,
òò# $
doctor
ôô 
.
ôô 
UserId
ôô 
,
ôô 
DepartmentName
öö 
=
öö  
doctor
öö! '
.
öö' (

Department
öö( 2
.
öö2 3
Name
öö3 7
,
öö7 8
doctor
õõ 
.
õõ 

ScheduleId
õõ !
,
õõ! "
doctor
úú 
.
úú 
FullName
úú 
,
úú  
doctor
ùù 
.
ùù 
Phone
ùù 
,
ùù 
doctor
ûû 
.
ûû 
Degree
ûû 
,
ûû 
doctor
üü 
.
üü 
	Education
üü  
,
üü  !

DoctorType
†† 
=
†† 
doctor
†† #
.
††# $

DoctorType
††$ .
.
††. /
ToString
††/ 7
(
††7 8
)
††8 9
,
††9 :
	Feedbacks
°° 
=
°° 
all
°° 
==
°°  "
true
°°# '
?
°°( )
	feedbacks
°°* 3
:
°°4 5
	feedbacks
°°6 ?
.
°°? @
Skip
°°@ D
(
°°D E
Math
°°E I
.
°°I J
Max
°°J M
(
°°M N
$num
°°N O
,
°°O P
doctor
°°Q W
.
°°W X
	Feedbacks
°°X a
.
°°a b
Count
°°b g
-
°°h i
$num
°°j k
)
°°k l
)
°°l m
,
°°m n
FeedbacksCount
¢¢ 
=
¢¢  
doctor
¢¢! '
.
¢¢' (
	Feedbacks
¢¢( 1
.
¢¢1 2
Count
¢¢2 7
,
¢¢7 8
Gender
££ 
=
££ 
doctor
££ 
.
££  
Gender
££  &
.
££& '
ToString
££' /
(
££/ 0
)
££0 1
,
££1 2
URLImage
§§ 
=
§§ 
	Constants
§§ $
.
§§$ %

ThisServer
§§% /
+
§§0 1
doctor
§§2 8
.
§§8 9
URLImage
§§9 A
,
§§A B
doctor
•• 
.
•• 
Schedule
•• 
.
••  
StartWorkingTime
••  0
,
••0 1
doctor
¶¶ 
.
¶¶ 
Schedule
¶¶ 
.
¶¶  
FinishWorkingTime
¶¶  1
}
ßß 
;
ßß 
return
©© 
Ok
©© 
(
©© 
res
©© 
)
©© 
;
©© 
}
™™ 	
[
≠≠ 	
Route
≠≠	 
(
≠≠ 
$str
≠≠ &
)
≠≠& '
]
≠≠' (
[
ÆÆ 	
	Authorize
ÆÆ	 
(
ÆÆ 
Roles
ÆÆ 
=
ÆÆ 
Roles
ÆÆ  
.
ÆÆ  !

AllDoctors
ÆÆ! +
+
ÆÆ, -
$str
ÆÆ. 1
+
ÆÆ2 3
Roles
ÆÆ4 9
.
ÆÆ9 :
Receptionist
ÆÆ: F
)
ÆÆF G
]
ÆÆG H
public
ØØ 
IHttpActionResult
ØØ   
GetAppointmentList
ØØ! 3
(
ØØ3 4
int
ØØ4 7
id
ØØ8 :
)
ØØ: ;
{
∞∞ 	
Doctor
±± 
doctor
±± 
=
±± 
db
±± 
.
±± 
Doctors
±± &
.
±±& '
FirstOrDefault
±±' 5
(
±±5 6
x
±±6 7
=>
±±8 :
x
±±; <
.
±±< =
UserId
±±= C
==
±±D F
id
±±G I
)
±±I J
;
±±J K
if
≤≤ 
(
≤≤ 
doctor
≤≤ 
==
≤≤ 
null
≤≤ 
)
≤≤ 
{
≥≥ 
return
¥¥ 
NotFound
¥¥ 
(
¥¥  
)
¥¥  !
;
¥¥! "
}
µµ 
var
∂∂ 
res
∂∂ 
=
∂∂ 
new
∂∂ 
{
∑∑ 
doctor
∏∏ 
.
∏∏ 
UserId
∏∏ 
,
∏∏ 
doctor
ππ 
.
ππ 

ScheduleId
ππ !
,
ππ! "
doctor
∫∫ 
.
∫∫ 
Name
∫∫ 
,
∫∫ 
doctor
ªª 
.
ªª 
Surname
ªª 
,
ªª 
doctor
ºº 
.
ºº 
Gender
ºº 
,
ºº 
doctor
ΩΩ 
.
ΩΩ 
DateOfBirth
ΩΩ "
,
ΩΩ" #
doctor
ææ 
.
ææ 
Address
ææ 
,
ææ 
doctor
øø 
.
øø 
Phone
øø 
,
øø 
doctor
¿¿ 
.
¿¿ 
DepartmentId
¿¿ #
,
¿¿# $
doctor
¡¡ 
.
¡¡ 

DoctorType
¡¡ !
,
¡¡! "
URLImage
¬¬ 
=
¬¬ 
	Constants
¬¬ $
.
¬¬$ %

ThisServer
¬¬% /
+
¬¬0 1
doctor
¬¬2 8
.
¬¬8 9
URLImage
¬¬9 A
,
¬¬A B
Appointments
ƒƒ 
=
ƒƒ 
db
ƒƒ !
.
ƒƒ! "
Appointments
ƒƒ" .
.
ƒƒ. /
Where
ƒƒ/ 4
(
ƒƒ4 5
x
ƒƒ5 6
=>
ƒƒ7 9
x
ƒƒ: ;
.
ƒƒ; <
DoctorId
ƒƒ< D
==
ƒƒE G
id
ƒƒH J
&&
ƒƒK M
x
ƒƒN O
.
ƒƒO P
State
ƒƒP U
==
ƒƒV X
AppointmentState
ƒƒY i
.
ƒƒi j
Accepted
ƒƒj r
)
ƒƒr s
.
ƒƒs t
Select
ƒƒt z
(
ƒƒz {
a
ƒƒ{ |
=>
ƒƒ} 
newƒƒÄ É
{
≈≈ 
a
«« 
.
«« 
AppointmentId
«« #
,
««# $
PatientFullName
»» #
=
»»$ %
a
»»& '
.
»»' (
Patient
»»( /
.
»»/ 0
Name
»»0 4
+
»»5 6
$str
»»7 :
+
»»; <
a
»»= >
.
»»> ?
Patient
»»? F
.
»»F G
Surname
»»G N
,
»»N O
a
…… 
.
…… 
	PatientId
…… 
,
……  
a
   
.
   
Date
   
,
   
a
ÀÀ 
.
ÀÀ 
Duration
ÀÀ 
,
ÀÀ 
State
ÃÃ 
=
ÃÃ 
a
ÃÃ 
.
ÃÃ 
State
ÃÃ #
==
ÃÃ$ &
$num
ÃÃ' (
?
ÃÃ) *
$str
ÃÃ+ 8
:
ÃÃ9 :
$str
ÃÃ; E
}
ÕÕ 
)
ÕÕ 
}
ŒŒ 
;
ŒŒ 
res
–– 
.
–– 
Appointments
–– 
.
–– 
OrderByDescending
–– .
(
––. /
x
––/ 0
=>
––1 3
x
––4 5
.
––5 6
Date
––6 :
)
––: ;
;
––; <
return
—— 
Ok
—— 
(
—— 
res
—— 
)
—— 
;
—— 
}
”” 	
[
÷÷ 	
Route
÷÷	 
(
÷÷ 
$str
÷÷ 
)
÷÷ 
]
÷÷ 
[
◊◊ 	
ResponseType
◊◊	 
(
◊◊ 
typeof
◊◊ 
(
◊◊ 
void
◊◊ !
)
◊◊! "
)
◊◊" #
]
◊◊# $
public
ÿÿ 
IHttpActionResult
ÿÿ  
	PutDoctor
ÿÿ! *
(
ÿÿ* +
int
ÿÿ+ .
id
ÿÿ/ 1
,
ÿÿ1 2
Doctor
ÿÿ3 9
doctor
ÿÿ: @
)
ÿÿ@ A
{
ŸŸ 	
if
⁄⁄ 
(
⁄⁄ 
!
⁄⁄ 

ModelState
⁄⁄ 
.
⁄⁄ 
IsValid
⁄⁄ #
)
⁄⁄# $
{
€€ 
return
‹‹ 

BadRequest
‹‹ !
(
‹‹! "

ModelState
‹‹" ,
)
‹‹, -
;
‹‹- .
}
›› 
if
ﬂﬂ 
(
ﬂﬂ 
id
ﬂﬂ 
!=
ﬂﬂ 
doctor
ﬂﬂ 
.
ﬂﬂ 
UserId
ﬂﬂ #
)
ﬂﬂ# $
{
‡‡ 
return
·· 

BadRequest
·· !
(
··! "
)
··" #
;
··# $
}
‚‚ 
db
‰‰ 
.
‰‰ 
Entry
‰‰ 
(
‰‰ 
doctor
‰‰ 
)
‰‰ 
.
‰‰ 
State
‰‰ "
=
‰‰# $
EntityState
‰‰% 0
.
‰‰0 1
Modified
‰‰1 9
;
‰‰9 :
try
ÊÊ 
{
ÁÁ 
db
ËË 
.
ËË 
SaveChanges
ËË 
(
ËË 
)
ËË  
;
ËË  !
}
ÈÈ 
catch
ÍÍ 
(
ÍÍ *
DbUpdateConcurrencyException
ÍÍ /
)
ÍÍ/ 0
{
ÎÎ 
if
ÏÏ 
(
ÏÏ 
!
ÏÏ 
DoctorExists
ÏÏ !
(
ÏÏ! "
id
ÏÏ" $
)
ÏÏ$ %
)
ÏÏ% &
{
ÌÌ 
return
ÓÓ 
NotFound
ÓÓ #
(
ÓÓ# $
)
ÓÓ$ %
;
ÓÓ% &
}
ÔÔ 
else
 
{
ÒÒ 
throw
ÚÚ 
;
ÚÚ 
}
ÛÛ 
}
ÙÙ 
return
ˆˆ 

StatusCode
ˆˆ 
(
ˆˆ 
HttpStatusCode
ˆˆ ,
.
ˆˆ, -
	NoContent
ˆˆ- 6
)
ˆˆ6 7
;
ˆˆ7 8
}
˜˜ 	
[
˘˘ 	
HttpPut
˘˘	 
]
˘˘ 
[
˙˙ 	
Route
˙˙	 
(
˙˙ 
$str
˙˙ .
)
˙˙. /
]
˙˙/ 0
[
˚˚ 	
ResponseType
˚˚	 
(
˚˚ 
typeof
˚˚ 
(
˚˚ 
void
˚˚ !
)
˚˚! "
)
˚˚" #
]
˚˚# $
[
¸¸ 	
	Authorize
¸¸	 
(
¸¸ 
Roles
¸¸ 
=
¸¸ 
Roles
¸¸  
.
¸¸  !
Receptionist
¸¸! -
)
¸¸- .
]
¸¸. /
public
˝˝ 
IHttpActionResult
˝˝  
PutWorkingHours
˝˝! 0
(
˝˝0 1
int
˝˝1 4
id
˝˝5 7
,
˝˝7 8
Schedule
˝˝9 A
schedule
˝˝B J
)
˝˝J K
{
˛˛ 	
if
ˇˇ 
(
ˇˇ 
!
ˇˇ 

ModelState
ˇˇ 
.
ˇˇ 
IsValid
ˇˇ #
)
ˇˇ# $
{
ÄÄ 
return
ÅÅ 

BadRequest
ÅÅ !
(
ÅÅ! "

ModelState
ÅÅ" ,
)
ÅÅ, -
;
ÅÅ- .
}
ÇÇ 
if
ÑÑ 
(
ÑÑ 
id
ÑÑ 
!=
ÑÑ 
schedule
ÑÑ 
.
ÑÑ 

ScheduleId
ÑÑ )
)
ÑÑ) *
{
ÖÖ 
return
ÜÜ 

BadRequest
ÜÜ !
(
ÜÜ! "
)
ÜÜ" #
;
ÜÜ# $
}
áá 
db
ââ 
.
ââ 
Entry
ââ 
(
ââ 
schedule
ââ 
)
ââ 
.
ââ 
State
ââ $
=
ââ% &
EntityState
ââ' 2
.
ââ2 3
Modified
ââ3 ;
;
ââ; <
try
ãã 
{
åå 
db
çç 
.
çç 
SaveChanges
çç 
(
çç 
)
çç  
;
çç  !
}
éé 
catch
èè 
(
èè *
DbUpdateConcurrencyException
èè /
)
èè/ 0
{
êê 
if
ëë 
(
ëë 
!
ëë 
DoctorExists
ëë !
(
ëë! "
id
ëë" $
)
ëë$ %
)
ëë% &
{
íí 
return
ìì 
NotFound
ìì #
(
ìì# $
)
ìì$ %
;
ìì% &
}
îî 
else
ïï 
{
ññ 
throw
óó 
;
óó 
}
òò 
}
ôô 
return
õõ 

StatusCode
õõ 
(
õõ 
HttpStatusCode
õõ ,
.
õõ, -
	NoContent
õõ- 6
)
õõ6 7
;
õõ7 8
}
úú 	
[
ûû 	
Route
ûû	 
(
ûû 
$str
ûû 
)
ûû 
]
ûû 
[
†† 	
ResponseType
††	 
(
†† 
typeof
†† 
(
†† 
Doctor
†† #
)
††# $
)
††$ %
]
††% &
public
°° 
IHttpActionResult
°°  

PostDoctor
°°! +
(
°°+ ,
Doctor
°°, 2
doctor
°°3 9
)
°°9 :
{
¢¢ 	
if
££ 
(
££ 
!
££ 

ModelState
££ 
.
££ 
IsValid
££ #
||
££$ &
(
££' (
db
££( *
.
££* +
Users
££+ 0
.
££0 1
FirstOrDefault
££1 ?
(
££? @
x
££@ A
=>
££B D
x
££E F
.
££F G
Email
££G L
==
££M O
doctor
££P V
.
££V W
Email
££W \
)
££\ ]
!=
££^ `
null
££a e
)
££e f
)
££f g
{
§§ 
return
•• 

BadRequest
•• !
(
••! "

ModelState
••" ,
)
••, -
;
••- .
}
¶¶ 
Schedule
®® 
schedule
®® 
=
®® 
new
®®  #
Schedule
®®$ ,
(
®®, -
)
®®- .
{
©© 
StartWorkingTime
™™  
=
™™! "
TimeSpan
™™# +
.
™™+ ,
	FromHours
™™, 5
(
™™5 6
$num
™™6 7
)
™™7 8
,
™™8 9
FinishWorkingTime
´´ !
=
´´" #
TimeSpan
´´$ ,
.
´´, -
	FromHours
´´- 6
(
´´6 7
$num
´´7 8
)
´´8 9
}
≠≠ 
;
≠≠ 
try
ÆÆ 
{
ØØ 
db
±± 
.
±± 
	Schedules
±± 
.
±± 
Add
±±  
(
±±  !
schedule
±±! )
)
±±) *
;
±±* +
db
≤≤ 
.
≤≤ 
SaveChanges
≤≤ 
(
≤≤ 
)
≤≤  
;
≤≤  !
doctor
¥¥ 
.
¥¥ 

ScheduleId
¥¥ !
=
¥¥" #
schedule
¥¥$ ,
.
¥¥, -

ScheduleId
¥¥- 7
;
¥¥7 8
var
∂∂ 
type
∂∂ 
=
∂∂ 
doctor
∂∂ !
.
∂∂! "
EmployeeType
∂∂" .
.
∂∂. /
ToString
∂∂/ 7
(
∂∂7 8
)
∂∂8 9
;
∂∂9 :
doctor
∏∏ 
.
∏∏ 
	UserClaim
∏∏  
=
∏∏! "
db
∏∏# %
.
∏∏% &

UserClaims
∏∏& 0
.
∏∏0 1
FirstOrDefault
∏∏1 ?
(
∏∏? @
x
∏∏@ A
=>
∏∏B D
x
∏∏E F
.
∏∏F G

ClaimValue
∏∏G Q
==
∏∏R T
type
∏∏U Y
)
∏∏Y Z
;
∏∏Z [
doctor
∫∫ 
.
∫∫ 
EmploymentDate
∫∫ %
=
∫∫& '
DateTime
∫∫( 0
.
∫∫0 1
Now
∫∫1 4
;
∫∫4 5
doctor
ºº 
.
ºº 
URLImage
ºº 
=
ºº  !
	Constants
ºº" +
.
ºº+ , 
DefaultDoctorImage
ºº, >
;
ºº> ?
db
ææ 
.
ææ 
Doctors
ææ 
.
ææ 
Add
ææ 
(
ææ 
doctor
ææ %
)
ææ% &
;
ææ& '
db
¿¿ 
.
¿¿ 
SaveChanges
¿¿ 
(
¿¿ 
)
¿¿  
;
¿¿  !
}
¡¡ 
catch
¬¬ 
(
¬¬ *
DbUpdateConcurrencyException
¬¬ /
ex
¬¬0 2
)
¬¬2 3
{
√√ 
return
ƒƒ !
InternalServerError
ƒƒ *
(
ƒƒ* +
ex
ƒƒ+ -
)
ƒƒ- .
;
ƒƒ. /
}
≈≈ 
return
«« 
Ok
«« 
(
«« 
)
«« 
;
«« 
}
»» 	
[
   	
Route
  	 
(
   
$str
   
)
   
]
   
public
ÀÀ 
IHttpActionResult
ÀÀ  
PatchActiveState
ÀÀ! 1
(
ÀÀ1 2
int
ÀÀ2 5
id
ÀÀ6 8
,
ÀÀ8 9
JsonPatchDocument
ÀÀ: K
<
ÀÀK L
Doctor
ÀÀL R
>
ÀÀR S
	patchData
ÀÀT ]
)
ÀÀ] ^
{
ÃÃ 	
var
ÕÕ 
doctor
ÕÕ 
=
ÕÕ 
db
ÕÕ 
.
ÕÕ 
Doctors
ÕÕ #
.
ÕÕ# $
Find
ÕÕ$ (
(
ÕÕ( )
id
ÕÕ) +
)
ÕÕ+ ,
;
ÕÕ, -
	patchData
œœ 
.
œœ 
ApplyTo
œœ 
(
œœ 
doctor
œœ $
)
œœ$ %
;
œœ% &
if
—— 
(
—— 
doctor
—— 
.
—— 

DoctorType
—— !
==
——" $

DoctorType
——% /
.
——/ 0
HeadDepartment
——0 >
)
——> ?
{
““ 
var
”” 
headDoc
”” 
=
”” 
db
””  
.
””  !
Doctors
””! (
.
””( )
Where
””) .
(
””. /
x
””/ 0
=>
””1 3
(
””4 5
x
””5 6
.
””6 7
DepartmentId
””7 C
==
””D F
doctor
””G M
.
””M N
DepartmentId
””N Z
&&
””[ ]
x
””^ _
.
””_ `

DoctorType
””` j
==
””k m

DoctorType
””n x
.
””x y
HeadDepartment””y á
)””á à
)””à â
.””â ä
FirstOrDefault””ä ò
(””ò ô
)””ô ö
;””ö õ
if
‘‘ 
(
‘‘ 
headDoc
‘‘ 
!=
‘‘ 
null
‘‘ #
&&
‘‘$ &
headDoc
‘‘' .
.
‘‘. /
UserId
‘‘/ 5
!=
‘‘6 8
doctor
‘‘9 ?
.
‘‘? @
UserId
‘‘@ F
)
‘‘F G
{
’’ 
return
÷÷ 

BadRequest
÷÷ %
(
÷÷% &
$str
÷÷& I
)
÷÷I J
;
÷÷J K
}
◊◊ 
}
ÿÿ 
try
⁄⁄ 
{
€€ 
db
‹‹ 
.
‹‹ 
SaveChanges
‹‹ 
(
‹‹ 
)
‹‹  
;
‹‹  !
}
›› 
catch
ﬁﬁ 
(
ﬁﬁ )
DbEntityValidationException
ﬁﬁ .
e
ﬁﬁ/ 0
)
ﬁﬁ0 1
{
ﬂﬂ 
string
‡‡ 
s
‡‡ 
=
‡‡ 
$str
‡‡ 
;
‡‡ 
foreach
·· 
(
·· 
var
·· 
eve
··  
in
··! #
e
··$ %
.
··% &$
EntityValidationErrors
··& <
)
··< =
{
‚‚ 
s
„„ 
+=
„„ 
String
„„ 
.
„„  
Format
„„  &
(
„„& '
$str
„„' u
,
„„u v
eve
‰‰ 
.
‰‰ 
Entry
‰‰ "
.
‰‰" #
Entity
‰‰# )
.
‰‰) *
GetType
‰‰* 1
(
‰‰1 2
)
‰‰2 3
.
‰‰3 4
Name
‰‰4 8
,
‰‰8 9
eve
‰‰: =
.
‰‰= >
Entry
‰‰> C
.
‰‰C D
State
‰‰D I
)
‰‰I J
;
‰‰J K
foreach
ÂÂ 
(
ÂÂ 
var
ÂÂ  
ve
ÂÂ! #
in
ÂÂ$ &
eve
ÂÂ' *
.
ÂÂ* +
ValidationErrors
ÂÂ+ ;
)
ÂÂ; <
{
ÊÊ 
s
ÁÁ 
+=
ÁÁ 
String
ÁÁ #
.
ÁÁ# $
Format
ÁÁ$ *
(
ÁÁ* +
$str
ÁÁ+ P
,
ÁÁP Q
ve
ËË 
.
ËË 
PropertyName
ËË +
,
ËË+ ,
ve
ËË- /
.
ËË/ 0
ErrorMessage
ËË0 <
)
ËË< =
;
ËË= >
}
ÈÈ 
}
ÍÍ 
return
ÏÏ 

BadRequest
ÏÏ !
(
ÏÏ! "
s
ÏÏ" #
)
ÏÏ# $
;
ÏÏ$ %
}
ÌÌ 
catch
ÓÓ 
(
ÓÓ 
	Exception
ÓÓ 
ex
ÓÓ 
)
ÓÓ  
{
ÔÔ 
return
 !
InternalServerError
 *
(
* +
)
+ ,
;
, -
}
ÒÒ 
return
ÚÚ 
Ok
ÚÚ 
(
ÚÚ 
)
ÚÚ 
;
ÚÚ 
}
ÙÙ 	
	protected
ÜÜ 
override
ÜÜ 
void
ÜÜ 
Dispose
ÜÜ  '
(
ÜÜ' (
bool
ÜÜ( ,
	disposing
ÜÜ- 6
)
ÜÜ6 7
{
áá 	
if
àà 
(
àà 
	disposing
àà 
)
àà 
{
ââ 
db
ää 
.
ää 
Dispose
ää 
(
ää 
)
ää 
;
ää 
}
ãã 
base
åå 
.
åå 
Dispose
åå 
(
åå 
	disposing
åå "
)
åå" #
;
åå# $
}
çç 	
private
èè 
bool
èè 
DoctorExists
èè !
(
èè! "
int
èè" %
id
èè& (
)
èè( )
{
êê 	
return
ëë 
db
ëë 
.
ëë 
Users
ëë 
.
ëë 
Count
ëë !
(
ëë! "
e
ëë" #
=>
ëë$ &
e
ëë' (
.
ëë( )
UserId
ëë) /
==
ëë0 2
id
ëë3 5
)
ëë5 6
>
ëë7 8
$num
ëë9 :
;
ëë: ;
}
íí 	
}
ìì 
}îî Àg
@H:\AlphaMedic\AlphaMedic\Rest\Controllers\EmployeesController.cs
	namespace 	
Rest
 
. 
Controllers 
{ 
[ 
RoutePrefix 
( 
$str  
)  !
]! "
public 

class 
EmployeesController $
:% &
ApiController' 4
{ 
private 
AlphaMedicContext !
db" $
=% &
new' *
AlphaMedicContext+ <
(< =
)= >
;> ?
[ 	
Route	 
( 
$str 
) 
] 
[ 	
	Authorize	 
( 
Roles 
= 
Roles  
.  !
Administrator! .
). /
]/ 0
public 
IHttpActionResult  
GetEmployees! -
(- .
). /
{ 	
var 
res 
= 
db 
. 
	Employees "
." #
Select# )
() *
x* +
=>, .
new/ 2
{ 
x 
. 
UserId 
, 
x   
.   
Name   
,   
x!! 
.!! 
Surname!! 
,!! 
x"" 
."" 
DateOfBirth"" 
,"" 
x## 
.## 
Phone## 
,## 
x$$ 
.$$ 
Email$$ 
,$$ 
x%% 
.%% 
Address%% 
,%% 
x&& 
.&& &
EmploymentRecordBookNumber&& ,
,&&, -
EmployeeType'' 
='' 
x''  
.''  !
EmployeeType''! -
.''- .
ToString''. 6
(''6 7
)''7 8
,''8 9
x(( 
.(( 
Active(( 
})) 
))) 
;)) 
return++ 
Ok++ 
(++ 
res++ 
)++ 
;++ 
},, 	
[// 	
Route//	 
(// 
$str// 
)// 
]// 
[00 	
	Authorize00	 
(00 
Roles00 
=00 
Roles00 
.00 
Administrator00 ,
)00, -
]00- .
public11 
IHttpActionResult11  
GetEmployee11! ,
(11, -
int11- 0
id111 3
)113 4
{22 	
var33 
employee33 
=33 
db33 
.33 
	Employees33 '
.33' (
FirstOrDefault33( 6
(336 7
x337 8
=>339 ;
x33< =
.33= >
UserId33> D
==33E G
id33H J
)33J K
;33K L
if44 
(44 
employee44 
==44 
null44  
)44  !
{55 
return66 
NotFound66 
(66  
)66  !
;66! "
}77 
var99 
res99 
=99 
new99 
{:: 
employee;; 
.;; 
UserId;; 
,;;  
employee<< 
.<< 
Name<< 
,<< 
employee== 
.== 
Surname==  
,==  !
employee>> 
.>> 
EmployeeType>> %
,>>% &
employee?? 
.?? 
Active?? 
,??  
URLImage@@ 
=@@ 
	Constants@@ $
.@@$ %

ThisServer@@% /
+@@0 1
employee@@2 :
.@@: ;
URLImage@@; C
}AA 
;AA 
returnCC 
OkCC 
(CC 
resCC 
)CC 
;CC 
}DD 	
[II 	
RouteII	 
(II 
$strII 
)II 
]II 
[JJ 	
	AuthorizeJJ	 
(JJ 
RolesJJ 
=JJ 
RolesJJ  
.JJ  !
AdministratorJJ! .
)JJ. /
]JJ/ 0
[KK 	
ResponseTypeKK	 
(KK 
typeofKK 
(KK 
voidKK !
)KK! "
)KK" #
]KK# $
publicLL 
IHttpActionResultLL  
PutEmployeeLL! ,
(LL, -
intLL- 0
idLL1 3
,LL3 4
EmployeeDtoLL5 @
employeeDtoLLA L
)LLL M
{MM 
ifOO 
(OO 
!OO 

ModelStateOO 
.OO 
IsValidOO #
)OO# $
{PP 
returnQQ 

BadRequestQQ !
(QQ! "

ModelStateQQ" ,
)QQ, -
;QQ- .
}RR 
ifTT 
(TT 
idTT 
!=TT 
employeeDtoTT "
.TT" #
UserIdTT# )
)TT) *
{UU 
returnVV 

BadRequestVV !
(VV! "
)VV" #
;VV# $
}WW 
varYY 
empYY 
=YY 
dbYY 
.YY 
	EmployeesYY  
.YY  !
FindYY! %
(YY% &
employeeDtoYY& 1
.YY1 2
UserIdYY2 8
)YY8 9
;YY9 :
var[[ 
elm[[ 
=[[ 
db[[ 
.[[ 
Users[[ 
.[[ 
FirstOrDefault[[ -
([[- .
x[[. /
=>[[0 2
x[[3 4
.[[4 5
Email[[5 :
==[[; =
employeeDto[[> I
.[[I J
Email[[J O
)[[O P
;[[P Q
if\\ 
(\\ 
elm\\ 
!=\\ 
null\\ 
&&\\ 
elm\\ "
.\\" #
UserId\\# )
!=\\* ,
id\\- /
)\\/ 0
{]] 
return^^ 

BadRequest^^ !
(^^! "
$str^^" <
)^^< =
;^^= >
}__ 
employeeDtoaa 
.aa 
UpateEmployeeaa %
(aa% &
empaa& )
)aa) *
;aa* +
dbcc 
.cc 
Entrycc 
(cc 
empcc 
)cc 
.cc 
Statecc 
=cc  !
EntityStatecc" -
.cc- .
Modifiedcc. 6
;cc6 7
tryee 
{ff 
dbgg 
.gg 
SaveChangesgg 
(gg 
)gg  
;gg  !
}hh 
catchii 
(ii (
DbUpdateConcurrencyExceptionii /
)ii/ 0
{jj 
returnkk 
InternalServerErrorkk *
(kk* +
)kk+ ,
;kk, -
}ll 
catchmm 
(mm 
	Exceptionmm 
)mm 
{nn 
returnoo 
InternalServerErroroo *
(oo* +
)oo+ ,
;oo, -
}pp 
returnrr 
Okrr 
(rr 
)rr 
;rr 
}ss 	
[ww 	
	Authorizeww	 
(ww 
Rolesww 
=ww 
Rolesww  
.ww  !
Administratorww! .
)ww. /
]ww/ 0
[xx 	
Routexx	 
(xx 
$strxx 
)xx  
]xx  !
[yy 	
ResponseTypeyy	 
(yy 
typeofyy 
(yy 
Administratoryy *
)yy* +
)yy+ ,
]yy, -
publiczz 
IHttpActionResultzz  
PostAdministratorzz! 2
(zz2 3
Administratorzz3 @
employeezzA I
)zzI J
{{{ 	
if|| 
(|| 
!|| 

ModelState|| 
.|| 
IsValid|| #
||||$ &
(||' (
db||( *
.||* +
Users||+ 0
.||0 1
FirstOrDefault||1 ?
(||? @
x||@ A
=>||B D
x||E F
.||F G
Email||G L
==||M O
employee||P X
.||X Y
Email||Y ^
)||^ _
!=||` b
null||c g
)||g h
)||h i
{}} 
return~~ 

BadRequest~~ !
(~~! "

ModelState~~" ,
)~~, -
;~~- .
} 
try
ÅÅ 
{
ÇÇ 
FillEmploye
ÉÉ 
(
ÉÉ 
employee
ÉÉ $
)
ÉÉ$ %
;
ÉÉ% &
db
ÖÖ 
.
ÖÖ 
Users
ÖÖ 
.
ÖÖ 
Add
ÖÖ 
(
ÖÖ 
employee
ÖÖ %
)
ÖÖ% &
;
ÖÖ& '
db
áá 
.
áá 
SaveChanges
áá 
(
áá 
)
áá  
;
áá  !
return
àà 
Ok
àà 
(
àà 
)
àà 
;
àà 
}
ââ 
catch
ää 
(
ää 
	Exception
ää 
ex
ää 
)
ää  
{
ãã 
return
åå !
InternalServerError
åå *
(
åå* +
ex
åå+ -
)
åå- .
;
åå. /
}
çç 
}
éé 	
[
ëë 	
	Authorize
ëë	 
(
ëë 
Roles
ëë 
=
ëë 
Roles
ëë 
.
ëë  
Administrator
ëë  -
)
ëë- .
]
ëë. /
[
íí 	
Route
íí	 
(
íí 
$str
íí 
)
íí 
]
íí  
[
ìì 	
ResponseType
ìì	 
(
ìì 
typeof
ìì 
(
ìì 
Receptionist
ìì )
)
ìì) *
)
ìì* +
]
ìì+ ,
public
îî 
IHttpActionResult
îî  
PostReceptionist
îî! 1
(
îî1 2
Receptionist
îî2 >
employee
îî? G
)
îîG H
{
ïï 	
if
ññ 
(
ññ 
!
ññ 

ModelState
ññ 
.
ññ 
IsValid
ññ #
||
ññ# %
(
ññ& '
db
ññ' )
.
ññ) *
Users
ññ* /
.
ññ/ 0
FirstOrDefault
ññ0 >
(
ññ> ?
x
ññ? @
=>
ññA C
x
ññD E
.
ññE F
Email
ññF K
==
ññL N
employee
ññO W
.
ññW X
Email
ññX ]
)
ññ] ^
!=
ññ_ a
null
ññb f
)
ññf g
)
ññg h
{
óó 
return
òò 

BadRequest
òò !
(
òò! "

ModelState
òò" ,
)
òò, -
;
òò- .
}
ôô 
try
õõ 
{
úú 
FillEmploye
ùù 
(
ùù 
employee
ùù $
)
ùù$ %
;
ùù% &
db
üü 
.
üü 
Users
üü 
.
üü 
Add
üü 
(
üü 
employee
üü %
)
üü% &
;
üü& '
db
°° 
.
°° 
SaveChanges
°° 
(
°° 
)
°°  
;
°°  !
return
££ 
Ok
££ 
(
££ 
)
££ 
;
££ 
}
§§ 
catch
•• 
(
•• 
	Exception
•• 
ex
•• 
)
••  
{
¶¶ 
return
ßß !
InternalServerError
ßß *
(
ßß* +
ex
ßß+ -
)
ßß- .
;
ßß. /
}
®® 
}
©© 	
private
¨¨ 
void
¨¨ 
FillEmploye
¨¨  
(
¨¨  !
Employee
¨¨! )
employee
¨¨* 2
)
¨¨2 3
{
≠≠ 	
employee
ÆÆ 
.
ÆÆ 
	UserClaim
ÆÆ 
=
ÆÆ  
db
ÆÆ! #
.
ÆÆ# $

UserClaims
ÆÆ$ .
.
ÆÆ. /
FirstOrDefault
ÆÆ/ =
(
ÆÆ= >
x
ÆÆ> ?
=>
ÆÆ@ B
x
ÆÆC D
.
ÆÆD E

ClaimValue
ÆÆE O
==
ÆÆP R
employee
ÆÆS [
.
ÆÆ[ \
EmployeeType
ÆÆ\ h
.
ÆÆh i
ToString
ÆÆi q
(
ÆÆq r
)
ÆÆr s
)
ÆÆs t
;
ÆÆt u
employee
ØØ 
.
ØØ 
EmploymentDate
ØØ #
=
ØØ$ %
DateTime
ØØ& .
.
ØØ. /
Now
ØØ/ 2
;
ØØ2 3
employee
∞∞ 
.
∞∞ 
URLImage
∞∞ 
=
∞∞ 
	Constants
∞∞  )
.
∞∞) * 
DefaultDoctorImage
∞∞* <
;
∞∞< =
}
±± 	
	protected
√√ 
override
√√ 
void
√√ 
Dispose
√√  '
(
√√' (
bool
√√( ,
	disposing
√√- 6
)
√√6 7
{
ƒƒ 	
if
≈≈ 
(
≈≈ 
	disposing
≈≈ 
)
≈≈ 
{
∆∆ 
db
«« 
.
«« 
Dispose
«« 
(
«« 
)
«« 
;
«« 
}
»» 
base
…… 
.
…… 
Dispose
…… 
(
…… 
	disposing
…… "
)
……" #
;
……# $
}
   	
private
ÃÃ 
bool
ÃÃ 
EmployeeExists
ÃÃ #
(
ÃÃ# $
int
ÃÃ$ '
id
ÃÃ( *
)
ÃÃ* +
{
ÕÕ 	
return
ŒŒ 
db
ŒŒ 
.
ŒŒ 
Users
ŒŒ 
.
ŒŒ 
Count
ŒŒ !
(
ŒŒ! "
e
ŒŒ" #
=>
ŒŒ$ &
e
ŒŒ' (
.
ŒŒ( )
UserId
ŒŒ) /
==
ŒŒ0 2
id
ŒŒ3 5
)
ŒŒ5 6
>
ŒŒ7 8
$num
ŒŒ9 :
;
ŒŒ: ;
}
œœ 	
}
–– 
}—— ád
CH:\AlphaMedic\AlphaMedic\Rest\Controllers\ExaminationsController.cs
	namespace 	
Rest
 
. 
Controllers 
{ 
[ 
	Authorize 
] 
[ 
RoutePrefix 
( 
$str #
)# $
]$ %
public 

class "
ExaminationsController '
:( )
ApiController* 7
{ 
private 
readonly 
AlphaMedicContext *
db+ -
=. /
new0 3
AlphaMedicContext4 E
(E F
)F G
;G H
[ 	
Route	 
( 
$str 
) 
] 
[ 	
	Authorize	 
] 
public 
IHttpActionResult  
GetExaminations! 0
(0 1
)1 2
{ 	
return 
Ok 
( 
db 
. 
Examinations %
.% &
Select& ,
(, -
x 
=> 
new 
ProcedureDto $
{ 
Date 
= 
x 
. 
Date  
,  !
ProcedureId 
=  
(! "
int" %
)% &
x& '
.' (
ProcedureId( 3
,3 4
Name 
= 
x 
. 
Name  
,  !
Description 
=  
x! "
." #
Description# .
,. /
Price 
= 
( 
decimal #
)# $
x$ %
.% &
Price& +
,+ ,
}   
)!! 
)!! 
;!! 
}"" 	
[%% 	
Route%%	 
(%% 
$str%% 
)%% 
]%% 
[&& 	
ResponseType&&	 
(&& 
typeof&& 
(&& 
ProcedureDto&& )
)&&) *
)&&* +
]&&+ ,
['' 	
	Authorize''	 
('' 
Roles'' 
='' 
Roles''  
.''  !
Receptionist''! -
+''. /
$str''0 3
+''4 5
Roles''6 ;
.''; <
Patient''< C
+''D E
$str''F I
+''J K
Roles''L Q
.''Q R

AllDoctors''R \
)''\ ]
]''] ^
public(( 
IHttpActionResult((  
GetExamination((! /
(((/ 0
int((0 3
id((4 6
)((6 7
{)) 	
Examination++ 
examination++ #
=++$ %
(++& '
Examination++' 2
)++2 3
db++3 5
.++5 6

Procedures++6 @
.++@ A
Find++A E
(++E F
id++F H
)++H I
;++I J
var-- 
rez-- 
=-- 
new-- 
{.. 
ProcedureId// 
=// 
(// 
int// "
)//" #
examination//# .
.//. /
ProcedureId/// :
,//: ;
ProcedureName00 
=00 
examination00  +
.00+ ,
Name00, 0
,000 1 
ProcedureDescription11 $
=11% &
examination11' 2
.112 3
Description113 >
,11> ?
Price22 
=22 
(22 
decimal22  
)22  !
examination22! ,
.22, -
Price22- 2
}44 
;44 
return66	 
Ok66 
(66 
rez66 
)66 
;66 
}77 	
[:: 	
	Authorize::	 
(:: 
Roles:: 
=:: 
Roles::  
.::  !
Receptionist::! -
)::- .
]::. /
[;; 	
ResponseType;;	 
(;; 
typeof;; 
(;; 
void;; !
);;! "
);;" #
];;# $
[<< 	
Route<<	 
(<< 
$str<< 
)<< 
]<< 
public== 
IHttpActionResult==  
PutExamination==! /
(==/ 0
int==0 3
id==4 6
,==6 7
Examination==8 C
examination==D O
)==O P
{>> 	
if?? 
(?? 
!?? 

ModelState?? 
.?? 
IsValid?? #
)??# $
{@@ 
returnAA 

BadRequestAA !
(AA! "

ModelStateAA" ,
)AA, -
;AA- .
}BB 
ifDD 
(DD 
idDD 
!=DD 
examinationDD !
.DD! "
ProcedureIdDD" -
)DD- .
{EE 
returnFF 

BadRequestFF !
(FF! "
)FF" #
;FF# $
}GG 
dbII 
.II 
EntryII 
(II 
examinationII  
)II  !
.II! "
StateII" '
=II( )
EntityStateII* 5
.II5 6
ModifiedII6 >
;II> ?
tryKK 
{LL 
dbMM 
.MM 
SaveChangesMM 
(MM 
)MM  
;MM  !
}NN 
catchOO 
(OO (
DbUpdateConcurrencyExceptionOO /
)OO/ 0
{PP 
ifQQ 
(QQ 
!QQ 
ExaminationExistsQQ &
(QQ& '
idQQ' )
)QQ) *
)QQ* +
{RR 
returnSS 
NotFoundSS #
(SS# $
)SS$ %
;SS% &
}TT 
elseUU 
{VV 
throwWW 
;WW 
}XX 
}YY 
return[[ 

StatusCode[[ 
([[ 
HttpStatusCode[[ ,
.[[, -
	NoContent[[- 6
)[[6 7
;[[7 8
}\\ 	
[^^ 	
Route^^	 
(^^ 
$str^^ 
)^^ 
]^^ 
[__ 	
	Authorize__	 
(__ 
Roles__ 
=__ 
Roles__  
.__  !
Receptionist__! -
+__. /
$str__0 3
+__4 5
Roles__6 ;
.__; <

AllDoctors__< F
)__F G
]__G H
public`` 
IHttpActionResult``  
PostDiagnosis``! .
(``. /
int``/ 2
id``3 5
,``5 6
	Diagnosis``7 @
	diagnosis``A J
)``J K
{aa 	
ifbb 
(bb 
!bb 

ModelStatebb 
.bb 
IsValidbb #
)bb# $
{cc 
returndd 

BadRequestdd !
(dd! "

ModelStatedd" ,
)dd, -
;dd- .
}ee 
dbff 
.ff 

Diagnosissff 
.ff 
Addff 
(ff 
	diagnosisff '
)ff' (
;ff( )
dbgg 
.gg 
SaveChangesgg 
(gg 
)gg 
;gg 
varhh 
examinationhh 
=hh 
dbhh  
.hh  !
Examinationshh! -
.hh- .
Findhh. 2
(hh2 3
idhh3 5
)hh5 6
;hh6 7
dbii 
.ii 
Entryii 
(ii 
examinationii  
)ii  !
.ii! "
Stateii" '
=ii( )
EntityStateii* 5
.ii5 6
Modifiedii6 >
;ii> ?
examinationjj 
.jj 
	Diagnosisjj !
=jj" #
	diagnosisjj$ -
;jj- .
dbkk 
.kk 
SaveChangeskk 
(kk 
)kk 
;kk 
returnll 
Okll 
(ll 
	diagnosisll 
)ll  
;ll  !
}mm 	
[qq 	
Routeqq	 
(qq 
$strqq 
)qq 
]qq 
[rr 	
ResponseTyperr	 
(rr 
typeofrr 
(rr 
Examinationrr (
)rr( )
)rr) *
]rr* +
[ss 	
	Authorizess	 
(ss 
Rolesss 
=ss 
Rolesss  
.ss  !
Receptionistss! -
+ss. /
$strss0 3
+ss4 5
Rolesss6 ;
.ss; <

AllDoctorsss< F
)ssF G
]ssG H
publictt 
IHttpActionResulttt  
PostExaminationtt! 0
(tt0 1
Examinationtt1 <
examinationtt= H
)ttH I
{uu 	
ifvv 
(vv 
!vv 

ModelStatevv 
.vv 
IsValidvv #
)vv# $
{ww 
returnxx 

BadRequestxx !
(xx! "

ModelStatexx" ,
)xx, -
;xx- .
}yy 
if|| 
(|| 
db|| 
.|| 

Procedures|| 
.|| 
FirstOrDefault|| ,
(||, -
x||- .
=>||/ 1
x||2 3
.||3 4
ProcedureId||4 ?
==||@ B
examination||C N
.||N O
ProcedureId||O Z
)||Z [
!=||\ ^
null||_ c
)||c d
return}} 
Content}} 
(}} 
HttpStatusCode}} -
.}}- .
Conflict}}. 6
,}}6 7
$str}}8 L
)}}L M
;}}M N
db 
. 
Examinations 
. 
Add 
(  
examination  +
)+ ,
;, -
try
ÄÄ 
{
ÅÅ 
db
ÇÇ 
.
ÇÇ 
SaveChanges
ÇÇ 
(
ÇÇ 
)
ÇÇ  
;
ÇÇ  !
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ 
DbUpdateException
ÖÖ $
)
ÖÖ$ %
{
ÜÜ 
if
áá 
(
áá 
ExaminationExists
áá %
(
áá% &
(
áá& '
int
áá' *
)
áá* +
examination
áá+ 6
.
áá6 7
ProcedureId
áá7 B
)
ááB C
)
ááC D
{
àà 
return
ââ 
Conflict
ââ #
(
ââ# $
)
ââ$ %
;
ââ% &
}
ää 
else
ãã 
{
åå 
throw
çç 
;
çç 
}
éé 
}
èè 
return
ëë 
Ok
ëë 
(
ëë 
examination
ëë !
)
ëë! "
;
ëë" #
}
íí 	
[
ïï 	
ResponseType
ïï	 
(
ïï 
typeof
ïï 
(
ïï 
Examination
ïï (
)
ïï( )
)
ïï) *
]
ïï* +
public
ññ 
IHttpActionResult
ññ  
DeleteExamination
ññ! 2
(
ññ2 3
int
ññ3 6
id
ññ7 9
)
ññ9 :
{
óó 	
Examination
òò 
examination
òò #
=
òò$ %
(
òò& '
Examination
òò' 2
)
òò2 3
db
òò3 5
.
òò5 6

Procedures
òò6 @
.
òò@ A
Find
òòA E
(
òòE F
id
òòF H
)
òòH I
;
òòI J
if
ôô 
(
ôô 
examination
ôô 
==
ôô 
null
ôô #
)
ôô# $
{
öö 
return
õõ 
NotFound
õõ 
(
õõ  
)
õõ  !
;
õõ! "
}
úú 
db
ûû 
.
ûû 

Procedures
ûû 
.
ûû 
Remove
ûû  
(
ûû  !
examination
ûû! ,
)
ûû, -
;
ûû- .
db
üü 
.
üü 
SaveChanges
üü 
(
üü 
)
üü 
;
üü 
return
°° 
Ok
°° 
(
°° 
examination
°° !
)
°°! "
;
°°" #
}
¢¢ 	
	protected
§§ 
override
§§ 
void
§§ 
Dispose
§§  '
(
§§' (
bool
§§( ,
	disposing
§§- 6
)
§§6 7
{
•• 	
if
¶¶ 
(
¶¶ 
	disposing
¶¶ 
)
¶¶ 
{
ßß 
db
®® 
.
®® 
Dispose
®® 
(
®® 
)
®® 
;
®® 
}
©© 
base
™™ 
.
™™ 
Dispose
™™ 
(
™™ 
	disposing
™™ "
)
™™" #
;
™™# $
}
´´ 	
private
≠≠ 
bool
≠≠ 
ExaminationExists
≠≠ &
(
≠≠& '
int
≠≠' *
id
≠≠+ -
)
≠≠- .
{
ÆÆ 	
return
ØØ 
db
ØØ 
.
ØØ 

Procedures
ØØ  
.
ØØ  !
Count
ØØ! &
(
ØØ& '
e
ØØ' (
=>
ØØ) +
e
ØØ, -
.
ØØ- .
ProcedureId
ØØ. 9
==
ØØ: <
id
ØØ= ?
)
ØØ? @
>
ØØA B
$num
ØØC D
;
ØØD E
}
∞∞ 	
}
±± 
}≤≤ »b
@H:\AlphaMedic\AlphaMedic\Rest\Controllers\FeedbacksController.cs
	namespace 	
Rest
 
. 
Controllers 
{ 
public 

class 
FeedbacksController $
:% &
ApiController' 4
{ 
private 
AlphaMedicContext !
db" $
=% &
new' *
AlphaMedicContext+ <
(< =
)= >
;> ?
public 
IHttpActionResult  
GetFeedbacks! -
(- .
[. /
FromUri/ 6
]6 7
int8 ;
?; <
DepartmentId= I
=J K
nullL P
,P Q
[R S
FromUriS Z
]Z [
int\ _
?_ `
DoctorIda i
=j k
nulll p
,p q
[r s
FromUris z
]z {
bool	| Ä
all
Å Ñ
=
Ö Ü
true
á ã
)
ã å
{ 	
var 
	feedbacks 
= 
db 
. 
	Feedbacks (
;( )
if 
( 
DepartmentId 
!= 
null  $
)$ %
{ 
var 
res 
= 
( 
	feedbacks $
.$ %
Where% *
(* +
x+ ,
=>- /
x0 1
.1 2
DepartmentId2 >
==? A
DepartmentIdB N
)N O
.O P
SelectP V
(V W
yW X
=>Y [
new\ _
{ 
y 
. 
Date 
, 
y 
. 
Description !
,! "
y 
. 
DoctorId 
, 
y   
.   
DepartmentId   "
,  " #
y!! 
.!! 

FeedbackId!!  
,!!  !
PatientFullName"" #
=""$ %
(""& '
y""' (
.""( )
Patient"") 0
==""1 3
null""4 8
?""9 :
$str""; F
:""G H
y""I J
.""J K
Patient""K R
.""R S
Name""S W
+""X Y
$str""Z ]
+""^ _
y""` a
.""a b
Patient""b i
.""i j
Surname""j q
)""q r
,""r s
PatientURLImage## #
=##$ %
(##& '
y##' (
.##( )
Patient##) 0
==##1 3
null##4 8
?##9 :
	Constants##; D
.##D E

ThisServer##E O
+##P Q
	Constants##R [
.##[ \
DefaultPatientImage##\ o
:##p q
	Constants##r {
.##{ |

ThisServer	##| Ü
+
##á à
y
##â ä
.
##ä ã
Patient
##ã í
.
##í ì
URLImage
##ì õ
)
##õ ú
}$$ 
)$$ 
)$$ 
;$$ 
res%% 
=%% 
all%% 
==%% 
true%% !
?%%" #
res%%$ '
:%%( )
res%%* -
.%%- .
OrderBy%%. 5
(%%5 6
x%%6 7
=>%%8 :
x%%; <
.%%< =

FeedbackId%%= G
)%%G H
.%%H I
Skip%%I M
(%%M N
Math%%N R
.%%R S
Max%%S V
(%%V W
$num%%W X
,%%X Y
res%%Z ]
.%%] ^
Count%%^ c
(%%c d
)%%d e
-%%f g
$num%%h i
)%%i j
)%%j k
;%%k l
return&& 
Ok&& 
(&& 
res&& 
)&& 
;&& 
}'' 
if(( 
((( 
DoctorId(( 
!=(( 
null((  
)((  !
{)) 
var** 
res** 
=** 
(** 
	feedbacks** $
.**$ %
Where**% *
(*** +
x**+ ,
=>**- /
x**0 1
.**1 2
DoctorId**2 :
==**; =
DoctorId**> F
)**F G
.**G H
Select**H N
(**N O
y**O P
=>**Q S
new**T W
{++ 
y,, 
.,, 
Date,, 
,,, 
y-- 
.-- 
Description-- !
,--! "
y.. 
... 
DoctorId.. 
,.. 
y// 
.// 
DepartmentId// "
,//" #
y00 
.00 

FeedbackId00  
,00  !
PatientFullName11 #
=11$ %
(11& '
y11' (
.11( )
Patient11) 0
==111 3
null114 8
?119 :
$str11; F
:11G H
y11I J
.11J K
Patient11K R
.11R S
Name11S W
+11X Y
$str11Z ]
+11^ _
y11` a
.11a b
Patient11b i
.11i j
Surname11j q
)11q r
,11r s
PatientURLImage22 #
=22$ %
(22& '
y22' (
.22( )
Patient22) 0
==221 3
null224 8
?229 :
	Constants22; D
.22D E

ThisServer22E O
+22P Q
	Constants22R [
.22[ \
DefaultPatientImage22\ o
:22p q
	Constants22r {
.22{ |

ThisServer	22| Ü
+
22á à
y
22â ä
.
22ä ã
Patient
22ã í
.
22í ì
URLImage
22ì õ
)
22õ ú
}33 
)33 
)33 
;33 
res55 
=55 
all55 
==55 
true55 !
?55" #
res55$ '
:55( )
res55* -
.55- .
OrderBy55. 5
(555 6
x556 7
=>558 :
x55; <
.55< =

FeedbackId55= G
)55G H
.55H I
Skip55I M
(55M N
Math55N R
.55R S
Max55S V
(55V W
$num55W X
,55X Y
res55Z ]
.55] ^
Count55^ c
(55c d
)55d e
-55f g
$num55h i
)55i j
)55j k
;55k l
return66 
Ok66 
(66 
res66 
)66 
;66 
}77 
return99 

BadRequest99 
(99 
)99 
;99  
}:: 	
[== 	
ResponseType==	 
(== 
typeof== 
(== 
Feedback== %
)==% &
)==& '
]==' (
public>> 
IHttpActionResult>>  
GetFeedback>>! ,
(>>, -
int>>- 0
id>>1 3
)>>3 4
{?? 	
Feedback@@ 
feedback@@ 
=@@ 
db@@  "
.@@" #
	Feedbacks@@# ,
.@@, -
Find@@- 1
(@@1 2
id@@2 4
)@@4 5
;@@5 6
ifAA 
(AA 
feedbackAA 
==AA 
nullAA  
)AA  !
{BB 
returnCC 
NotFoundCC 
(CC  
)CC  !
;CC! "
}DD 
returnFF 
OkFF 
(FF 
feedbackFF 
)FF 
;FF  
}GG 	
[JJ 	
ResponseTypeJJ	 
(JJ 
typeofJJ 
(JJ 
voidJJ !
)JJ! "
)JJ" #
]JJ# $
publicKK 
IHttpActionResultKK  
PutFeedbackKK! ,
(KK, -
intKK- 0
idKK1 3
,KK3 4
FeedbackKK5 =
feedbackKK> F
)KKF G
{LL 	
ifMM 
(MM 
!MM 

ModelStateMM 
.MM 
IsValidMM #
)MM# $
{NN 
returnOO 

BadRequestOO !
(OO! "

ModelStateOO" ,
)OO, -
;OO- .
}PP 
ifRR 
(RR 
idRR 
!=RR 
feedbackRR 
.RR 

FeedbackIdRR )
)RR) *
{SS 
returnTT 

BadRequestTT !
(TT! "
)TT" #
;TT# $
}UU 
dbWW 
.WW 
EntryWW 
(WW 
feedbackWW 
)WW 
.WW 
StateWW $
=WW% &
EntityStateWW' 2
.WW2 3
ModifiedWW3 ;
;WW; <
tryYY 
{ZZ 
db[[ 
.[[ 
SaveChanges[[ 
([[ 
)[[  
;[[  !
}\\ 
catch]] 
(]] (
DbUpdateConcurrencyException]] /
)]]/ 0
{^^ 
if__ 
(__ 
!__ 
FeedbackExists__ #
(__# $
id__$ &
)__& '
)__' (
{`` 
returnaa 
NotFoundaa #
(aa# $
)aa$ %
;aa% &
}bb 
elsecc 
{dd 
throwee 
;ee 
}ff 
}gg 
returnii 

StatusCodeii 
(ii 
HttpStatusCodeii ,
.ii, -
	NoContentii- 6
)ii6 7
;ii7 8
}jj 	
[mm 	
ResponseTypemm	 
(mm 
typeofmm 
(mm 
Feedbackmm %
)mm% &
)mm& '
]mm' (
publicnn 
IHttpActionResultnn  
PostFeedbacknn! -
(nn- .
Feedbacknn. 6
feedbacknn7 ?
)nn? @
{oo 	
ifpp 
(pp 
!pp 

ModelStatepp 
.pp 
IsValidpp #
)pp# $
{qq 
returnrr 

BadRequestrr !
(rr! "

ModelStaterr" ,
)rr, -
;rr- .
}ss 
dbuu 
.uu 
	Feedbacksuu 
.uu 
Adduu 
(uu 
feedbackuu %
)uu% &
;uu& '
dbvv 
.vv 
SaveChangesvv 
(vv 
)vv 
;vv 
returnxx 
CreatedAtRoutexx !
(xx! "
$strxx" .
,xx. /
newxx0 3
{xx4 5
idxx6 8
=xx9 :
feedbackxx; C
.xxC D

FeedbackIdxxD N
}xxO P
,xxP Q
feedbackxxR Z
)xxZ [
;xx[ \
}yy 	
[|| 	
ResponseType||	 
(|| 
typeof|| 
(|| 
Feedback|| %
)||% &
)||& '
]||' (
public}} 
IHttpActionResult}}  
DeleteFeedback}}! /
(}}/ 0
int}}0 3
id}}4 6
)}}6 7
{~~ 	
Feedback 
feedback 
= 
db  "
." #
	Feedbacks# ,
., -
Find- 1
(1 2
id2 4
)4 5
;5 6
if
ÄÄ 
(
ÄÄ 
feedback
ÄÄ 
==
ÄÄ 
null
ÄÄ  
)
ÄÄ  !
{
ÅÅ 
return
ÇÇ 
NotFound
ÇÇ 
(
ÇÇ  
)
ÇÇ  !
;
ÇÇ! "
}
ÉÉ 
db
ÖÖ 
.
ÖÖ 
	Feedbacks
ÖÖ 
.
ÖÖ 
Remove
ÖÖ 
(
ÖÖ  
feedback
ÖÖ  (
)
ÖÖ( )
;
ÖÖ) *
db
ÜÜ 
.
ÜÜ 
SaveChanges
ÜÜ 
(
ÜÜ 
)
ÜÜ 
;
ÜÜ 
return
àà 
Ok
àà 
(
àà 
feedback
àà 
)
àà 
;
àà  
}
ââ 	
	protected
ãã 
override
ãã 
void
ãã 
Dispose
ãã  '
(
ãã' (
bool
ãã( ,
	disposing
ãã- 6
)
ãã6 7
{
åå 	
if
çç 
(
çç 
	disposing
çç 
)
çç 
{
éé 
db
èè 
.
èè 
Dispose
èè 
(
èè 
)
èè 
;
èè 
}
êê 
base
ëë 
.
ëë 
Dispose
ëë 
(
ëë 
	disposing
ëë "
)
ëë" #
;
ëë# $
}
íí 	
private
îî 
bool
îî 
FeedbackExists
îî #
(
îî# $
int
îî$ '
id
îî( *
)
îî* +
{
ïï 	
return
ññ 
db
ññ 
.
ññ 
	Feedbacks
ññ 
.
ññ  
Count
ññ  %
(
ññ% &
e
ññ& '
=>
ññ( *
e
ññ+ ,
.
ññ, -

FeedbackId
ññ- 7
==
ññ8 :
id
ññ; =
)
ññ= >
>
ññ? @
$num
ññA B
;
ññB C
}
óó 	
}
òò 
}ôô ÑN
AH:\AlphaMedic\AlphaMedic\Rest\Controllers\FileUploadController.cs
	namespace 	
Rest
 
. 
Controllers 
{ 
public 

class 3
'FilenameMultipartFormDataStreamProvider 8
:9 :+
MultipartFormDataStreamProvider; Z
{ 
public 3
'FilenameMultipartFormDataStreamProvider 6
(6 7
string7 =
path> B
)B C
:D E
baseF J
(J K
pathK O
)O P
{ 	
} 	
public 
override 
string 
GetLocalFileName /
(/ 0
System0 6
.6 7
Net7 :
.: ;
Http; ?
.? @
Headers@ G
.G H
HttpContentHeadersH Z
headers[ b
)b c
{ 	
return 
string 
. 
Format !
(! "
$str" ,
,, -
DateTime. 6
.6 7
Now7 :
.: ;
Ticks; @
)@ A
;A B
} 	
} 
[ 
	Authorize 
] 
[ 
RoutePrefix 
( 
$str 
) 
] 
public   

class    
FileUploadController   %
:  & '
ApiController  ( 5
{!! 
private"" 
static"" 
readonly"" 
string""  &
ServerUploadFolder""' 9
="": ;
System""< B
.""B C
Web""C F
.""F G
Hosting""G N
.""N O
HostingEnvironment""O a
.""a b
MapPath""b i
(""i j
$str""j q
)""q r
;""r s
private$$ 
AlphaMedicContext$$ !
db$$" $
=$$% &
new$$' *
AlphaMedicContext$$+ <
($$< =
)$$= >
;$$> ?
[&& 	
Route&&	 
(&& 
$str&& 
)&& 
]&& 
['' 	
HttpPost''	 
]'' 
public(( 
async(( 
Task(( 
<(( 
IHttpActionResult(( +
>((+ ,

UploadFile((- 7
(((7 8
int((8 ;
id((< >
)((> ?
{)) 	
HttpRequestMessage,, 
request,, &
=,,' (
this,,) -
.,,- .
Request,,. 5
;,,5 6
if-- 
(-- 
!-- 
request-- 
.-- 
Content--  
.--  !"
IsMimeMultipartContent--! 7
(--7 8
)--8 9
)--9 :
{.. 
throw// 
new// !
HttpResponseException// /
(/// 0
HttpStatusCode//0 >
.//> ? 
UnsupportedMediaType//? S
)//S T
;//T U
}00 
try11 
{22 
var33 
currentUser33 
=33  !
db33" $
.33$ %
Users33% *
.33* +
FirstOrDefault33+ 9
(339 :
x33: ;
=>33< >
x33? @
.33@ A
Email33A F
==33G I
this33J N
.33N O
User33O S
.33S T
Identity33T \
.33\ ]
Name33] a
)33a b
;33b c
if55 
(55 
currentUser55 
==55  "
null55# '
)55' (
{66 
return77 
NotFound77 #
(77# $
)77$ %
;77% &
}88 
if:: 
(:: 
!:: 
this:: 
.:: 
User:: 
.:: 
IsInRole:: &
(::& '
Roles::' ,
.::, -
Administrator::- :
)::: ;
&&::; =
id::> @
!=::@ B
currentUser::B M
.::M N
UserId::N T
)::T U
{;; 
return<< 
Content<< "
(<<" #
HttpStatusCode<<# 1
.<<1 2
	Forbidden<<2 ;
,<<; <
Messages<<= E
.<<E F
AccsesDenied<<F R
)<<R S
;<<S T
}== 
var?? 
streamProvider?? "
=??# $
new??% (3
'FilenameMultipartFormDataStreamProvider??) P
(??P Q
ServerUploadFolder??Q c
)??c d
;??d e
await@@ 
Request@@ 
.@@ 
Content@@ %
.@@% & 
ReadAsMultipartAsync@@& :
(@@: ;
streamProvider@@; I
)@@I J
;@@J K
varCC 
fileNameCC 
=CC 
PathCC #
.CC# $
GetFileNameCC$ /
(CC/ 0
streamProviderCC0 >
.CC> ?
FileDataCC? G
.CCG H
SelectCCH N
(CCN O
entryCCO T
=>CCU W
entryCCX ]
.CC] ^
LocalFileNameCC^ k
)CCk l
.CCl m
FirstCCm r
(CCr s
)CCs t
)CCt u
;CCu v
varEE 
userEE 
=EE 
dbEE 
.EE 
UsersEE #
.EE# $
FindEE$ (
(EE( )
idEE) +
)EE+ ,
;EE, -
ifGG 
(GG 
userGG 
==GG 
nullGG  
)GG! "
{HH 
returnII 
NotFoundII #
(II# $
)II$ %
;II% &
}JJ 
userLL 
.LL 
URLImageLL 
=LL  
$strLL! '
+LL( )
fileNameLL* 2
;LL2 3
dbNN 
.NN 
EntryNN 
(NN 
userNN 
)NN 
.NN 
StateNN $
=NN% &
SystemNN' -
.NN- .
DataNN. 2
.NN2 3
EntityNN3 9
.NN9 :
EntityStateNN: E
.NNE F
ModifiedNNF N
;NNN O
dbPP 
.PP 
SaveChangesPP 
(PP 
)PP  
;PP  !
returnQQ 
OkQQ 
(QQ 
	ConstantsQQ #
.QQ# $

ThisServerQQ$ .
+QQ/ 0
$strQQ1 7
+QQ8 9
fileNameQQ: B
)QQB C
;QQC D
}RR 
catchSS 
(SS 
	ExceptionSS 
exSS 
)SS  
{TT 
returnUU 
InternalServerErrorUU *
(UU* +
exUU+ -
)UU- .
;UU. /
}VV 
}YY 	
[ZZ 	
RouteZZ	 
(ZZ 
$strZZ $
)ZZ$ %
]ZZ% &
[[[ 	
HttpPost[[	 
][[ 
[\\ 	
	Authorize\\	 
(\\ 
Roles\\ 
=\\ 
Roles\\  
.\\  !
Administrator\\! .
)\\. /
]\\/ 0
public]] 
async]] 
Task]] 
<]] 
IHttpActionResult]] +
>]]+ ,
UploadDepFile]]- :
(]]: ;
int]]; >
id]]? A
)]]A B
{^^ 	
HttpRequestMessageaa 
requestaa &
=aa' (
thisaa) -
.aa- .
Requestaa. 5
;aa5 6
ifbb 
(bb 
!bb 
requestbb 
.bb 
Contentbb  
.bb  !"
IsMimeMultipartContentbb! 7
(bb7 8
)bb8 9
)bb9 :
{cc 
throwdd 
newdd !
HttpResponseExceptiondd /
(dd/ 0
HttpStatusCodedd0 >
.dd> ? 
UnsupportedMediaTypedd? S
)ddS T
;ddT U
}ee 
tryff 
{gg 
varhh 
streamProviderhh "
=hh# $
newhh% (3
'FilenameMultipartFormDataStreamProviderhh) P
(hhP Q
ServerUploadFolderhhQ c
)hhc d
;hhd e
awaitii 
Requestii 
.ii 
Contentii %
.ii% & 
ReadAsMultipartAsyncii& :
(ii: ;
streamProviderii; I
)iiI J
;iiJ K
varll 
fileNamell 
=ll 
Pathll #
.ll# $
GetFileNamell$ /
(ll/ 0
streamProviderll0 >
.ll> ?
FileDatall? G
.llG H
SelectllH N
(llN O
entryllO T
=>llU W
entryllX ]
.ll] ^
LocalFileNamell^ k
)llk l
.lll m
Firstllm r
(llr s
)lls t
)llt u
;llu v
varnn 
depnn 
=nn 
dbnn 
.nn 
Departmentsnn (
.nn( )
Findnn) -
(nn- .
idnn. 0
)nn0 1
;nn1 2
ifpp 
(pp 
deppp 
==pp 
nullpp 
)pp  
{qq 
returnrr 
NotFoundrr #
(rr# $
)rr$ %
;rr% &
}ss 
depuu 
.uu 
URLImageuu 
=uu 
$struu %
+uu& '
fileNameuu( 0
;uu0 1
dbww 
.ww 
Entryww 
(ww 
depww 
)ww 
.ww 
Stateww #
=ww$ %
Systemww& ,
.ww, -
Dataww- 1
.ww1 2
Entityww2 8
.ww8 9
EntityStateww9 D
.wwD E
ModifiedwwE M
;wwM N
dbyy 
.yy 
SaveChangesyy 
(yy 
)yy  
;yy  !
returnzz 
Okzz 
(zz 
	Constantszz #
.zz# $

ThisServerzz$ .
+zz/ 0
$strzz1 7
+zz8 9
fileNamezz: B
)zzB C
;zzC D
}{{ 
catch|| 
(|| 
	Exception|| 
ex|| 
)||  
{}} 
return~~ 
InternalServerError~~ *
(~~* +
ex~~+ -
)~~- .
;~~. /
} 
}
ÇÇ 	
}
ÖÖ 
}ÜÜ Áû
GH:\AlphaMedic\AlphaMedic\Rest\Controllers\MedicalHistoriesController.cs
	namespace 	
Rest
 
. 
Controllers 
{ 
[ 
RoutePrefix 
( 
$str %
)% &
]& '
public 

class &
MedicalHistoriesController +
:, -
ApiController. ;
{ 
private 
AlphaMedicContext !
db" $
=% &
new' *
AlphaMedicContext+ <
(< =
)= >
;> ?
[ 	
	Authorize	 
] 
[ 	
Route	 
( 
$str 
) 
] 
public 
IHttpActionResult  
GetMedicalHistory! 2
(2 3
int3 6
id7 9
,9 :
DateTime; C
?C D

periodFromE O
,O P
DateTimeQ Y
?Y Z

periodTill[ e
,e f
string 
	procedure 
= 
null #
,# $
int% (
page) -
=. /
$num0 1
,1 2
int3 6
itemsPerPage7 C
=D E
$numF H
,H I
stringJ P
searchQ W
=X Y
nullZ ^
)^ _
{ 	
MedicalHistory 
medicalHistory )
=* +
db, .
.. /
MedicalHistorys/ >
.> ?
Find? C
(C D
idD F
)F G
;G H
if!! 
(!! 
medicalHistory!! 
==!! !
null!!" &
)!!& '
return"" 
NotFound"" 
(""  
)""  !
;""! "
var$$ 
currentUser$$ 
=$$ 
db$$  
.$$  !
Users$$! &
.$$& '
FirstOrDefault$$' 5
($$5 6
x$$6 7
=>$$8 :
x$$; <
.$$< =
Email$$= B
==$$C E
User$$F J
.$$J K
Identity$$K S
.$$S T
Name$$T X
)$$X Y
;$$Y Z
if%% 
(%% 
currentUser%% 
==%% 
null%% #
)%%# $
return&& 
NotFound&& 
(&&  
)&&  !
;&&! "
if(( 
((( 
User(( 
.(( 
IsInRole(( 
((( 
Roles(( #
.((# $
Patient(($ +
)((+ ,
&&((- /
medicalHistory((0 >
.((> ?
Patient((? F
.((F G
UserId((G M
!=((N P
currentUser((Q \
.((\ ]
UserId((] c
)((c d
return)) 
Content)) 
()) 
HttpStatusCode)) -
.))- .
	Forbidden)). 7
,))7 8
Messages))9 A
.))A B
AccsesDenied))B N
)))N O
;))O P
if++ 
(++ 
Tools++ 
.++ 
AnyRole++ 
(++ 
User++ "
,++" #
Roles++$ )
.++) *
DoctorRoles++* 5
)++5 6
)++6 7
{,, 
if-- 
(-- 
User-- 
.-- 
IsInRole-- !
(--! "
Roles--" '
.--' (
Doctor--( .
)--. /
&&--0 2
!--3 4
medicalHistory--4 B
.--B C
Patient--C J
.--J K
Appointments--K W
.--W X
Any--X [
(--[ \
x--\ ]
=>--^ `
x--a b
.--b c
DoctorId--c k
==--l n
currentUser--o z
.--z {
UserId	--{ Å
)
--Å Ç
)
--Ç É
return.. 
Content.. "
(.." #
HttpStatusCode..# 1
...1 2
	Forbidden..2 ;
,..; <
Messages..= E
...E F
AccsesDenied..F R
)..R S
;..S T
var00 

department00 
=00  
db00! #
.00# $
Doctors00$ +
.00+ ,
FirstOrDefault00, :
(00: ;
x00; <
=>00= ?
x00@ A
.00A B
Email00B G
==00H J
this00K O
.00O P
User00P T
.00T U
Identity00U ]
.00] ^
Name00^ b
)00b c
.00c d
DepartmentId00d p
;00p q
if11 
(11 

department11 
==11 !
default11" )
(11) *
int11* -
)11- .
)11. /
return22 
NotFound22 #
(22# $
)22$ %
;22% &
if44 
(44 
User44 
.44 
IsInRole44 !
(44! "
Roles44" '
.44' (
DepartmentHead44( 6
)446 7
&&448 :
!55 
medicalHistory55 
.55  
Patient55  '
.55' (
Appointments55( 4
.554 5
Any555 8
(558 9
d559 :
=>55; =
d55> ?
.55? @
Doctor55@ F
.55F G
DepartmentId55G S
==55T V

department55W a
)55a b
)55b c
return66 
Content66 "
(66" #
HttpStatusCode66# 1
.661 2
	Forbidden662 ;
,66; <
Messages66= E
.66E F
AccsesDenied66F R
)66R S
;66S T
}77 
if:: 
(:: 
	procedure:: 
!=:: 
null:: !
)::! "
{;; 
medicalHistory<< 
.<< 

Procedures<< )
=<<* +
medicalHistory<<, :
.<<: ;

Procedures<<; E
.<<E F
Where<<F K
(<<K L
x<<L M
=><<N P
x<<Q R
.<<R S
GetType<<S Z
(<<Z [
)<<[ \
.<<\ ]
BaseType<<] e
.<<e f
Name<<f j
==<<k m
	procedure<<n w
)<<w x
.<<x y
ToArray	<<y Ä
(
<<Ä Å
)
<<Å Ç
;
<<Ç É
}== 
if?? 
(?? 

periodFrom?? 
!=?? 
null?? "
&&??# %

periodTill??& 0
!=??1 3
null??4 8
)??8 9
{@@ 
medicalHistoryAA 
.AA 

ProceduresAA )
=AA* +
medicalHistoryAA, :
.AA: ;

ProceduresAA; E
.AAE F
WhereAAF K
(AAK L
xAAL M
=>AAN P
xAAQ R
.AAR S
DateAAS W
>=AAX Z

periodFromAA[ e
&&AAf h
xAAi j
.AAj k
DateAAk o
<=AAp r

periodTillAAs }
)AA} ~
.AA~ 
ToArray	AA Ü
(
AAÜ á
)
AAá à
;
AAà â
}BB 
ifCC 
(CC 

periodFromCC 
!=CC 
nullCC "
)CC" #
{DD 
medicalHistoryEE 
.EE 

ProceduresEE )
=EE* +
medicalHistoryEE, :
.EE: ;

ProceduresEE; E
.EEE F
WhereEEF K
(EEK L
xEEL M
=>EEN P
xEEQ R
.EER S
DateEES W
>=EEX Z

periodFromEE[ e
)EEe f
.EEf g
ToArrayEEg n
(EEn o
)EEo p
;EEp q
}FF 
ifHH 
(HH 

periodTillHH 
!=HH 
nullHH "
)HH" #
{II 
medicalHistoryJJ 
.JJ 

ProceduresJJ )
=JJ* +
medicalHistoryJJ, :
.JJ: ;

ProceduresJJ; E
.JJE F
WhereJJF K
(JJK L
xJJL M
=>JJN P
xJJQ R
.JJR S
DateJJS W
<=JJX Z

periodTillJJ[ e
)JJe f
.JJf g
ToArrayJJg n
(JJn o
)JJo p
;JJp q
}KK 
ifNN 
(NN 
!NN 
stringNN 
.NN 
IsNullOrWhiteSpaceNN *
(NN* +
searchNN+ 1
)NN1 2
)NN2 3
{OO 
searchPP 
=PP 
searchPP 
.PP  
ToLowerPP  '
(PP' (
)PP( )
;PP) *
medicalHistoryQQ 
.QQ 

ProceduresQQ )
=QQ* +
medicalHistoryQQ, :
.QQ: ;

ProceduresQQ; E
.QQE F
WhereQQF K
(QQK L
xQQL M
=>QQN P
xRR 
.RR 
NameRR 
.RR 
ToLowerRR "
(RR" #
)RR# $
.RR$ %
ContainsRR% -
(RR- .
searchRR. 4
)RR4 5
)RR5 6
.RR6 7
ToArrayRR7 >
(RR> ?
)RR? @
;RR@ A
}SS 

IQueryableVV 
<VV 
ProcedureDtoVV #
>VV# $
ExaminationsVV% 1
=VV2 3
medicalHistoryVV4 B
.VVB C

ProceduresVVC M
.VVM N
WhereVVN S
(VVS T
xVVT U
=>VVV X
xVVY Z
.VVZ [
GetTypeVV[ b
(VVb c
)VVc d
.VVd e
BaseTypeVVe m
.VVm n
NameVVn r
==VVs u
$str	VVv É
)
VVÉ Ñ
.WW 
SelectWW 
(WW 
xWW 
=>WW 
newWW  
ExaminationDtoWW! /
{XX 
ProcedureIdYY 
=YY  !
(YY" #
intYY# &
)YY& '
xYY' (
.YY( )
ProcedureIdYY) 4
,YY4 5
NameZZ 
=ZZ 
xZZ 
.ZZ 
NameZZ !
,ZZ! "
Description[[ 
=[[  !
x[[" #
.[[# $
Description[[$ /
,[[/ 0
Date\\ 
=\\ 
x\\ 
.\\ 
Date\\ !
,\\! "
Price]] 
=]] 
x]] 
.]] 
Price]] #
,]]# $
State^^ 
=^^ 
x^^ 
.^^ 
Appointment^^ )
.^^) *
State^^* /
,^^/ 0
Doctor__ 
=__ 
x__ 
.__ 
Appointment__ *
.__* +
Doctor__+ 1
!=__2 4
null__5 9
?__: ;
new__< ?
ShortUserDto__@ L
{`` 
UserIdaa 
=aa  
xaa! "
.aa" #
Appointmentaa# .
.aa. /
Doctoraa/ 5
.aa5 6
UserIdaa6 <
,aa< =
Namebb 
=bb 
xbb  
.bb  !
Appointmentbb! ,
.bb, -
Doctorbb- 3
.bb3 4
Namebb4 8
,bb8 9
Surnamecc 
=cc  !
xcc" #
.cc# $
Appointmentcc$ /
.cc/ 0
Doctorcc0 6
.cc6 7
Surnamecc7 >
}dd 
:dd 
nulldd 
,dd 
	Diagnosisee 
=ee 
(ee  !
(ee! "
Examinationee" -
)ee- .
xee. /
)ee/ 0
.ee0 1
	Diagnosisee1 :
}ff 
)ff 
.ff 
AsQueryableff 
(ff 
)ff  
;ff  !

IQueryablehh 
<hh 
ProcedureDtohh #
>hh# $

Treatmentshh% /
=hh0 1
medicalHistoryhh2 @
.hh@ A

ProcedureshhA K
.hhK L
WherehhL Q
(hhQ R
xhhR S
=>hhT V
xhhW X
.hhX Y
GetTypehhY `
(hh` a
)hha b
.hhb c
BaseTypehhc k
.hhk l
Namehhl p
==hhq s
$strhht 
)	hh Ä
.ii 
Selectii 
(ii 
xii 
=>ii 
newii  
TreatmentDtoii! -
{jj 
ProcedureIdkk 
=kk  !
(kk" #
intkk# &
)kk& '
xkk' (
.kk( )
ProcedureIdkk) 4
,kk4 5
Namell 
=ll 
xll 
.ll 
Namell !
,ll! "
Descriptionmm 
=mm  !
xmm" #
.mm# $
Descriptionmm$ /
,mm/ 0
Datenn 
=nn 
xnn 
.nn 
Datenn !
,nn! "
Priceoo 
=oo 
xoo 
.oo 
Priceoo #
,oo# $
Statepp 
=pp 
xpp 
.pp 
Appointmentpp )
.pp) *
Statepp* /
,pp/ 0
Doctorqq 
=qq 
xqq 
.qq 
Appointmentqq *
.qq* +
Doctorqq+ 1
!=qq2 4
nullqq5 9
?qq: ;
newqq< ?
ShortUserDtoqq@ L
{rr 
UserIdss 
=ss  
xss! "
.ss" #
Appointmentss# .
.ss. /
Doctorss/ 5
.ss5 6
UserIdss6 <
,ss< =
Namett 
=tt 
xtt  
.tt  !
Appointmenttt! ,
.tt, -
Doctortt- 3
.tt3 4
Namett4 8
,tt8 9
Surnameuu 
=uu  !
xuu" #
.uu# $
Appointmentuu$ /
.uu/ 0
Doctoruu0 6
.uu6 7
Surnameuu7 >
}vv 
:vv 
nullvv 
,vv 
Resultww 
=ww 
(ww 
(ww 
	Treatmentww (
)ww( )
xww) *
)ww* +
.ww+ ,
Resultww, 2
,ww2 3
Medicationsxx 
=xx  !
(xx" #
(xx# $
	Treatmentxx$ -
)xx- .
xxx. /
)xx/ 0
.xx0 1
Medicationsxx1 <
.xx< =
Selectxx= C
(xxC D
yyy 
=>yy 
newyy 
MedicationDtoyy ,
{zz 
MedicationId{{ &
={{' (
y{{) *
.{{* +
MedicationId{{+ 7
,{{7 8
Description|| %
=||& '
y||( )
.||) *
Description||* 5
,||5 6
Price}} 
=}}  !
y}}" #
.}}# $
Price}}$ )
}~~ 
)~~ 
} 
) 
. 
AsQueryable 
( 
)  
;  !

IQueryable
ÅÅ 
<
ÅÅ 
ProcedureDto
ÅÅ #
>
ÅÅ# $
Vaccinations
ÅÅ% 1
=
ÅÅ2 3
medicalHistory
ÅÅ4 B
.
ÅÅB C

Procedures
ÅÅC M
.
ÅÅM N
Where
ÅÅN S
(
ÅÅS T
x
ÅÅT U
=>
ÅÅV X
x
ÅÅY Z
.
ÅÅZ [
GetType
ÅÅ[ b
(
ÅÅb c
)
ÅÅc d
.
ÅÅd e
BaseType
ÅÅe m
.
ÅÅm n
Name
ÅÅn r
==
ÅÅs u
$strÅÅv É
)ÅÅÉ Ñ
.
ÇÇ 
Select
ÇÇ 
(
ÇÇ 
x
ÇÇ 
=>
ÇÇ 
new
ÇÇ  
VaccinationDto
ÇÇ! /
{
ÉÉ 
ProcedureId
ÑÑ 
=
ÑÑ  !
(
ÑÑ" #
int
ÑÑ# &
)
ÑÑ& '
x
ÑÑ' (
.
ÑÑ( )
ProcedureId
ÑÑ) 4
,
ÑÑ4 5
Name
ÖÖ 
=
ÖÖ 
x
ÖÖ 
.
ÖÖ 
Name
ÖÖ !
,
ÖÖ! "
Description
ÜÜ 
=
ÜÜ  !
x
ÜÜ" #
.
ÜÜ# $
Description
ÜÜ$ /
,
ÜÜ/ 0
Date
áá 
=
áá 
x
áá 
.
áá 
Date
áá !
,
áá! "
Price
àà 
=
àà 
x
àà 
.
àà 
Price
àà #
,
àà# $
State
ââ 
=
ââ 
x
ââ 
.
ââ 
Appointment
ââ )
.
ââ) *
State
ââ* /
,
ââ/ 0
Doctor
ää 
=
ää 
x
ää 
.
ää 
Appointment
ää *
.
ää* +
Doctor
ää+ 1
!=
ää2 4
null
ää5 9
?
ää: ;
new
ää< ?
ShortUserDto
ää@ L
{
ãã 
UserId
åå 
=
åå  
x
åå! "
.
åå" #
Appointment
åå# .
.
åå. /
Doctor
åå/ 5
.
åå5 6
UserId
åå6 <
,
åå< =
Name
çç 
=
çç 
x
çç  
.
çç  !
Appointment
çç! ,
.
çç, -
Doctor
çç- 3
.
çç3 4
Name
çç4 8
,
çç8 9
Surname
éé 
=
éé  !
x
éé" #
.
éé# $
Appointment
éé$ /
.
éé/ 0
Doctor
éé0 6
.
éé6 7
Surname
éé7 >
}
èè 
:
èè 
null
èè 
}
êê 
)
êê 
.
êê 
AsQueryable
êê 
(
êê 
)
êê  
;
êê  !
var
íí 
rez
íí 
=
íí 
new
íí 
{
ìì 
WarningLabels
îî 
=
îî 
medicalHistory
îî  .
.
îî. /
WarningLabels
îî/ <
.
îî< =
Select
îî= C
(
îîC D
x
îîD E
=>
îîF H
x
îîI J
.
îîJ K
Description
îîK V
)
îîV W
,
îîW X

Procedures
ïï 
=
ïï 
(
ïï 
Examinations
ïï *
.
ïï* +
Concat
ïï+ 1
(
ïï1 2

Treatments
ïï2 <
)
ïï< =
.
ïï= >
Concat
ïï> D
(
ïïD E
Vaccinations
ïïE Q
)
ïïQ R
)
ïïR S
.
ïïS T
OrderByDescending
ïïT e
(
ïïe f
x
ïïf g
=>
ïïh j
x
ïïk l
.
ïïl m
Date
ïïm q
)
ïïq r
.
ïïr s
Where
ïïs x
(
ïïx y
x
ïïy z
=>
ïï{ }
x
ïï~ 
.ïï Ä
StateïïÄ Ö
==ïïÜ à 
AppointmentStateïïâ ô
.ïïô ö
Finishedïïö ¢
)ïï¢ £
}
ññ 
;
ññ 
var
ôô 

usersPaged
ôô 
=
ôô 
rez
ôô  
.
ôô  !

Procedures
ôô! +
.
ôô+ ,
Skip
ôô, 0
(
ôô0 1
(
ôô1 2
page
ôô2 6
-
ôô7 8
$num
ôô9 :
)
ôô: ;
*
ôô< =
itemsPerPage
ôô> J
)
ôôJ K
.
ôôK L
Take
ôôL P
(
ôôP Q
itemsPerPage
ôôQ ]
)
ôô] ^
.
ôô^ _
ToList
ôô_ e
(
ôôe f
)
ôôf g
;
ôôg h
var
úú 
json
úú 
=
úú 
new
úú 
{
ùù 
count
ûû 
=
ûû 
rez
ûû 
.
ûû 

Procedures
ûû &
.
ûû& '
Count
ûû' ,
(
ûû, -
)
ûû- .
,
ûû. /
data
üü 
=
üü 
new
üü 
{
†† 
WarningLabels
°° !
=
°°" #
rez
°°$ '
.
°°' (
WarningLabels
°°( 5
,
°°5 6

Procedures
¢¢ 
=
¢¢  

usersPaged
¢¢! +
}
££ 
}
§§ 
;
§§ 
return
¶¶ 
Ok
¶¶ 
(
¶¶ 
json
¶¶ 
)
¶¶ 
;
¶¶ 
}
ßß 	
	protected
ÏÏ 
override
ÏÏ 
void
ÏÏ 
Dispose
ÏÏ  '
(
ÏÏ' (
bool
ÏÏ( ,
	disposing
ÏÏ- 6
)
ÏÏ6 7
{
ÌÌ 	
if
ÓÓ 
(
ÓÓ 
	disposing
ÓÓ 
)
ÓÓ 
{
ÔÔ 
db
 
.
 
Dispose
 
(
 
)
 
;
 
}
ÒÒ 
base
ÚÚ 
.
ÚÚ 
Dispose
ÚÚ 
(
ÚÚ 
	disposing
ÚÚ "
)
ÚÚ" #
;
ÚÚ# $
}
ÛÛ 	
private
ıı 
bool
ıı "
MedicalHistoryExists
ıı )
(
ıı) *
int
ıı* -
id
ıı. 0
)
ıı0 1
{
ˆˆ 	
return
˜˜ 
db
˜˜ 
.
˜˜ 
MedicalHistorys
˜˜ %
.
˜˜% &
Count
˜˜& +
(
˜˜+ ,
e
˜˜, -
=>
˜˜. 0
e
˜˜1 2
.
˜˜2 3
MedicalHistoryId
˜˜3 C
==
˜˜D F
id
˜˜G I
)
˜˜I J
>
˜˜K L
$num
˜˜M N
;
˜˜N O
}
¯¯ 	
}
˘˘ 
}˙˙ ÑF
BH:\AlphaMedic\AlphaMedic\Rest\Controllers\MedicationsController.cs
	namespace 	
Rest
 
. 
Controllers 
{ 
[ 
RoutePrefix 
( 
$str "
)" #
]# $
public 

class !
MedicationsController &
:' (
ApiController) 6
{ 
private 
AlphaMedicContext !
db" $
=% &
new' *
AlphaMedicContext+ <
(< =
)= >
;> ?
public !
MedicationsController $
($ %
)% &
{' (
}) *
public !
MedicationsController $
($ %
AlphaMedicContext% 6
context7 >
)> ?
{ 	
db 
= 
context 
; 
} 	
["" 	
Route""	 
("" 
$str"" 
)"" 
]"" 
[## 	
	Authorize##	 
]## 
public$$ 
IEnumerable$$ 
<$$ 
MedicationDto$$ (
>$$( )
GetMedications$$* 8
($$8 9
)$$9 :
{%% 	
try&& 
{'' 
return(( 
db(( 
.(( 
Medications(( %
.((% &
Select((& ,
(((, -
x)) 
=>)) 
new)) 
MedicationDto)) *
{** 
MedicationId++ $
=++% &
x++' (
.++( )
MedicationId++) 5
,++5 6
Description,, #
=,,$ %
x,,& '
.,,' (
Description,,( 3
,,,3 4
Price-- 
=-- 
x--  !
.--! "
Price--" '
}.. 
)// 
;// 
}00 
catch11 
(11 "
NullReferenceException11 )
)11) *
{22 
return33 

Enumerable33 !
.33! "
Empty33" '
<33' (
MedicationDto33( 5
>335 6
(336 7
)337 8
;338 9
}44 
}55 	
[88 	
Route88	 
(88 
$str88 
)88 
]88 
[99 	
	Authorize99	 
(99 
Roles99 
=99 
Roles99 
.99 
Administrator99 ,
)99, -
]99- .
public:: 
IHttpActionResult::   
PatchMedicationPrice::! 5
(::5 6
int::6 9
id::: <
,::< =
JsonPatchDocument::> O
<::O P

Medication::P Z
>::Z [
	patchData::\ e
)::e f
{;; 	
var<< 
objectToUpdate<< 
=<<  
db<<! #
.<<# $
Medications<<$ /
.<</ 0
Find<<0 4
(<<4 5
id<<5 7
)<<7 8
;<<8 9
	patchData== 
.== 
ApplyTo== 
(== 
objectToUpdate== ,
)==, -
;==- .
try?? 
{@@ 
dbAA 
.AA 
SaveChangesAA 
(AA 
)AA  
;AA  !
}BB 
catchCC 
(CC '
DbEntityValidationExceptionCC .
eCC/ 0
)CC0 1
{DD 
stringEE 
sEE 
=EE 
$strEE 
;EE 
foreachFF 
(FF 
varFF 
eveFF  
inFF! #
eFF$ %
.FF% &"
EntityValidationErrorsFF& <
)FF< =
{GG 
sHH 
+=HH 
StringHH 
.HH  
FormatHH  &
(HH& '
$strHH' u
,HHu v
eveII 
.II 
EntryII "
.II" #
EntityII# )
.II) *
GetTypeII* 1
(II1 2
)II2 3
.II3 4
NameII4 8
,II8 9
eveII: =
.II= >
EntryII> C
.IIC D
StateIID I
)III J
;IIJ K
foreachJJ 
(JJ 
varJJ  
veJJ! #
inJJ$ &
eveJJ' *
.JJ* +
ValidationErrorsJJ+ ;
)JJ; <
{KK 
sLL 
+=LL 
StringLL #
.LL# $
FormatLL$ *
(LL* +
$strLL+ P
,LLP Q
veMM 
.MM 
PropertyNameMM +
,MM+ ,
veMM- /
.MM/ 0
ErrorMessageMM0 <
)MM< =
;MM= >
}NN 
}OO 
returnQQ 

BadRequestQQ !
(QQ! "
sQQ" #
)QQ# $
;QQ$ %
}RR 
returnSS 
OkSS 
(SS 
)SS 
;SS 
}UU 	
[ZZ 	
	AuthorizeZZ	 
]ZZ 
[[[ 	
ResponseType[[	 
([[ 
typeof[[ 
([[ 
MedicationDto[[ *
)[[* +
)[[+ ,
][[, -
public\\ 
IHttpActionResult\\  
GetMedication\\! .
(\\. /
int\\/ 2
id\\3 5
)\\5 6
{]] 	
var^^ 

medication^^ 
=^^ 
db^^ 
.^^  
Medications^^  +
.^^+ ,
Where^^, 1
(^^1 2
x^^2 3
=>^^4 6
x^^7 8
.^^8 9
MedicationId^^9 E
==^^F H
id^^I K
)^^K L
.^^L M
Select__ 
(__ 
x__ 
=>__ 
new__ 
MedicationDto__  -
{`` 
MedicationIdaa  
=aa! "
xaa# $
.aa$ %
MedicationIdaa% 1
,aa1 2
Descriptionbb 
=bb  !
xbb" #
.bb# $
Descriptionbb$ /
,bb/ 0
Pricecc 
=cc 
xcc 
.cc 
Pricecc #
}dd 
)dd 
.dd 
FirstOrDefaultdd !
(dd! "
)dd" #
;dd# $
ifff 
(ff 

medicationff 
==ff 
nullff "
)ff" #
{gg 
returnhh 
NotFoundhh 
(hh  
)hh  !
;hh! "
}ii 
returnjj 
Okjj 
(jj 

medicationjj  
)jj  !
;jj! "
}kk 	
[nn 	
Routenn	 
(nn 
$strnn 
)nn 
]nn 
[oo 	
	Authorizeoo	 
(oo 
Rolesoo 
=oo 
Rolesoo 
.oo  
Administratoroo  -
)oo- .
]oo. /
[pp 	
ResponseTypepp	 
(pp 
typeofpp 
(pp 

Medicationpp '
)pp' (
)pp( )
]pp) *
publicqq 
IHttpActionResultqq  
PostMedicationqq! /
(qq/ 0

Medicationqq0 :

medicationqq; E
)qqE F
{rr 	
ifss 
(ss 
!ss 

ModelStatess 
.ss 
IsValidss #
)ss# $
{tt 
returnuu 

BadRequestuu !
(uu! "

ModelStateuu" ,
)uu, -
;uu- .
}vv 
tryxx 
{yy 
dbzz 
.zz 
Medicationszz 
.zz 
Addzz "
(zz" #

medicationzz# -
)zz- .
;zz. /
db{{ 
.{{ 
SaveChanges{{ 
({{ 
){{  
;{{  !
}|| 
catch|| 
(|| 
	Exception|| 
)|| 
{}} 
return~~ 
InternalServerError~~ *
(~~* +
)~~+ ,
;~~, -
} 
return
ÅÅ 
Ok
ÅÅ 
(
ÅÅ 

medication
ÅÅ  
)
ÅÅ  !
;
ÅÅ! "
}
ÇÇ 	
	protected
îî 
override
îî 
void
îî 
Dispose
îî  '
(
îî' (
bool
îî( ,
	disposing
îî- 6
)
îî6 7
{
ïï 	
if
ññ 
(
ññ 
	disposing
ññ 
)
ññ 
{
óó 
db
òò 
.
òò 
Dispose
òò 
(
òò 
)
òò 
;
òò 
}
ôô 
base
öö 
.
öö 
Dispose
öö 
(
öö 
	disposing
öö "
)
öö" #
;
öö# $
}
õõ 	
private
ùù 
bool
ùù 
MedicationExists
ùù %
(
ùù% &
int
ùù& )
id
ùù* ,
)
ùù, -
{
ûû 	
return
üü 
db
üü 
.
üü 
Medications
üü !
.
üü! "
Count
üü" '
(
üü' (
e
üü( )
=>
üü* ,
e
üü- .
.
üü. /
MedicationId
üü/ ;
==
üü< >
id
üü? A
)
üüA B
>
üüC D
$num
üüE F
;
üüF G
}
†† 	
}
°° 
}¢¢ Áè
?H:\AlphaMedic\AlphaMedic\Rest\Controllers\PatientsController.cs
	namespace 	
Rest
 
. 
Controllers 
{ 
[ 
RoutePrefix 
( 
$str 
)  
]  !
public 

class 
PatientsController #
:$ %
ApiController& 3
{ 
private 
AlphaMedicContext !
db" $
=% &
new' *
AlphaMedicContext+ <
(< =
)= >
;> ?
public 
PatientsController !
(! "
)" #
{$ %
}& '
public 
PatientsController !
(! "
AlphaMedicContext" 3
context4 ;
); <
{ 	
this 
. 
db 
= 
context 
; 
} 	
["" 	
Route""	 
("" 
$str"" 
)"" 
]"" 
[## 	
	Authorize##	 
(## 
Roles## 
=## 
Roles##  
.##  !
Administrator##! .
+##/ 0
$str##1 4
+##5 6
Roles##7 <
.##< =

AllDoctors##= G
+##H I
$str##J M
+##N O
Roles##P U
.##U V
Receptionist##V b
)##b c
]##c d
public$$ 
IHttpActionResult$$  
GetPatients$$! ,
($$, -
int$$- 0
page$$1 5
=$$6 7
$num$$8 9
,$$9 :
int$$; >
itemsPerPage$$? K
=$$L M
$num$$N P
,$$P Q
string%% 
sortBy%% 
=%% 
$str%% $
,%%$ %
bool%%& *
reverse%%+ 2
=%%3 4
false%%5 :
,%%: ;
string&& 
search&& 
=&& 
null&&  
,&&  !
int&&" %
?&&% &
doctor&&' -
=&&. /
null&&0 4
,&&4 5
int'' 
?'' 

department'' 
='' 
null'' "
)''" #
{(( 	
try)) 
{** 
var++ 
currentUser++ 
=++  !
db++" $
.++$ %
Users++% *
.++* +
FirstOrDefault+++ 9
(++9 :
x++: ;
=>++< >
x++? @
.++@ A
Email++A F
==++G I
this++J N
.++N O
User++O S
.++S T
Identity++T \
.++\ ]
Name++] a
)++a b
;++b c
var,, 
maybeDoctor,, 
=,,  !
db,," $
.,,$ %
Doctors,,% ,
.,,, -
FirstOrDefault,,- ;
(,,; <
x,,< =
=>,,> @
x,,A B
.,,B C
UserId,,C I
==,,J L
currentUser,,M X
.,,X Y
UserId,,Y _
),,_ `
;,,` a
if.. 
(.. 
maybeDoctor.. 
!=..  "
null..# '
)..' (
{// 
if00 
(00 
!00 
Tools00 
.00 
AnyRole00 &
(00& '
this00' +
.00+ ,
User00, 0
,000 1
Roles002 7
.007 8
DoctorRoles008 C
)00C D
)00D E
return11 
Content11 &
(11& '
HttpStatusCode11' 5
.115 6
	Forbidden116 ?
,11? @
Messages11A I
.11I J
AccsesDenied11J V
)11V W
;11W X
if33 
(33 
maybeDoctor33 #
.33# $

DoctorType33$ .
!=33/ 1

DoctorType332 <
.33< =
HospitalDean33= I
&&33J L
(44 
doctor44 
!=44 
currentUser44  +
.44+ ,
UserId44, 2
||443 5
doctor446 <
==44= ?
null44@ D
)44D E
)44E F
return55 
Content55 &
(55& '
HttpStatusCode55' 5
.555 6
	Forbidden556 ?
,55? @
Messages55A I
.55I J
AccsesDenied55J V
)55V W
;55W X
if77 
(77 
maybeDoctor77 #
.77# $

DoctorType77$ .
==77/ 1

DoctorType772 <
.77< =
HeadDepartment77= K
&&77L N
maybeDoctor88 #
.88# $
DepartmentId88$ 0
!=881 3

department884 >
&&88? A

department99 "
!=99# %
null99& *
)99* +
return:: 
Content:: &
(::& '
HttpStatusCode::' 5
.::5 6
	Forbidden::6 ?
,::? @
Messages::A I
.::I J
AccsesDenied::J V
)::V W
;::W X
};; 
var== 
users== 
=== 
db== 
.== 
Patients== '
.==' (
AsQueryable==( 3
(==3 4
)==4 5
;==5 6
if>> 
(>> 

department>> 
!=>> !
null>>" &
)>>& '
{?? 
users@@ 
=@@ 
users@@ !
.@@! "
Where@@" '
(@@' (
x@@( )
=>@@* ,
x@@- .
.@@. /
Appointments@@/ ;
.@@; <
Any@@< ?
(@@? @
d@@@ A
=>@@B D
d@@E F
.@@F G
Doctor@@G M
.@@M N
DepartmentId@@N Z
==@@[ ]

department@@^ h
)@@h i
)@@i j
;@@j k
}AA 
ifCC 
(CC 
doctorCC 
!=CC 
nullCC "
)CC" #
{DD 
usersEE 
=EE 
usersEE !
.EE! "
WhereEE" '
(EE' (
xEE( )
=>EE* ,
xEE- .
.EE. /
AppointmentsEE/ ;
.EE; <
AnyEE< ?
(EE? @
dEE@ A
=>EEB D
dEEE F
.EEF G
DoctorEEG M
.EEM N
UserIdEEN T
==EEU W
doctorEEX ^
)EE^ _
)EE_ `
;EE` a
}FF 
varHH 
nusersHH 
=HH 
usersHH "
.HH" #
SelectII 
(II 
xII 
=>II 
newII 
{JJ 
xKK 
.KK 
UserIdKK 
,KK 
xLL 
.LL 
NameLL 
,LL 
xMM 
.MM 
SurnameMM 
,MM 
URLImageNN 
=NN 
	ConstantsNN (
.NN( )

ThisServerNN) 3
+NN4 5
xNN6 7
.NN7 8
URLImageNN8 @
,NN@ A
	ProcedurePP 
=PP 
xPP  !
.PP! "
AppointmentsPP" .
.PP. /
WhereQQ 
(QQ 
aQQ 
=>QQ 
aQQ  
.QQ  !
StateQQ! &
==QQ' )
AppointmentStateQQ* :
.QQ: ;
AcceptedQQ; C
)QQC D
.RR 
SelectRR 
(RR 
pSS 
=>SS 
newSS 
{TT 
ProcedureIdUU #
=UU$ %
pUU& '
.UU' (
AppointmentIdUU( 5
,UU5 6
ProcedureNameVV %
=VV& '
pVV( )
.VV) *
	ProcedureVV* 3
.VV3 4
NameVV4 8
??VV9 ;
stringVV< B
.VVB C
EmptyVVC H
,VVH I
DoctorWW 
=WW  
(WW! "
pWW" #
.WW# $
DoctorWW$ *
!=WW+ -
nullWW. 2
?WW3 4
newXX 
{YY 
DoctorFullNameZZ *
=ZZ+ ,
pZZ- .
.ZZ. /
DoctorZZ/ 5
.ZZ5 6
NameZZ6 :
+ZZ; <
$strZZ= @
+ZZA B
pZZC D
.ZZD E
DoctorZZE K
.ZZK L
SurnameZZL S
,ZZS T
DoctorId[[ $
=[[% &
p[[' (
.[[( )
Doctor[[) /
.[[/ 0
UserId[[0 6
,[[6 7
DepartmentId\\ (
=\\) *
p\\+ ,
.\\, -
Doctor\\- 3
.\\3 4
DepartmentId\\4 @
}]] 
:^^ 
null^^ 
)^^ 
}__ 
)`` 
.`` 
OrderByDescending`` '
(``' (
i``( )
=>``* ,
i``- .
.``. /
ProcedureId``/ :
)``: ;
.aa 
FirstOrDefaultaa #
(aa# $
)aa$ %
}bb 
)cc 
.cc 
AsQueryablecc 
(cc 
)cc 
;cc  
ifgg 
(gg 
!gg 
stringgg 
.gg 
IsNullOrWhiteSpacegg .
(gg. /
searchgg/ 5
)gg5 6
)gg6 7
{hh 
searchii 
=ii 
searchii #
.ii# $
ToLowerii$ +
(ii+ ,
)ii, -
;ii- .
nusersjj 
=jj 
nusersjj #
.jj# $
Wherejj$ )
(jj) *
xjj* +
=>jj, .
(kk 
xkk 
.kk 
Namekk 
+kk  !
xkk" #
.kk# $
Surnamekk$ +
)kk+ ,
.kk, -
ToLowerkk- 4
(kk4 5
)kk5 6
.kk6 7
Containskk7 ?
(kk? @
searchkk@ F
.kkF G
ReplacekkG N
(kkN O
$strkkO R
,kkR S
$strkkT V
)kkV W
)kkW X
||kkY [
(ll 
xll 
.ll 
Surnamell "
+ll# $
xll% &
.ll& '
Namell' +
)ll+ ,
.ll, -
ToLowerll- 4
(ll4 5
)ll5 6
.ll6 7
Containsll7 ?
(ll? @
searchll@ F
.llF G
ReplacellG N
(llN O
$strllO R
,llR S
$strllT V
)llV W
)llW X
)llX Y
;llY Z
}mm 
nuserspp 
=pp 
nuserspp 
.pp  
OrderBypp  '
(pp' (
sortBypp( .
+pp/ 0
(pp1 2
reversepp2 9
?pp: ;
$strpp< H
:ppI J
$strppK M
)ppM N
)ppN O
;ppO P
varss 

usersPagedss 
=ss  
nusersss! '
.ss' (
Skipss( ,
(ss, -
(ss- .
pagess. 2
-ss3 4
$numss5 6
)ss6 7
*ss8 9
itemsPerPagess: F
)ssF G
.ssG H
TakessH L
(ssL M
itemsPerPagessM Y
)ssY Z
.ssZ [
ToArrayss[ b
(ssb c
)ssc d
;ssd e
varvv 
jsonvv 
=vv 
newvv 
JsonDtovv &
{ww 
countxx 
=xx 
nusersxx "
.xx" #
Countxx# (
(xx( )
)xx) *
,xx* +
datayy 
=yy 

usersPagedyy %
}zz 
;zz 
return|| 
Ok|| 
(|| 
json|| 
)|| 
;||  
}}} 
catch~~ 
(~~ !
ArgumentNullException~~ (
)~~( )
{ 
return
ÄÄ !
InternalServerError
ÄÄ *
(
ÄÄ* +
)
ÄÄ+ ,
;
ÄÄ, -
}
ÅÅ 
catch
ÇÇ 
(
ÇÇ 
ArgumentException
ÇÇ $
)
ÇÇ$ %
{
ÉÉ 
return
ÑÑ 

BadRequest
ÑÑ !
(
ÑÑ! "
)
ÑÑ" #
;
ÑÑ# $
}
ÖÖ 
}
ÜÜ 	
[
áá 	
	Authorize
áá	 
]
áá 
[
àà 	
Route
àà	 
(
àà 
$str
àà "
)
àà" #
]
àà# $
public
ââ 
IHttpActionResult
ââ  #
GetPatientsByDoctorId
ââ! 6
(
ââ6 7
int
ââ7 :
id
ââ; =
)
ââ= >
{
ää 	
var
ãã 
currentUser
ãã 
=
ãã 
db
ãã  
.
ãã  !
Users
ãã! &
.
ãã& '
FirstOrDefault
ãã' 5
(
ãã5 6
x
ãã6 7
=>
ãã8 :
x
ãã; <
.
ãã< =
Email
ãã= B
==
ããC E
this
ããF J
.
ããJ K
User
ããK O
.
ããO P
Identity
ããP X
.
ããX Y
Name
ããY ]
)
ãã] ^
;
ãã^ _
if
çç 
(
çç 
(
çç 
Tools
çç 
.
çç 
AnyRole
çç 
(
çç 
this
çç #
.
çç# $
User
çç$ (
,
çç( )
Roles
çç* /
.
çç/ 0
DoctorRoles
çç0 ;
)
çç; <
&&
çç= ?
currentUser
çç@ K
.
ççK L
UserId
ççL R
!=
ççS U
id
ççV X
)
ççX Y
&&
ççZ \
!
çç] ^
this
çç^ b
.
ççb c
User
ççc g
.
ççg h
IsInRole
ççh p
(
ççp q
Roles
ççq v
.
ççv w
Receptionistççw É
)ççÉ Ñ
)ççÑ Ö
{
éé 
return
èè 
Content
èè 
(
èè 
HttpStatusCode
èè -
.
èè- .
	Forbidden
èè. 7
,
èè7 8
Messages
èè9 A
.
èèA B
AccsesDenied
èèB N
)
èèN O
;
èèO P
}
êê 
var
íí 
dep
íí 
=
íí 
db
íí 
.
íí 
Doctors
íí  
.
íí  !
FirstOrDefault
íí! /
(
íí/ 0
x
íí0 1
=>
íí2 4
x
íí5 6
.
íí6 7
UserId
íí7 =
==
íí> @
id
ííA C
)
ííC D
.
ííD E

Department
ííE O
;
ííO P
var
ìì 
data
ìì 
=
ìì 
new
ìì 
{
îî 

Department
ïï 
=
ïï 
new
ïï  
{
ññ 
dep
óó 
.
óó 
DepartmentId
óó $
,
óó$ %
dep
òò 
.
òò 
Name
òò 
}
ôô 
,
ôô 
Patients
öö 
=
öö 
db
öö 
.
öö 
Appointments
öö *
.
öö* +
Where
öö+ 0
(
öö0 1
x
öö1 2
=>
öö3 5
x
öö6 7
.
öö7 8
DoctorId
öö8 @
==
ööA C
id
ööD F
)
ööF G
.
ööG H
Select
ööH N
(
ööN O
p
ööO P
=>
ööQ S
p
ööT U
.
ööU V
Patient
ööV ]
)
öö] ^
.
öö^ _
Select
öö_ e
(
ööe f
a
ööf g
=>
ööh j
new
öök n
{
õõ 
a
úú 
.
úú 
UserId
úú 
,
úú 
a
ùù 
.
ùù 
Name
ùù 
,
ùù 
a
ûû 
.
ûû 
Surname
ûû 
,
ûû 
URLImage
üü 
=
üü 
Models
üü %
.
üü% &
	Constants
üü& /
.
üü/ 0

ThisServer
üü0 :
+
üü; <
a
üü= >
.
üü> ?
URLImage
üü? G
,
üüG H
	Procedure
°° 
=
°° 
a
°°  !
.
°°! "
Appointments
°°" .
.
°°. /
Select
°°/ 5
(
°°5 6
p
¢¢ 
=>
¢¢ 
new
¢¢ 
{
££ 
p
§§ 
.
§§ 
AppointmentId
§§ *
,
§§* +
ProcedureName
•• (
=
••) *
p
••+ ,
.
••, -
	Procedure
••- 6
.
••6 7
Name
••7 ;
,
••; <
DoctorFullName
¶¶ )
=
¶¶* +
p
¶¶, -
.
¶¶- .
Doctor
¶¶. 4
.
¶¶4 5
Name
¶¶5 9
+
¶¶: ;
$str
¶¶< ?
+
¶¶@ A
p
¶¶B C
.
¶¶C D
Doctor
¶¶D J
.
¶¶J K
Surname
¶¶K R
,
¶¶R S
DoctorId
ßß #
=
ßß$ %
p
ßß& '
.
ßß' (
Doctor
ßß( .
.
ßß. /
UserId
ßß/ 5
}
®® 
)
©© 
.
©© 
FirstOrDefault
©© '
(
©©' (
)
©©( )
}
™™ 
)
´´  
.
´´  !
AsQueryable
´´! ,
(
´´, -
)
´´- .
}
ÆÆ 
;
ÆÆ 
return
∞∞ 
Ok
∞∞ 
(
∞∞ 
data
∞∞ 
)
∞∞ 
;
∞∞ 
}
±± 	
[
µµ 	
HttpPost
µµ	 
]
µµ 
[
∂∂ 	
Route
∂∂	 
(
∂∂ 
$str
∂∂ -
)
∂∂- .
]
∂∂. /
[
∑∑ 	
ResponseType
∑∑	 
(
∑∑ 
typeof
∑∑ 
(
∑∑ 
void
∑∑ !
)
∑∑! "
)
∑∑" #
]
∑∑# $
public
∏∏ 
IHttpActionResult
∏∏  &
SendConfirmRegisterEmail
∏∏! 9
(
∏∏9 :
int
∏∏: =
id
∏∏> @
,
∏∏@ A
object
∏∏B H
user
∏∏I M
)
∏∏M N
{
ππ 	

EmailInput
ªª 

emailInput
ªª !
=
ªª" #
new
ªª$ '

EmailInput
ªª( 2
(
ªª2 3
)
ªª3 4
;
ªª4 5
var
ºº 
pat
ºº 
=
ºº 
db
ºº 
.
ºº 
Patients
ºº !
.
ºº! "
Find
ºº" &
(
ºº& '
id
ºº' )
)
ºº) *
;
ºº* +

emailInput
ΩΩ 
.
ΩΩ 
UserName
ΩΩ 
=
ΩΩ  !
pat
ΩΩ" %
.
ΩΩ% &
FullName
ΩΩ& .
;
ΩΩ. /

emailInput
ææ 
.
ææ 
Email
ææ 
=
ææ 
pat
ææ "
.
ææ" #
Email
ææ# (
;
ææ( )

emailInput
øø 
.
øø 
Subject
øø 
=
øø  
$str
øø! 8
;
øø8 9
try
¡¡ 
{
¬¬ 
}
ƒƒ 
catch
≈≈ 
(
≈≈ 
	Exception
≈≈ 
)
≈≈ 
{
∆∆ 
return
«« 

BadRequest
«« !
(
««! "
)
««" #
;
««# $
}
»» 
return
   
Ok
   
(
   
)
   
;
   
}
ÃÃ 	
[
ŒŒ 	
	Authorize
ŒŒ	 
]
ŒŒ 
[
œœ 	
Route
œœ	 
(
œœ 
$str
œœ 5
)
œœ5 6
]
œœ6 7
public
—— 
IHttpActionResult
——  $
GetPatientAppointments
——! 7
(
——7 8
int
——8 ;
id
——< >
)
——> ?
{
““ 	
var
”” 
currentUser
”” 
=
”” 
db
””  
.
””  !
Users
””! &
.
””& '
FirstOrDefault
””' 5
(
””5 6
x
””6 7
=>
””8 :
x
””; <
.
””< =
Email
””= B
==
””C E
this
””F J
.
””J K
User
””K O
.
””O P
Identity
””P X
.
””X Y
Name
””Y ]
)
””] ^
;
””^ _
if
’’ 
(
’’ 
currentUser
’’ 
==
’’ 
null
’’ #
)
’’# $
{
÷÷ 
return
◊◊ 
NotFound
◊◊ 
(
◊◊  
)
◊◊  !
;
◊◊! "
}
ÿÿ 
if
⁄⁄ 
(
⁄⁄ 
this
⁄⁄ 
.
⁄⁄ 
User
⁄⁄ 
.
⁄⁄ 
IsInRole
⁄⁄ "
(
⁄⁄" #
Roles
⁄⁄# (
.
⁄⁄( )
Patient
⁄⁄) 0
)
⁄⁄0 1
&&
⁄⁄2 4
currentUser
⁄⁄5 @
.
⁄⁄@ A
UserId
⁄⁄A G
!=
⁄⁄H J
id
⁄⁄K M
)
⁄⁄M N
{
€€ 
return
‹‹ 
Content
‹‹ 
(
‹‹ 
HttpStatusCode
‹‹ -
.
‹‹- .
	Forbidden
‹‹. 7
,
‹‹7 8
Messages
‹‹9 A
.
‹‹A B
AccsesDenied
‹‹B N
)
‹‹N O
;
‹‹O P
}
›› 
var
ﬂﬂ 
result
ﬂﬂ 
=
ﬂﬂ 
db
ﬂﬂ 
.
ﬂﬂ 
Appointments
ﬂﬂ (
.
ﬂﬂ( )
Where
ﬂﬂ) .
(
ﬂﬂ. /
x
ﬂﬂ/ 0
=>
ﬂﬂ1 3
x
ﬂﬂ4 5
.
ﬂﬂ5 6
	PatientId
ﬂﬂ6 ?
==
ﬂﬂ@ B
id
ﬂﬂC E
&&
ﬂﬂF H
x
ﬂﬂH I
.
ﬂﬂI J
State
ﬂﬂJ O
!=
ﬂﬂO Q
AppointmentState
ﬂﬂQ a
.
ﬂﬂa b
Finished
ﬂﬂb j
)
ﬂﬂj k
.
ﬂﬂk l
Select
ﬂﬂl r
(
ﬂﬂr s
x
ﬂﬂs t
=>
ﬂﬂu w
new
ﬂﬂx {
{
‡‡ 
x
·· 
.
·· 
AppointmentId
·· "
,
··" #
x
‚‚ 
.
‚‚ 
Date
‚‚ 
,
‚‚ 
x
„„ 
.
„„ 
Duration
„„ 
,
„„ 
State
‰‰ 
=
‰‰ 
x
‰‰ 
.
‰‰ 
State
‰‰ "
.
‰‰" #
ToString
‰‰# +
(
‰‰+ ,
)
‰‰, -
,
‰‰- .
x
ÂÂ 
.
ÂÂ 
DoctorId
ÂÂ 
,
ÂÂ 
x
ÊÊ 
.
ÊÊ 
Doctor
ÊÊ 
.
ÊÊ 
Name
ÊÊ  
,
ÊÊ  !
x
ÁÁ 
.
ÁÁ 
Doctor
ÁÁ 
.
ÁÁ 
Surname
ÁÁ #
}
ËË 
)
ÈÈ 
;
ÈÈ 
var
ÎÎ 
result2
ÎÎ 
=
ÎÎ 
result
ÎÎ  
.
ÎÎ  !
Where
ÎÎ! &
(
ÎÎ& '
x
ÎÎ' (
=>
ÎÎ) +
x
ÎÎ, -
.
ÎÎ- .
Date
ÎÎ. 2
==
ÎÎ3 5
null
ÎÎ6 :
)
ÎÎ: ;
;
ÎÎ; <
var
ÏÏ 
result3
ÏÏ 
=
ÏÏ 
result
ÏÏ  
.
ÏÏ  !
Where
ÏÏ! &
(
ÏÏ& '
x
ÏÏ' (
=>
ÏÏ) +
x
ÏÏ, -
.
ÏÏ- .
Date
ÏÏ. 2
>
ÏÏ3 4
DateTime
ÏÏ5 =
.
ÏÏ= >
Now
ÏÏ> A
)
ÏÏA B
.
ÏÏB C
OrderByDescending
ÏÏC T
(
ÏÏT U
x
ÏÏU V
=>
ÏÏW Y
x
ÏÏZ [
.
ÏÏ[ \
Date
ÏÏ\ `
)
ÏÏ` a
;
ÏÏa b
result
ÓÓ 
=
ÓÓ 
result2
ÓÓ 
.
ÓÓ 
Concat
ÓÓ #
(
ÓÓ# $
result3
ÓÓ$ +
)
ÓÓ+ ,
;
ÓÓ, -
return
ÒÒ 
Ok
ÒÒ 
(
ÒÒ 
result
ÒÒ 
)
ÒÒ 
;
ÒÒ 
}
ÚÚ 	
[
˜˜ 	
	Authorize
˜˜	 
]
˜˜ 
[
¯¯ 	
Route
¯¯	 
(
¯¯ 
$str
¯¯ 
,
¯¯ 
Name
¯¯ 
=
¯¯  !
$str
¯¯" 2
)
¯¯2 3
]
¯¯3 4
public
˘˘ 
IHttpActionResult
˘˘  

GetPatient
˘˘! +
(
˘˘+ ,
int
˘˘, /
id
˘˘0 2
)
˘˘2 3
{
˙˙ 	
var
˚˚ 
patient
˚˚ 
=
˚˚ 
db
˚˚ 
.
˚˚ 
Patients
˚˚ %
.
˚˚% &
FirstOrDefault
˚˚& 4
(
˚˚4 5
x
˚˚5 6
=>
˚˚7 9
x
˚˚: ;
.
˚˚; <
UserId
˚˚< B
==
˚˚C E
id
˚˚F H
)
˚˚H I
;
˚˚I J
if
˝˝ 
(
˝˝ 
!
˝˝ 

ModelState
˝˝ 
.
˝˝ 
IsValid
˝˝ #
||
˝˝$ &
patient
˝˝' .
==
˝˝/ 1
null
˝˝2 6
)
˝˝6 7
{
˛˛ 
return
ˇˇ 
NotFound
ˇˇ 
(
ˇˇ  
)
ˇˇ  !
;
ˇˇ! "
}
ÄÄ 
var
ÇÇ 
currentUser
ÇÇ 
=
ÇÇ 
db
ÇÇ  
.
ÇÇ  !
Users
ÇÇ! &
.
ÇÇ& '
FirstOrDefault
ÇÇ' 5
(
ÇÇ5 6
x
ÇÇ6 7
=>
ÇÇ8 :
x
ÇÇ; <
.
ÇÇ< =
Email
ÇÇ= B
==
ÇÇC E
User
ÇÇF J
.
ÇÇJ K
Identity
ÇÇK S
.
ÇÇS T
Name
ÇÇT X
)
ÇÇX Y
;
ÇÇY Z
if
ÑÑ 
(
ÑÑ 
currentUser
ÑÑ 
==
ÑÑ 
null
ÑÑ #
)
ÑÑ# $
return
ÖÖ 
NotFound
ÖÖ 
(
ÖÖ  
)
ÖÖ  !
;
ÖÖ! "
if
áá 
(
áá 
User
áá 
.
áá 
IsInRole
áá 
(
áá 
Roles
áá #
.
áá# $
Patient
áá$ +
)
áá+ ,
&&
áá- /
id
áá0 2
!=
áá3 5
currentUser
áá6 A
.
ááA B
UserId
ááB H
)
ááH I
return
àà 
Content
àà 
(
àà 
HttpStatusCode
àà -
.
àà- .
	Forbidden
àà. 7
,
àà7 8
Messages
àà9 A
.
ààA B
AccsesDenied
ààB N
)
ààN O
;
ààO P
if
ää 
(
ää 
Tools
ää 
.
ää 
AnyRole
ää 
(
ää 
this
ää "
.
ää" #
User
ää# '
,
ää' (
Roles
ää) .
.
ää. /
DoctorRoles
ää/ :
)
ää: ;
)
ää; <
{
ãã 
if
åå 
(
åå 
User
åå 
.
åå 
IsInRole
åå !
(
åå! "
Roles
åå" '
.
åå' (
Doctor
åå( .
)
åå. /
&&
åå0 2
!
åå3 4
patient
åå4 ;
.
åå; <
Appointments
åå< H
.
ååH I
Any
ååI L
(
ååL M
x
ååM N
=>
ååO Q
x
ååR S
.
ååS T
DoctorId
ååT \
==
åå] _
currentUser
åå` k
.
ååk l
UserId
åål r
)
åår s
)
åås t
return
çç 
Content
çç "
(
çç" #
HttpStatusCode
çç# 1
.
çç1 2
	Forbidden
çç2 ;
,
çç; <
Messages
çç= E
.
ççE F
AccsesDenied
ççF R
)
ççR S
;
ççS T
var
èè 

department
èè 
=
èè  
db
èè! #
.
èè# $
Doctors
èè$ +
.
èè+ ,
FirstOrDefault
èè, :
(
èè: ;
x
èè; <
=>
èè= ?
x
èè@ A
.
èèA B
Email
èèB G
==
èèH J
this
èèK O
.
èèO P
User
èèP T
.
èèT U
Identity
èèU ]
.
èè] ^
Name
èè^ b
)
èèb c
.
èèc d
DepartmentId
èèd p
;
èèp q
if
êê 
(
êê 

department
êê 
==
êê !
default
êê" )
(
êê) *
int
êê* -
)
êê- .
)
êê. /
return
ëë 
NotFound
ëë #
(
ëë# $
)
ëë$ %
;
ëë% &
if
ìì 
(
ìì 
User
ìì 
.
ìì 
IsInRole
ìì !
(
ìì! "
Roles
ìì" '
.
ìì' (
DepartmentHead
ìì( 6
)
ìì6 7
&&
ìì8 :
!
îî 
patient
îî 
.
îî 
Appointments
îî %
.
îî% &
Any
îî& )
(
îî) *
d
îî* +
=>
îî, .
d
îî/ 0
.
îî0 1
Doctor
îî1 7
.
îî7 8
DepartmentId
îî8 D
==
îîE G

department
îîH R
)
îîR S
)
îîS T
return
ïï 
Content
ïï "
(
ïï" #
HttpStatusCode
ïï# 1
.
ïï1 2
	Forbidden
ïï2 ;
,
ïï; <
Messages
ïï= E
.
ïïE F
AccsesDenied
ïïF R
)
ïïR S
;
ïïS T
}
ññ 
var
òò 
responce
òò 
=
òò 
new
òò 
{
ôô 
patient
öö 
.
öö 
UserId
öö 
,
öö 
patient
õõ 
.
õõ 
FullName
õõ  
,
õõ  !
patient
úú 
.
úú 
DateOfBirth
úú #
,
úú# $
patient
ùù 
.
ùù 
Phone
ùù 
,
ùù 
patient
ûû 
.
ûû 
Name
ûû 
,
ûû 
patient
üü 
.
üü 
Surname
üü 
,
üü  
patient
†† 
.
†† 
Address
†† 
,
††  
Gender
°° 
=
°° 
patient
°°  
.
°°  !
Gender
°°! '
.
°°' (
ToString
°°( 0
(
°°0 1
)
°°1 2
,
°°2 3
patient
¢¢ 
.
¢¢ 

BloodGroup
¢¢ "
,
¢¢" #
URLImage
££ 
=
££ 
	Constants
££ $
.
££$ %

ThisServer
££% /
+
££0 1
patient
££2 9
.
££9 :
URLImage
££: B
}
§§ 
;
§§ 
return
¶¶ 
Ok
¶¶ 
(
¶¶ 
responce
¶¶ 
)
¶¶ 
;
¶¶  
}
ßß 	
[
©© 	
	Authorize
©©	 
(
©© 
Roles
©© 
=
©© 
Roles
©©  
.
©©  !
Administrator
©©! .
)
©©. /
]
©©/ 0
[
™™ 	
Route
™™	 
(
™™ 
$str
™™ 
,
™™ 
Name
™™ "
=
™™# $
$str
™™% 2
)
™™2 3
]
™™3 4
public
´´ 
IHttpActionResult
´´  
GetAllPatients
´´! /
(
´´/ 0
int
´´0 3
page
´´4 8
=
´´9 :
$num
´´; <
,
´´< =
int
´´> A
itemsPerPage
´´B N
=
´´O P
$num
´´Q S
,
´´S T
string
¨¨ 
sortBy
¨¨ 
=
¨¨ 
$str
¨¨ $
,
¨¨$ %
bool
¨¨& *
reverse
¨¨+ 2
=
¨¨3 4
false
¨¨5 :
,
¨¨: ;
string
≠≠ 
search
≠≠ 
=
≠≠ 
null
≠≠  
,
≠≠  !
bool
≠≠" &
?
≠≠& '
isActive
≠≠( 0
=
≠≠1 2
null
≠≠3 7
)
≠≠7 8
{
ÆÆ 	
var
ØØ 
users
ØØ 
=
ØØ 
db
ØØ 
.
ØØ 
Patients
ØØ #
.
ØØ# $
Select
ØØ$ *
(
ØØ* +
p
∞∞ 
=>
∞∞ 
new
∞∞ 
{
±± 
p
≤≤ 
.
≤≤ 
Name
≤≤ 
,
≤≤ 
p
≥≥ 
.
≥≥ 
Surname
≥≥ 
,
≥≥ 
Gender
¥¥ 
=
¥¥ 
p
¥¥ 
.
¥¥  
Gender
¥¥  &
.
¥¥& '
ToString
¥¥' /
(
¥¥/ 0
)
¥¥0 1
,
¥¥1 2
p
µµ 
.
µµ 
DateOfBirth
µµ "
,
µµ" #
p
∂∂ 
.
∂∂ 
Phone
∂∂ 
,
∂∂ 
p
∑∑ 
.
∑∑ 
Address
∑∑ 
,
∑∑ 
p
∏∏ 
.
∏∏ 
Email
∏∏ 
,
∏∏ 
p
ππ 
.
ππ 
Active
ππ 
,
ππ 
p
∫∫ 
.
∫∫ 
UserId
∫∫ 
}
ºº 
)
ºº 
;
ºº 
if
ææ 
(
ææ 
isActive
ææ 
!=
ææ 
null
ææ  
)
ææ  !
{
øø 
users
¿¿ 
=
¿¿ 
users
¿¿ 
.
¿¿ 
Where
¿¿ #
(
¿¿# $
x
¿¿$ %
=>
¿¿& (
x
¿¿) *
.
¿¿* +
Active
¿¿+ 1
==
¿¿2 4
isActive
¿¿5 =
)
¿¿= >
;
¿¿> ?
}
¡¡ 
if
√√ 
(
√√ 
!
√√ 
string
√√ 
.
√√  
IsNullOrWhiteSpace
√√ *
(
√√* +
search
√√+ 1
)
√√1 2
)
√√2 3
{
ƒƒ 
search
≈≈ 
=
≈≈ 
search
≈≈ 
.
≈≈  
ToLower
≈≈  '
(
≈≈' (
)
≈≈( )
;
≈≈) *
users
∆∆ 
=
∆∆ 
users
∆∆ 
.
∆∆ 
Where
∆∆ #
(
∆∆# $
x
∆∆$ %
=>
∆∆& (
x
«« 
.
«« 
Name
«« 
.
«« 
ToLower
«« "
(
««" #
)
««# $
.
««$ %
Contains
««% -
(
««- .
search
««. 4
)
««4 5
||
««6 8
x
»» 
.
»» 
Surname
»» 
.
»» 
ToLower
»» %
(
»»% &
)
»»& '
.
»»' (
Contains
»»( 0
(
»»0 1
search
»»1 7
)
»»7 8
)
»»8 9
;
»»9 :
}
…… 
users
ÃÃ 
=
ÃÃ 
users
ÃÃ 
.
ÃÃ 
OrderBy
ÃÃ !
(
ÃÃ! "
sortBy
ÃÃ" (
+
ÃÃ) *
(
ÃÃ+ ,
reverse
ÃÃ, 3
?
ÃÃ4 5
$str
ÃÃ6 B
:
ÃÃC D
$str
ÃÃE G
)
ÃÃG H
)
ÃÃH I
;
ÃÃI J
var
œœ 

usersPaged
œœ 
=
œœ 
users
œœ "
.
œœ" #
Skip
œœ# '
(
œœ' (
(
œœ( )
page
œœ) -
-
œœ. /
$num
œœ0 1
)
œœ1 2
*
œœ3 4
itemsPerPage
œœ5 A
)
œœA B
.
œœB C
Take
œœC G
(
œœG H
itemsPerPage
œœH T
)
œœT U
;
œœU V
var
““ 
json
““ 
=
““ 
new
““ 
{
”” 
count
‘‘ 
=
‘‘ 
users
‘‘ 
.
‘‘ 
Count
‘‘ #
(
‘‘# $
)
‘‘$ %
,
‘‘% &
data
’’ 
=
’’ 

usersPaged
’’ !
}
÷÷ 
;
÷÷ 
return
ÿÿ 
Ok
ÿÿ 
(
ÿÿ 
json
ÿÿ 
)
ÿÿ 
;
ÿÿ 
}
⁄⁄ 	
[
ﬁﬁ 	
ResponseType
ﬁﬁ	 
(
ﬁﬁ 
typeof
ﬁﬁ 
(
ﬁﬁ 
void
ﬁﬁ !
)
ﬁﬁ! "
)
ﬁﬁ" #
]
ﬁﬁ# $
[
ﬂﬂ 	
HttpPut
ﬂﬂ	 
]
ﬂﬂ 
[
‡‡ 	
Route
‡‡	 
(
‡‡ 
$str
‡‡ %
,
‡‡% &
Name
‡‡' +
=
‡‡, -
$str
‡‡. ;
)
‡‡; <
]
‡‡< =
public
·· 
IHttpActionResult
··  
PutUser2
··! )
(
··) *
int
··* -
id
··. 0
,
··0 1
object
··2 8
state
··9 >
)
··> ?
{
‚‚ 	
var
„„ 
user
„„ 
=
„„ 
db
„„ 
.
„„ 
Users
„„ 
.
„„  
Find
„„  $
(
„„$ %
id
„„% '
)
„„' (
;
„„( )
if
ÂÂ 
(
ÂÂ 
user
ÂÂ 
==
ÂÂ 
null
ÂÂ 
)
ÂÂ 
{
ÊÊ 
return
ÁÁ 
NotFound
ÁÁ 
(
ÁÁ  
)
ÁÁ  !
;
ÁÁ! "
}
ËË 
if
ÎÎ 
(
ÎÎ 
user
ÎÎ 
.
ÎÎ 
Active
ÎÎ 
!=
ÎÎ 
true
ÎÎ #
)
ÎÎ# $
{
ÏÏ 
user
ÌÌ 
.
ÌÌ 
Active
ÌÌ 
=
ÌÌ 
true
ÌÌ "
;
ÌÌ" #
}
ÓÓ 
db
 
.
 
Entry
 
(
 
user
 
)
 
.
 
State
  
=
! "
EntityState
# .
.
. /
Modified
/ 7
;
7 8
try
ÚÚ 
{
ÛÛ 
db
ÙÙ 
.
ÙÙ 
SaveChanges
ÙÙ 
(
ÙÙ 
)
ÙÙ  
;
ÙÙ  !
return
ıı 
Ok
ıı 
(
ıı 
)
ıı 
;
ıı 
}
ˆˆ 
catch
˜˜ 
(
˜˜ *
DbUpdateConcurrencyException
˜˜ /
)
˜˜/ 0
{
¯¯ 
if
˘˘ 
(
˘˘ 
!
˘˘ 
PatientExists
˘˘ "
(
˘˘" #
id
˘˘# %
)
˘˘% &
)
˘˘& '
{
˙˙ 
return
˚˚ 
NotFound
˚˚ #
(
˚˚# $
)
˚˚$ %
;
˚˚% &
}
¸¸ 
else
˝˝ 
{
˛˛ 
throw
ˇˇ 
;
ˇˇ 
}
ÄÄ 
}
ÅÅ 
return
ÉÉ 

StatusCode
ÉÉ 
(
ÉÉ 
HttpStatusCode
ÉÉ ,
.
ÉÉ, -
	NoContent
ÉÉ- 6
)
ÉÉ6 7
;
ÉÉ7 8
}
ÑÑ 	
[
áá 	
	Authorize
áá	 
(
áá 
Roles
áá 
=
áá 
Roles
áá  
.
áá  !
Patient
áá! (
)
áá( )
]
áá) *
[
àà 	
ResponseType
àà	 
(
àà 
typeof
àà 
(
àà 
void
àà !
)
àà! "
)
àà" #
]
àà# $
[
ââ 	
HttpPut
ââ	 
]
ââ 
[
ää 	
Route
ää	 
(
ää 
$str
ää $
,
ää$ %
Name
ää& *
=
ää+ ,
$str
ää- :
)
ää: ;
]
ää; <
public
ãã 
IHttpActionResult
ãã  

PutPatient
ãã! +
(
ãã+ ,
int
ãã, /
id
ãã0 2
,
ãã2 3

ChangePass
ãã4 >
user
ãã? C
)
ããC D
{
åå 	
var
çç 
currentUser
çç 
=
çç 
db
çç  
.
çç  !
Users
çç! &
.
çç& '
FirstOrDefault
çç' 5
(
çç5 6
x
çç6 7
=>
çç8 :
x
çç; <
.
çç< =
Email
çç= B
==
ççC E
this
ççF J
.
ççJ K
User
ççK O
.
ççO P
Identity
ççP X
.
ççX Y
Name
ççY ]
)
çç] ^
;
çç^ _
var
êê 
tmp
êê 
=
êê 
db
êê 
.
êê 
Users
êê 
.
êê 
Find
êê #
(
êê# $
id
êê$ &
)
êê& '
;
êê' (
if
íí 
(
íí 
tmp
íí 
==
íí 
null
íí 
)
íí 
{
ìì 
return
îî 
NotFound
îî 
(
îî  
)
îî  !
;
îî! "
}
ïï 
if
óó 
(
óó 
currentUser
óó 
.
óó 
UserId
óó "
!=
óó# %
id
óó& (
)
óó( )
{
òò 
return
ôô 
Content
ôô 
(
ôô 
HttpStatusCode
ôô -
.
ôô- .
	Forbidden
ôô. 7
,
ôô7 8
Messages
ôô9 A
.
ôôA B
AccsesDenied
ôôB N
)
ôôN O
;
ôôO P
}
öö 
if
úú 
(
úú 
user
úú 
.
úú 
OldPass
úú 
!=
úú 
tmp
úú  #
.
úú# $
Password
úú$ ,
)
úú, -
{
ùù 
return
ûû 

BadRequest
ûû !
(
ûû! "
)
ûû" #
;
ûû# $
}
üü 
tmp
°° 
.
°° 
Password
°° 
=
°° 
user
°° 
.
°°  
NewPass
°°  '
;
°°' (
db
§§ 
.
§§ 
Entry
§§ 
(
§§ 
tmp
§§ 
)
§§ 
.
§§ 
State
§§ 
=
§§  !
EntityState
§§" -
.
§§- .
Modified
§§. 6
;
§§6 7
try
¶¶ 
{
ßß 
db
®® 
.
®® 
SaveChanges
®® 
(
®® 
)
®®  
;
®®  !
return
©© 
Ok
©© 
(
©© 
)
©© 
;
©© 
}
™™ 
catch
´´ 
(
´´ *
DbUpdateConcurrencyException
´´ /
)
´´/ 0
{
¨¨ 
if
≠≠ 
(
≠≠ 
!
≠≠ 
PatientExists
≠≠ "
(
≠≠" #
id
≠≠# %
)
≠≠% &
)
≠≠& '
{
ÆÆ 
return
ØØ 
NotFound
ØØ #
(
ØØ# $
)
ØØ$ %
;
ØØ% &
}
∞∞ 
else
±± 
{
≤≤ 
throw
≥≥ 
;
≥≥ 
}
¥¥ 
}
µµ 
return
∑∑ 

StatusCode
∑∑ 
(
∑∑ 
HttpStatusCode
∑∑ ,
.
∑∑, -
	NoContent
∑∑- 6
)
∑∑6 7
;
∑∑7 8
}
∏∏ 	
[
ΩΩ 	
ResponseType
ΩΩ	 
(
ΩΩ 
typeof
ΩΩ 
(
ΩΩ 
void
ΩΩ !
)
ΩΩ! "
)
ΩΩ" #
]
ΩΩ# $
[
ææ 	
HttpPut
ææ	 
]
ææ 
[
øø 	
Route
øø	 
(
øø 
$str
øø 
,
øø 
Name
øø 
=
øø  !
$str
øø" .
)
øø. /
]
øø/ 0
public
¿¿ 
IHttpActionResult
¿¿  

PutPatient
¿¿! +
(
¿¿+ ,
int
¿¿, /
id
¿¿0 2
,
¿¿2 3
Patient
¿¿4 ;
user
¿¿< @
)
¿¿@ A
{
¡¡ 	
if
«« 
(
«« 
id
«« 
!=
«« 
user
«« 
.
«« 
UserId
«« !
)
««! "
{
»» 
return
…… 

BadRequest
…… !
(
……! "
)
……" #
;
……# $
}
   
var
ÃÃ 
tmp
ÃÃ 
=
ÃÃ 
db
ÃÃ 
.
ÃÃ 
Users
ÃÃ 
.
ÃÃ 
Find
ÃÃ #
(
ÃÃ# $
id
ÃÃ$ &
)
ÃÃ& '
;
ÃÃ' (
if
ÕÕ 
(
ÕÕ 
tmp
ÕÕ 
==
ÕÕ 
null
ÕÕ 
)
ÕÕ 
{
ŒŒ 
return
œœ 
NotFound
œœ 
(
œœ  
)
œœ  !
;
œœ! "
}
–– 
tmp
““ 
.
““ 
Name
““ 
=
““ 
user
““ 
.
““ 
Name
““  
;
““  !
tmp
”” 
.
”” 
Surname
”” 
=
”” 
user
”” 
.
”” 
Surname
”” &
;
””& '
tmp
‘‘ 
.
‘‘ 
Phone
‘‘ 
=
‘‘ 
user
‘‘ 
.
‘‘ 
Phone
‘‘ "
;
‘‘" #
tmp
’’ 
.
’’ 
DateOfBirth
’’ 
=
’’ 
user
’’ "
.
’’" #
DateOfBirth
’’# .
;
’’. /
tmp
÷÷ 
.
÷÷ 
Address
÷÷ 
=
÷÷ 
user
÷÷ 
.
÷÷ 
Address
÷÷ &
;
÷÷& '
tmp
◊◊ 
.
◊◊ 
Gender
◊◊ 
=
◊◊ 
user
◊◊ 
.
◊◊ 
Gender
◊◊ $
;
◊◊$ %
db
⁄⁄ 
.
⁄⁄ 
Entry
⁄⁄ 
(
⁄⁄ 
tmp
⁄⁄ 
)
⁄⁄ 
.
⁄⁄ 
State
⁄⁄ 
=
⁄⁄  !
EntityState
⁄⁄" -
.
⁄⁄- .
Modified
⁄⁄. 6
;
⁄⁄6 7
try
‹‹ 
{
›› 
db
ﬁﬁ 
.
ﬁﬁ 
SaveChanges
ﬁﬁ 
(
ﬁﬁ 
)
ﬁﬁ  
;
ﬁﬁ  !
}
ﬂﬂ 
catch
‡‡ 
(
‡‡ *
DbUpdateConcurrencyException
‡‡ /
)
‡‡/ 0
{
·· 
if
‚‚ 
(
‚‚ 
!
‚‚ 
PatientExists
‚‚ "
(
‚‚" #
id
‚‚# %
)
‚‚% &
)
‚‚& '
{
„„ 
return
‰‰ 
NotFound
‰‰ #
(
‰‰# $
)
‰‰$ %
;
‰‰% &
}
ÂÂ 
else
ÊÊ 
{
ÁÁ 
throw
ËË 
;
ËË 
}
ÈÈ 
}
ÍÍ 
catch
ÎÎ 
(
ÎÎ 
	Exception
ÎÎ 
ex
ÎÎ 
)
ÎÎ  
{
ÏÏ 
return
ÌÌ !
InternalServerError
ÌÌ *
(
ÌÌ* +
ex
ÌÌ+ -
)
ÌÌ- .
;
ÌÌ. /
}
ÓÓ 
return
 

StatusCode
 
(
 
HttpStatusCode
 ,
.
, -
	NoContent
- 6
)
6 7
;
7 8
}
ÒÒ 	
[
ıı 	
Route
ıı	 
(
ıı 
$str
ıı 
)
ıı 
]
ıı 
[
ˆˆ 	
ResponseType
ˆˆ	 
(
ˆˆ 
typeof
ˆˆ 
(
ˆˆ 
Patient
ˆˆ $
)
ˆˆ$ %
)
ˆˆ% &
]
ˆˆ& '
public
˜˜ 
IHttpActionResult
˜˜  
PostPatient
˜˜! ,
(
˜˜, -
Patient
˜˜- 4
patient
˜˜5 <
)
˜˜< =
{
¯¯ 	
if
˘˘ 
(
˘˘ 
!
˘˘ 

ModelState
˘˘ 
.
˘˘ 
IsValid
˘˘ #
||
˘˘$ &
db
˘˘' )
.
˘˘) *
Users
˘˘* /
.
˘˘/ 0
Any
˘˘0 3
(
˘˘3 4
x
˘˘4 5
=>
˘˘6 8
x
˘˘9 :
.
˘˘: ;
Email
˘˘; @
==
˘˘A C
patient
˘˘D K
.
˘˘K L
Email
˘˘L Q
)
˘˘Q R
)
˘˘R S
{
˙˙ 
return
˚˚ 

BadRequest
˚˚ !
(
˚˚! "

ModelState
˚˚" ,
)
˚˚, -
;
˚˚- .
}
¸¸ 
var
˛˛ 
medicalHistory
˛˛ 
=
˛˛  
new
˛˛! $
MedicalHistory
˛˛% 3
(
˛˛3 4
)
˛˛4 5
{
˛˛6 7
MedicalHistoryId
˛˛8 H
=
˛˛I J
patient
˛˛K R
.
˛˛R S
UserId
˛˛S Y
}
˛˛Z [
;
˛˛[ \
int
ˇˇ 
UserClaimId
ˇˇ 
=
ˇˇ 
db
ˇˇ  
.
ˇˇ  !

UserClaims
ˇˇ! +
.
ˇˇ+ ,
FirstOrDefault
ˇˇ, :
(
ˇˇ: ;
x
ˇˇ; <
=>
ˇˇ= ?
x
ˇˇ@ A
.
ˇˇA B

ClaimValue
ˇˇB L
==
ˇˇM O
$str
ˇˇP Y
)
ˇˇY Z
.
ˇˇZ [
Id
ˇˇ[ ]
;
ˇˇ] ^
patient
ÄÄ 
.
ÄÄ 
UserClaimId
ÄÄ 
=
ÄÄ  !
UserClaimId
ÄÄ" -
;
ÄÄ- .
patient
ÇÇ 
.
ÇÇ 
URLImage
ÇÇ 
=
ÇÇ 
	Constants
ÇÇ (
.
ÇÇ( )!
DefaultPatientImage
ÇÇ) <
;
ÇÇ< =
try
ÉÉ 
{
ÑÑ 
db
ÖÖ 
.
ÖÖ 
Patients
ÖÖ 
.
ÖÖ 
Add
ÖÖ 
(
ÖÖ  
patient
ÖÖ  '
)
ÖÖ' (
;
ÖÖ( )
db
ÜÜ 
.
ÜÜ 
MedicalHistorys
ÜÜ "
.
ÜÜ" #
Add
ÜÜ# &
(
ÜÜ& '
medicalHistory
ÜÜ' 5
)
ÜÜ5 6
;
ÜÜ6 7
db
áá 
.
áá 
SaveChanges
áá 
(
áá 
)
áá  
;
áá  !
return
àà 
CreatedAtRoute
àà %
(
àà% &
$str
àà& 6
,
àà6 7
new
àà8 ;
{
àà< =
id
àà> @
=
ààA B
patient
ààC J
.
ààJ K
UserId
ààK Q
}
ààR S
,
ààS T
patient
ààU \
)
àà\ ]
;
àà] ^
}
ââ 
catch
ää 
(
ää 
	Exception
ää 
ex
ää 
)
ää  
{
ãã 
return
åå !
InternalServerError
åå *
(
åå* +
ex
åå+ -
)
åå- .
;
åå. /
}
çç 
return
éé 

StatusCode
éé 
(
éé 
HttpStatusCode
éé ,
.
éé, -
	NoContent
éé- 6
)
éé6 7
;
éé7 8
}
èè 	
[
íí 	

HttpDelete
íí	 
]
íí 
[
ìì 	
Route
ìì	 
(
ìì 
$str
ìì 
,
ìì 
Name
ìì 
=
ìì  !
$str
ìì" 1
)
ìì1 2
]
ìì2 3
[
îî 	
ResponseType
îî	 
(
îî 
typeof
îî 
(
îî 
Patient
îî $
)
îî$ %
)
îî% &
]
îî& '
public
ïï 
IHttpActionResult
ïï  
DeletePatient
ïï! .
(
ïï. /
int
ïï/ 2
id
ïï3 5
,
ïï5 6
object
ïï7 =
data
ïï> B
)
ïïB C
{
ññ 	
User
óó 
patient
óó 
=
óó 
db
óó 
.
óó 
Users
óó #
.
óó# $
Find
óó$ (
(
óó( )
id
óó) +
)
óó+ ,
;
óó, -
if
òò 
(
òò 
patient
òò 
==
òò 
null
òò 
)
òò  
{
ôô 
return
öö 
NotFound
öö 
(
öö  
)
öö  !
;
öö! "
}
õõ 
db
ùù 
.
ùù 
Patients
ùù 
.
ùù 
Remove
ùù 
(
ùù 
(
ùù  
Patient
ùù  '
)
ùù' (
patient
ùù( /
)
ùù/ 0
;
ùù0 1
db
ûû 
.
ûû 
SaveChanges
ûû 
(
ûû 
)
ûû 
;
ûû 
return
†† 
Ok
†† 
(
†† 
)
†† 
;
†† 
}
°° 	
[
§§ 	
Route
§§	 
(
§§ 
$str
§§ 0
,
§§0 1
Name
§§2 6
=
§§7 8
$str
§§9 E
)
§§E F
]
§§F G
public
•• 
IHttpActionResult
••  "
GetPatientForConfirm
••! 5
(
••5 6
int
••6 9
id
••: <
)
••< =
{
¶¶ 	
var
©© 
patient
©© 
=
©© 
db
©© 
.
©© 
Users
©© "
.
©©" #
FirstOrDefault
©©# 1
(
©©1 2
x
©©2 3
=>
©©4 6
x
©©7 8
.
©©8 9
UserId
©©9 ?
==
©©@ B
id
©©C E
)
©©E F
;
©©F G
if
´´ 
(
´´ 
patient
´´ 
==
´´ 
null
´´ 
)
´´  
{
¨¨ 
return
≠≠ 
NotFound
≠≠ 
(
≠≠  
)
≠≠  !
;
≠≠! "
}
ÆÆ 
var
≤≤ 
a
≤≤ 
=
≤≤ 
new
≤≤ 
{
≥≥ 
patient
¥¥ 
.
¥¥ 
UserId
¥¥ 
,
¥¥ 
patient
µµ 
.
µµ 
Email
µµ 
,
µµ 
patient
∂∂ 
.
∂∂ 
Active
∂∂ 
}
∑∑ 
;
∑∑ 
return
ππ 
Ok
ππ 
(
ππ 
a
ππ 
)
ππ 
;
ππ 
}
∫∫ 	
	protected
ΩΩ 
override
ΩΩ 
void
ΩΩ 
Dispose
ΩΩ  '
(
ΩΩ' (
bool
ΩΩ( ,
	disposing
ΩΩ- 6
)
ΩΩ6 7
{
ææ 	
if
øø 
(
øø 
	disposing
øø 
)
øø 
{
¿¿ 
db
¡¡ 
.
¡¡ 
Dispose
¡¡ 
(
¡¡ 
)
¡¡ 
;
¡¡ 
}
¬¬ 
base
√√ 
.
√√ 
Dispose
√√ 
(
√√ 
	disposing
√√ "
)
√√" #
;
√√# $
}
ƒƒ 	
private
∆∆ 
bool
∆∆ 
PatientExists
∆∆ "
(
∆∆" #
int
∆∆# &
id
∆∆' )
)
∆∆) *
{
«« 	
return
»» 
db
»» 
.
»» 
Users
»» 
.
»» 
Count
»» !
(
»»! "
e
»»" #
=>
»»$ &
e
»»' (
.
»»( )
UserId
»») /
==
»»0 2
id
»»3 5
)
»»5 6
>
»»7 8
$num
»»9 :
;
»»: ;
}
…… 	
}
   
}ÀÀ è|
AH:\AlphaMedic\AlphaMedic\Rest\Controllers\ProceduresController.cs
	namespace 	
Rest
 
. 
Controllers 
{ 
[ 
RoutePrefix 
( 
$str !
)! "
]" #
public 

class  
ProceduresController %
:& '
ApiController( 5
{ 
private 
AlphaMedicContext !
db" $
=% &
new' *
AlphaMedicContext+ <
(< =
)= >
;> ?
public 

IQueryable 
< 
	Procedure #
># $
GetProcedures% 2
(2 3
)3 4
{ 	
return 
db 
. 

Procedures  
;  !
} 	
[ 	
Route	 
( 
$str 
) 
] 
[ 	
	Authorize	 
( 
Roles 
= 
Roles  
.  !
Patient! (
+) *
$str+ .
+/ 0
Roles1 6
.6 7

AllDoctors7 A
+B C
$strD G
+H I
RolesJ O
.O P
ReceptionistP \
)\ ]
]] ^
public 
IHttpActionResult  
GetProcedure! -
(- .
int. 1
id2 4
)4 5
{   	
var!! 
proc!! 
=!! 
db!! 
.!! 

Procedures!! $
.!!$ %
Find!!% )
(!!) *
id!!* ,
)!!, -
;!!- .
var## 
currentUser## 
=## 
db##  
.##  !
Users##! &
.##& '
FirstOrDefault##' 5
(##5 6
x##6 7
=>##8 :
x##; <
.##< =
Email##= B
==##C E
this##F J
.##J K
User##K O
.##O P
Identity##P X
.##X Y
Name##Y ]
)##] ^
;##^ _
if%% 
(%% 
currentUser%% 
==%% 
null%% #
)%%# $
{&& 
return'' 
Content'' 
('' 
HttpStatusCode'' -
.''- .
NotFound''. 6
,''6 7
Messages''8 @
.''@ A
UserNotFound''A M
)''M N
;''N O
}(( 
if** 
(** 
this** 
.** 
User** 
.** 
IsInRole** "
(**" #
Roles**# (
.**( )
Patient**) 0
)**0 1
&&**2 4
proc**5 9
.**9 :
MedicalHistory**: H
.**H I
Patient**I P
.**P Q
UserId**Q W
!=**X Z
currentUser**[ f
.**f g
UserId**g m
)**m n
{++ 
return,, 
Content,, 
(,, 
HttpStatusCode,, -
.,,- .
	Forbidden,,. 7
,,,7 8
Messages,,9 A
.,,A B
AccsesDenied,,B N
),,N O
;,,O P
}-- 
if// 
(// 
Tools// 
.// 
AnyRole// 
(// 
this// "
.//" #
User//# '
,//' (
Roles//) .
.//. /
DoctorRoles/// :
)//: ;
&&//< >
proc//? C
.//C D
Appointment//D O
.//O P
Doctor//P V
.//V W
UserId//W ]
!=//^ `
currentUser//a l
.//l m
UserId//m s
)//s t
{00 
return11 
Content11 
(11 
HttpStatusCode11 -
.11- .
	Forbidden11. 7
,117 8
Messages119 A
.11A B
AccsesDenied11B N
)11N O
;11O P
}22 
switch44 
(44 
proc44 
.44 
GetType44  
(44  !
)44! "
.44" #
BaseType44# +
.44+ ,
Name44, 0
)440 1
{55 
case66 
$str66 "
:66" #
{77 
return88 
Ok88 !
(88! "
new99 
ExaminationDto99  .
{:: 
ProcedureId;;  +
=;;, -
(;;. /
int;;/ 2
);;2 3
proc;;3 7
.;;7 8
ProcedureId;;8 C
,;;C D
Name<<  $
=<<% &
proc<<' +
.<<+ ,
Name<<, 0
,<<0 1
Description==  +
===, -
proc==. 2
.==2 3
Description==3 >
,==> ?
Date>>  $
=>>% &
proc>>' +
.>>+ ,
Date>>, 0
,>>0 1
Price??  %
=??& '
proc??( ,
.??, -
Price??- 2
????3 5
default??6 =
(??= >
decimal??> E
)??E F
,??F G
	Diagnosis@@  )
=@@* +
(@@, -
(@@- .
Examination@@. 9
)@@9 :
proc@@: >
)@@> ?
.@@? @
	Diagnosis@@@ I
,@@I J
DoctorAA  &
=AA' (
procAA) -
.AA- .
AppointmentAA. 9
.AA9 :
DoctorAA: @
!=AAA C
nullAAD H
?AAI J
newAAK N
ShortUserDtoAAO [
{BB  !
NameCC$ (
=CC) *
procCC+ /
.CC/ 0
AppointmentCC0 ;
.CC; <
DoctorCC< B
.CCB C
NameCCC G
,CCG H
SurnameDD$ +
=DD, -
procDD. 2
.DD2 3
AppointmentDD3 >
.DD> ?
DoctorDD? E
.DDE F
SurnameDDF M
,DDM N
UserIdEE$ *
=EE+ ,
procEE- 1
.EE1 2
AppointmentEE2 =
.EE= >
DoctorEE> D
.EED E
UserIdEEE K
}FF  !
:FF" #
nullFF$ (
}GG 
)HH 
;HH 
}II 
caseJJ 
$strJJ "
:JJ" #
{KK 
returnLL 
OkLL !
(LL! "
newMM 
VaccinationDtoMM  .
{NN 
ProcedureIdOO  +
=OO, -
(OO. /
intOO/ 2
)OO2 3
procOO3 7
.OO7 8
ProcedureIdOO8 C
,OOC D
NamePP  $
=PP% &
procPP' +
.PP+ ,
NamePP, 0
,PP0 1
DescriptionQQ  +
=QQ, -
procQQ. 2
.QQ2 3
DescriptionQQ3 >
,QQ> ?
DateRR  $
=RR% &
procRR' +
.RR+ ,
DateRR, 0
,RR0 1
PriceSS  %
=SS& '
procSS( ,
.SS, -
PriceSS- 2
??SS3 5
defaultSS6 =
(SS= >
decimalSS> E
)SSE F
,SSF G
DoctorTT  &
=TT' (
procTT) -
.TT- .
AppointmentTT. 9
.TT9 :
DoctorTT: @
!=TTA C
nullTTD H
?TTI J
newTTK N
ShortUserDtoTTO [
{UU  !
NameVV$ (
=VV) *
procVV+ /
.VV/ 0
AppointmentVV0 ;
.VV; <
DoctorVV< B
.VVB C
NameVVC G
,VVG H
SurnameWW$ +
=WW, -
procWW. 2
.WW2 3
AppointmentWW3 >
.WW> ?
DoctorWW? E
.WWE F
SurnameWWF M
,WWM N
UserIdXX$ *
=XX+ ,
procXX- 1
.XX1 2
AppointmentXX2 =
.XX= >
DoctorXX> D
.XXD E
UserIdXXE K
}YY  !
:YY" #
nullYY$ (
}ZZ 
)[[ 
;[[ 
}\\ 
case]] 
$str]]  
:]]  !
{^^ 
return__ 
Ok__ !
(__! "
new`` 
TreatmentDto``  ,
{aa 
ProcedureIdbb  +
=bb, -
(bb. /
intbb/ 2
)bb2 3
procbb3 7
.bb7 8
ProcedureIdbb8 C
,bbC D
Namecc  $
=cc% &
proccc' +
.cc+ ,
Namecc, 0
,cc0 1
Descriptiondd  +
=dd, -
procdd. 2
.dd2 3
Descriptiondd3 >
,dd> ?
Dateee  $
=ee% &
procee' +
.ee+ ,
Dateee, 0
,ee0 1
Priceff  %
=ff& '
procff( ,
.ff, -
Priceff- 2
??ff3 5
defaultff6 =
(ff= >
decimalff> E
)ffE F
,ffF G
Doctorgg  &
=gg' (
procgg) -
.gg- .
Appointmentgg. 9
.gg9 :
Doctorgg: @
!=ggA C
nullggD H
?ggI J
newggK N
ShortUserDtoggO [
{hh  !
Nameii$ (
=ii) *
procii+ /
.ii/ 0
Appointmentii0 ;
.ii; <
Doctorii< B
.iiB C
NameiiC G
,iiG H
Surnamejj$ +
=jj, -
procjj. 2
.jj2 3
Appointmentjj3 >
.jj> ?
Doctorjj? E
.jjE F
SurnamejjF M
,jjM N
UserIdkk$ *
=kk+ ,
prockk- 1
.kk1 2
Appointmentkk2 =
.kk= >
Doctorkk> D
.kkD E
UserIdkkE K
}ll  !
:ll" #
nullll$ (
,ll( )
Resultmm  &
=mm' (
(mm) *
(mm* +
	Treatmentmm+ 4
)mm4 5
procmm5 9
)mm9 :
.mm: ;
Resultmm; A
,mmA B
Medicationsnn  +
=nn, -
(nn. /
(nn/ 0
	Treatmentnn0 9
)nn9 :
procnn: >
)nn> ?
.nn? @
Medicationsnn@ K
.nnK L
SelectnnL R
(nnR S
xoo$ %
=>oo& (
newoo) ,
MedicationDtooo- :
{pp$ %
MedicationIdqq( 4
=qq5 6
xqq7 8
.qq8 9
MedicationIdqq9 E
,qqE F
Descriptionrr( 3
=rr4 5
xrr6 7
.rr7 8
Descriptionrr8 C
,rrC D
Pricess( -
=ss. /
xss0 1
.ss1 2
Pricess2 7
}tt$ %
)uu$ %
}vv 
)ww 
;ww 
}xx 
}yy 
returnzz 

BadRequestzz 
(zz 
)zz 
;zz  
}{{ 	
[~~ 	
ResponseType~~	 
(~~ 
typeof~~ 
(~~ 
void~~ !
)~~! "
)~~" #
]~~# $
[ 	
	Authorize	 
( 
Roles 
= 
Roles  
.  !
Receptionist! -
)- .
]. /
public
ÄÄ 
IHttpActionResult
ÄÄ  
PutProcedure
ÄÄ! -
(
ÄÄ- .
int
ÄÄ. 1
id
ÄÄ2 4
,
ÄÄ4 5
	Procedure
ÄÄ6 ?
	procedure
ÄÄ@ I
)
ÄÄI J
{
ÅÅ 	
if
ÇÇ 
(
ÇÇ 
!
ÇÇ 

ModelState
ÇÇ 
.
ÇÇ 
IsValid
ÇÇ #
)
ÇÇ# $
{
ÉÉ 
return
ÑÑ 

BadRequest
ÑÑ !
(
ÑÑ! "

ModelState
ÑÑ" ,
)
ÑÑ, -
;
ÑÑ- .
}
ÖÖ 
if
áá 
(
áá 
id
áá 
!=
áá 
	procedure
áá 
.
áá  
ProcedureId
áá  +
)
áá+ ,
{
àà 
return
ââ 

BadRequest
ââ !
(
ââ! "
)
ââ" #
;
ââ# $
}
ää 
db
åå 
.
åå 
Entry
åå 
(
åå 
	procedure
åå 
)
åå 
.
åå  
State
åå  %
=
åå& '
EntityState
åå( 3
.
åå3 4
Modified
åå4 <
;
åå< =
try
éé 
{
èè 
db
êê 
.
êê 
SaveChanges
êê 
(
êê 
)
êê  
;
êê  !
}
ëë 
catch
íí 
(
íí *
DbUpdateConcurrencyException
íí /
)
íí/ 0
{
ìì 
if
îî 
(
îî 
!
îî 
ProcedureExists
îî $
(
îî$ %
id
îî% '
)
îî' (
)
îî( )
{
ïï 
return
ññ 
NotFound
ññ #
(
ññ# $
)
ññ$ %
;
ññ% &
}
óó 
else
òò 
{
ôô 
throw
öö 
;
öö 
}
õõ 
}
úú 
return
ûû 

StatusCode
ûû 
(
ûû 
HttpStatusCode
ûû ,
.
ûû, -
	NoContent
ûû- 6
)
ûû6 7
;
ûû7 8
}
üü 	
[
¢¢ 	
ResponseType
¢¢	 
(
¢¢ 
typeof
¢¢ 
(
¢¢ 
	Procedure
¢¢ &
)
¢¢& '
)
¢¢' (
]
¢¢( )
[
££ 	
	Authorize
££	 
(
££ 
Roles
££ 
=
££ 
Roles
££  
.
££  !
Receptionist
££! -
)
££- .
]
££. /
public
§§ 
IHttpActionResult
§§  
PostProcedure
§§! .
(
§§. /
	Procedure
§§/ 8
	procedure
§§9 B
)
§§B C
{
•• 	
if
¶¶ 
(
¶¶ 
!
¶¶ 

ModelState
¶¶ 
.
¶¶ 
IsValid
¶¶ #
)
¶¶# $
{
ßß 
return
®® 

BadRequest
®® !
(
®®! "

ModelState
®®" ,
)
®®, -
;
®®- .
}
©© 
db
´´ 
.
´´ 

Procedures
´´ 
.
´´ 
Add
´´ 
(
´´ 
	procedure
´´ '
)
´´' (
;
´´( )
try
≠≠ 
{
ÆÆ 
db
ØØ 
.
ØØ 
SaveChanges
ØØ 
(
ØØ 
)
ØØ  
;
ØØ  !
}
∞∞ 
catch
±± 
(
±± 
DbUpdateException
±± $
)
±±$ %
{
≤≤ 
if
≥≥ 
(
≥≥ 
ProcedureExists
≥≥ #
(
≥≥# $
(
≥≥$ %
int
≥≥% (
)
≥≥( )
	procedure
≥≥) 2
.
≥≥2 3
ProcedureId
≥≥3 >
)
≥≥> ?
)
≥≥? @
{
¥¥ 
return
µµ 
Conflict
µµ #
(
µµ# $
)
µµ$ %
;
µµ% &
}
∂∂ 
else
∑∑ 
{
∏∏ 
throw
ππ 
;
ππ 
}
∫∫ 
}
ªª 
return
ΩΩ 
CreatedAtRoute
ΩΩ !
(
ΩΩ! "
$str
ΩΩ" .
,
ΩΩ. /
new
ΩΩ0 3
{
ΩΩ4 5
id
ΩΩ6 8
=
ΩΩ9 :
	procedure
ΩΩ; D
.
ΩΩD E
ProcedureId
ΩΩE P
}
ΩΩQ R
,
ΩΩR S
	procedure
ΩΩT ]
)
ΩΩ] ^
;
ΩΩ^ _
}
ææ 	
	protected
–– 
override
–– 
void
–– 
Dispose
––  '
(
––' (
bool
––( ,
	disposing
––- 6
)
––6 7
{
—— 	
if
““ 
(
““ 
	disposing
““ 
)
““ 
{
”” 
db
‘‘ 
.
‘‘ 
Dispose
‘‘ 
(
‘‘ 
)
‘‘ 
;
‘‘ 
}
’’ 
base
÷÷ 
.
÷÷ 
Dispose
÷÷ 
(
÷÷ 
	disposing
÷÷ "
)
÷÷" #
;
÷÷# $
}
◊◊ 	
private
ŸŸ 
bool
ŸŸ 
ProcedureExists
ŸŸ $
(
ŸŸ$ %
int
ŸŸ% (
id
ŸŸ) +
)
ŸŸ+ ,
{
⁄⁄ 	
return
€€ 
db
€€ 
.
€€ 

Procedures
€€  
.
€€  !
Count
€€! &
(
€€& '
e
€€' (
=>
€€) +
e
€€, -
.
€€- .
ProcedureId
€€. 9
==
€€: <
id
€€= ?
)
€€? @
>
€€A B
$num
€€C D
;
€€D E
}
‹‹ 	
}
›› 
}ﬁﬁ Êg
AH:\AlphaMedic\AlphaMedic\Rest\Controllers\TreatmentsController.cs
	namespace 	
Rest
 
. 
Controllers 
{ 
[ 
RoutePrefix 
( 
$str !
)! "
]" #
public 

class  
TreatmentsController %
:& '
ApiController( 5
{ 
private 
AlphaMedicContext !
db" $
=% &
new' *
AlphaMedicContext+ <
(< =
)= >
;> ?
[ 	
Route	 
( 
$str 
) 
] 
public 

IQueryable 
< 
	Treatment #
># $
GetProcedures% 2
(2 3
)3 4
{ 	
return 
db 
. 

Treatments  
;  !
} 	
[ 	
ResponseType	 
( 
typeof 
( 
TreatmentDto )
)) *
)* +
]+ ,
[   	
Route  	 
(   
$str   
)   
]   
[!! 	
	Authorize!!	 
(!! 
Roles!! 
=!! 
Roles!!  
.!!  !
Receptionist!!! -
+!!- .
$str!!. 1
+!!1 2
Roles!!2 7
.!!7 8

AllDoctors!!8 B
+!!B C
$str!!C F
+!!F G
Roles!!G L
.!!L M
Patient!!M T
)!!T U
]!!U V
public"" 
IHttpActionResult""  
GetTreatment""! -
(""- .
int"". 1
id""2 4
)""4 5
{## 	
	Treatment$$ 
	treatment$$ 
=$$  !
db$$" $
.$$$ %

Treatments$$% /
.$$/ 0
Include$$0 7
($$7 8
x$$8 9
=>$$9 ;
x$$; <
.$$< =
Medications$$= H
)$$H I
.$$I J
Where$$J O
($$O P
c$$P Q
=>$$Q S
c$$S T
.$$T U
ProcedureId$$U `
==$$` b
id$$b d
)$$d e
.$$e f
FirstOrDefault$$f t
($$t u
)$$u v
;$$v w
if%% 
(%% 
	treatment%% 
==%% 
null%% !
)%%! "
{&& 
return'' 
NotFound'' 
(''  
)''  !
;''! "
}(( 
return** 
Ok** 
(** 
new** 
TreatmentDto** &
{++ 
ProcedureId,, 
=,, 
(,, 
int,, "
),," #
	treatment,,# ,
.,,, -
ProcedureId,,- 8
,,,8 9
Name-- 
=-- 
	treatment--  
.--  !
Name--! %
,--% &
Description.. 
=.. 
	treatment.. '
...' (
Description..( 3
,..3 4
Date// 
=// 
	treatment//  
.//  !
Date//! %
,//% &
Price00 
=00 
(00 
decimal00  
)00  !
	treatment00! *
.00* +
Price00+ 0
,000 1
Doctor11 
=11 
new11 
ShortUserDto11 )
{22 
UserId33 
=33 
	treatment33 &
.33& '
Appointment33' 2
.332 3
Doctor333 9
.339 :
UserId33: @
,33@ A
Name44 
=44 
	treatment44 $
.44$ %
Appointment44% 0
.440 1
Doctor441 7
.447 8
Name448 <
,44< =
Surname55 
=55 
	treatment55 '
.55' (
Appointment55( 3
.553 4
Doctor554 :
.55: ;
Surname55; B
}66 
,66 
Result77 
=77 
	treatment77 "
.77" #
Result77# )
,77) *
Medications88 
=88 
	treatment88 '
.88' (
Medications88( 3
.883 4
Select884 :
(88: ;
x99$ %
=>99& (
new99) ,
MedicationDto99- :
{::$ %
MedicationId;;( 4
=;;5 6
x;;7 8
.;;8 9
MedicationId;;9 E
,;;E F
Description<<( 3
=<<4 5
x<<6 7
.<<7 8
Description<<8 C
,<<C D
Price==( -
===. /
x==0 1
.==1 2
Price==2 7
}>>$ %
)??$ %
}@@ 
)AA 
;AA 
}BB 	
[EE 	
ResponseTypeEE	 
(EE 
typeofEE 
(EE 
voidEE !
)EE! "
)EE" #
]EE# $
[FF 	
RouteFF	 
(FF 
$strFF 
)FF 
]FF 
[GG 	
	AuthorizeGG	 
(GG 
RolesGG 
=GG 
RolesGG  
.GG  !
ReceptionistGG! -
+GG- .
$strGG. 1
+GG1 2
RolesGG2 7
.GG7 8

AllDoctorsGG8 B
)GGB C
]GGC D
publicHH 
IHttpActionResultHH  
PutTreatmentHH! -
(HH- .
intHH. 1
idHH2 4
,HH4 5
	TreatmentHH6 ?
	treatmentHH@ I
)HHI J
{II 	
ifJJ 
(JJ 
!JJ 

ModelStateJJ 
.JJ 
IsValidJJ #
)JJ# $
{KK 
returnLL 

BadRequestLL !
(LL! "

ModelStateLL" ,
)LL, -
;LL- .
}MM 
varOO 
treOO 
=OO 
dbOO 
.OO 

TreatmentsOO #
.OO# $
FindOO$ (
(OO( )
idOO) +
)OO+ ,
;OO, -
ifPP 
(PP 
trePP 
.PP 
ResultPP 
==PP 
nullPP "
&&PP# %
	treatmentPP& /
.PP/ 0
ResultPP0 6
!=PP7 9
nullPP: >
)PP> ?
{QQ 
treRR 
.RR 
ResultRR 
=RR 
	treatmentRR &
.RR& '
ResultRR' -
;RR- .
dbSS 
.SS 
EntrySS 
(SS 
treSS 
)SS 
.SS 
StateSS #
=SS$ %
EntityStateSS& 1
.SS1 2
ModifiedSS2 :
;SS: ;
}TT 
elseUU 
{VV 
treWW 
.WW 
MedicationsWW 
=WW  !
	treatmentWW" +
.WW+ ,
MedicationsWW, 7
;WW7 8
varYY 
idsYY 
=YY 
(YY 
fromYY 
nYY  !
inYY" $
treYY% (
.YY( )
MedicationsYY) 4
selectZZ !
nZZ" #
.ZZ# $
MedicationIdZZ$ 0
)ZZ0 1
.ZZ1 2
ToArrayZZ2 9
<ZZ9 :
intZZ: =
>ZZ= >
(ZZ> ?
)ZZ? @
;ZZ@ A
List[[ 
<[[ 

Medication[[ 
>[[  
meds[[! %
=[[& '
([[( )
from[[) -
m[[. /
in[[0 2
db[[3 5
.[[5 6
Medications[[6 A
.[[A B
Include[[B I
([[I J
x[[J K
=>[[L N
x[[O P
.[[P Q

Treatments[[Q [
)[[[ \
from\\) -
id1\\. 1
in\\2 4
ids\\5 8
where]]) .
m]]/ 0
.]]0 1
MedicationId]]1 =
==]]> @
id1]]A D
select^^) /
m^^0 1
)__ 
.__ 
ToList__ #
(__# $
)__$ %
;__% &
tre`` 
.`` 
Medications`` 
=``  !
meds``" &
;``& '
foreachaa 
(aa 

Medicationaa #
medaa$ '
inaa( *
medsaa+ /
)aa/ 0
medbb 
.bb 

Treatmentsbb "
.bb" #
Addbb# &
(bb& '
trebb' *
)bb* +
;bb+ ,
dbcc 
.cc 
Entrycc 
(cc 
trecc 
)cc 
.cc 
Statecc #
=cc$ %
EntityStatecc& 1
.cc1 2
Modifiedcc2 :
;cc: ;
foreachdd 
(dd 

Medicationdd #
meddd$ '
indd( *
medsdd+ /
)dd/ 0
dbee 
.ee 
Entryee 
(ee 
medee  
)ee  !
.ee! "
Stateee" '
=ee( )
EntityStateee* 5
.ee5 6
Modifiedee6 >
;ee> ?
}ff 
trygg 
{hh 
dbii 
.ii 
SaveChangesii 
(ii 
)ii  
;ii  !
}jj 
catchkk 
(kk (
DbUpdateConcurrencyExceptionkk /
)kk/ 0
{ll 
ifmm 
(mm 
!mm 
TreatmentExistsmm $
(mm$ %
idmm% '
)mm' (
)mm( )
{nn 
returnoo 
NotFoundoo #
(oo# $
)oo$ %
;oo% &
}pp 
elseqq 
{rr 
throwss 
;ss 
}tt 
}uu 
returnww 

StatusCodeww 
(ww 
HttpStatusCodeww ,
.ww, -
	NoContentww- 6
)ww6 7
;ww7 8
}xx 	
[{{ 	
ResponseType{{	 
({{ 
typeof{{ 
({{ 
	Treatment{{ &
){{& '
){{' (
]{{( )
[|| 	
Route||	 
(|| 
$str|| 
)|| 
]|| 
[}} 	
	Authorize}}	 
(}} 
Roles}} 
=}} 
Roles}} 
.}} 
Receptionist}} +
+}}+ ,
$str}}, /
+}}/ 0
Roles}}0 5
.}}5 6

AllDoctors}}6 @
)}}@ A
]}}A B
public~~ 
IHttpActionResult~~  
PostTreatment~~! .
(~~. /
	Treatment~~/ 8
	treatment~~9 B
)~~B C
{ 	
if
ÄÄ 
(
ÄÄ 
!
ÄÄ 

ModelState
ÄÄ 
.
ÄÄ 
IsValid
ÄÄ #
)
ÄÄ# $
{
ÅÅ 
return
ÇÇ 

BadRequest
ÇÇ !
(
ÇÇ! "

ModelState
ÇÇ" ,
)
ÇÇ, -
;
ÇÇ- .
}
ÉÉ 
if
ÜÜ 
(
ÜÜ 
db
ÜÜ 
.
ÜÜ 

Procedures
ÜÜ 
.
ÜÜ 
FirstOrDefault
ÜÜ ,
(
ÜÜ, -
x
ÜÜ- .
=>
ÜÜ/ 1
x
ÜÜ2 3
.
ÜÜ3 4
ProcedureId
ÜÜ4 ?
==
ÜÜ@ B
	treatment
ÜÜC L
.
ÜÜL M
ProcedureId
ÜÜM X
)
ÜÜX Y
!=
ÜÜZ \
null
ÜÜ] a
)
ÜÜa b
return
áá 
Content
áá 
(
áá 
HttpStatusCode
áá -
.
áá- .
Conflict
áá. 6
,
áá6 7
$str
áá8 L
)
ááL M
;
ááM N
db
ââ 
.
ââ 

Procedures
ââ 
.
ââ 
Add
ââ 
(
ââ 
	treatment
ââ '
)
ââ' (
;
ââ( )
try
ãã 
{
åå 
db
çç 
.
çç 
SaveChanges
çç 
(
çç 
)
çç  
;
çç  !
}
èè 
catch
êê 
(
êê 
DbUpdateException
êê $
)
êê$ %
{
ëë 
if
íí 
(
íí 
TreatmentExists
íí #
(
íí# $
(
íí$ %
int
íí% (
)
íí( )
	treatment
íí) 2
.
íí2 3
ProcedureId
íí3 >
)
íí> ?
)
íí? @
{
ìì 
return
îî 
Conflict
îî #
(
îî# $
)
îî$ %
;
îî% &
}
ïï 
else
ññ 
{
óó 
throw
òò 
;
òò 
}
ôô 
}
öö 
return
úú 
Ok
úú 
(
úú 
	treatment
úú 
)
úú  
;
úú  !
}
ùù 	
	protected
±± 
override
±± 
void
±± 
Dispose
±±  '
(
±±' (
bool
±±( ,
	disposing
±±- 6
)
±±6 7
{
≤≤ 	
if
≥≥ 
(
≥≥ 
	disposing
≥≥ 
)
≥≥ 
{
¥¥ 
db
µµ 
.
µµ 
Dispose
µµ 
(
µµ 
)
µµ 
;
µµ 
}
∂∂ 
base
∑∑ 
.
∑∑ 
Dispose
∑∑ 
(
∑∑ 
	disposing
∑∑ "
)
∑∑" #
;
∑∑# $
}
∏∏ 	
private
∫∫ 
bool
∫∫ 
TreatmentExists
∫∫ $
(
∫∫$ %
int
∫∫% (
id
∫∫) +
)
∫∫+ ,
{
ªª 	
return
ºº 
db
ºº 
.
ºº 

Procedures
ºº  
.
ºº  !
Count
ºº! &
(
ºº& '
e
ºº' (
=>
ºº) +
e
ºº, -
.
ºº- .
ProcedureId
ºº. 9
==
ºº: <
id
ºº= ?
)
ºº? @
>
ººA B
$num
ººC D
;
ººD E
}
ΩΩ 	
}
ææ 
}øø ∏†
<H:\AlphaMedic\AlphaMedic\Rest\Controllers\UsersController.cs
	namespace 	
Rest
 
. 
Controllers 
{ 
[ 
RoutePrefix 
( 
$str 
) 
] 
public 

class 
UsersController  
:! "
ApiController# 0
{ 
private 
AlphaMedicContext !
db" $
=% &
new' *
AlphaMedicContext+ <
(< =
)= >
;> ?
public 

IQueryable 
< 
User 
> 
GetUsers  (
(( )
)) *
{ 	
return 
db 
. 
Users 
; 
} 	
[ 	
	Authorize	 
] 
[   	
Route  	 
(   
$str   
)   
]   
[!! 	
ResponseType!!	 
(!! 
typeof!! 
(!! 
User!! !
)!!! "
)!!" #
]!!# $
public"" 
IHttpActionResult""  
GetUser""! (
(""( )
int"") ,
id""- /
)""/ 0
{## 	
User$$ 
user$$ 
=$$ 
db$$ 
.$$ 
Users$$  
.$$  !
Find$$! %
($$% &
id$$& (
)$$( )
;$$) *
if%% 
(%% 
user%% 
==%% 
null%% 
)%% 
{&& 
return'' 
NotFound'' 
(''  
)''  !
;''! "
}(( 
var)) 
res)) 
=)) 
new)) 
UserDto)) !
{** 
UserId++ 
=++ 
user++ 
.++ 
UserId++ $
,++$ %
Name,, 
=,, 
user,, 
.,, 
Name,,  
,,,  !
Surname-- 
=-- 
user-- 
.-- 
Surname-- &
,--& '
DateOfBirth.. 
=.. 
user.. "
..." #
DateOfBirth..# .
,... /
Gender// 
=// 
user// 
.// 
Gender// $
,//$ %
Phone00 
=00 
user00 
.00 
Phone00 "
,00" #
Address11 
=11 
user11 
.11 
Address11 &
,11& '
URLImage22 
=22 
	Constants22 $
.22$ %

ThisServer22% /
+220 1
user222 6
.226 7
URLImage227 ?
}33 
;33 
return44 
Ok44 
(44 
res44 
)44 
;44 
}55 	
[66 	
	Authorize66	 
]66 
[77 	
Route77	 
(77 
$str77 
)77 
]77 
public88 
IHttpActionResult88  
PatchActiveState88! 1
(881 2
int882 5
id886 8
,888 9
JsonPatchDocument88: K
<88K L
User88L P
>88P Q
	patchData88R [
)88[ \
{99 	
var:: 
currentUser:: 
=:: 
db::  
.::  !
Users::! &
.::& '
FirstOrDefault::' 5
(::5 6
x::6 7
=>::8 :
x::; <
.::< =
Email::= B
==::C E
this::F J
.::J K
User::K O
.::O P
Identity::P X
.::X Y
Name::Y ]
)::] ^
;::^ _
if<< 
(<< 
!<< 
this<< 
.<< 
User<< 
.<< 
IsInRole<< #
(<<# $
Roles<<$ )
.<<) *
Administrator<<* 7
)<<7 8
&&<<9 ;
currentUser<<= H
.<<H I
UserId<<I O
!=<<O Q
id<<Q S
)<<T U
{== 
return>> 
Content>> 
(>> 
HttpStatusCode>> -
.>>- .
	Forbidden>>. 7
,>>7 8
Messages>>9 A
.>>A B
AccsesDenied>>B N
)>>N O
;>>O P
}?? 
varAA 
objectToUpdateAA 
=AA  
dbAA! #
.AA# $
UsersAA$ )
.AA) *
FindAA* .
(AA. /
idAA/ 1
)AA1 2
;AA2 3
	patchDataBB 
.BB 
ApplyToBB 
(BB 
objectToUpdateBB ,
)BB, -
;BB- .
tryDD 
{EE 
dbFF 
.FF 
SaveChangesFF 
(FF 
)FF  
;FF  !
}GG 
catchHH 
(HH '
DbEntityValidationExceptionHH .
eHH/ 0
)HH0 1
{II 
stringJJ 
sJJ 
=JJ 
$strJJ 
;JJ 
foreachKK 
(KK 
varKK 
eveKK  
inKK! #
eKK$ %
.KK% &"
EntityValidationErrorsKK& <
)KK< =
{LL 
sMM 
+=MM 
StringMM 
.MM  
FormatMM  &
(MM& '
$strMM' u
,MMu v
eveNN 
.NN 
EntryNN "
.NN" #
EntityNN# )
.NN) *
GetTypeNN* 1
(NN1 2
)NN2 3
.NN3 4
NameNN4 8
,NN8 9
eveNN: =
.NN= >
EntryNN> C
.NNC D
StateNND I
)NNI J
;NNJ K
foreachOO 
(OO 
varOO  
veOO! #
inOO$ &
eveOO' *
.OO* +
ValidationErrorsOO+ ;
)OO; <
{PP 
sQQ 
+=QQ 
StringQQ #
.QQ# $
FormatQQ$ *
(QQ* +
$strQQ+ P
,QQP Q
veRR 
.RR 
PropertyNameRR +
,RR+ ,
veRR- /
.RR/ 0
ErrorMessageRR0 <
)RR< =
;RR= >
}SS 
}TT 
returnVV 

BadRequestVV !
(VV! "
sVV" #
)VV# $
;VV$ %
}WW 
returnXX 
OkXX 
(XX 
)XX 
;XX 
}ZZ 	
[`` 	
	Authorize``	 
]`` 
[aa 	
ResponseTypeaa	 
(aa 
typeofaa 
(aa 
voidaa !
)aa! "
)aa" #
]aa# $
[bb 	
HttpPutbb	 
]bb 
[cc 	
Routecc	 
(cc 
$strcc 
,cc 
Namecc 
=cc  !
$strcc" +
)cc+ ,
]cc, -
publicdd 
IHttpActionResultdd  
PutUserdd! (
(dd( )
intdd) ,
iddd- /
,dd/ 0
UserDtodd1 8
userdd9 =
)dd= >
{ee 	
varff 
currentUserff 
=ff 
dbff  
.ff  !
Usersff! &
.ff& '
FirstOrDefaultff' 5
(ff5 6
xff6 7
=>ff8 :
xff; <
.ff< =
Emailff= B
==ffC E
thisffF J
.ffJ K
UserffK O
.ffO P
IdentityffP X
.ffX Y
NameffY ]
)ff] ^
;ff^ _
ifhh 
(hh 
!hh 
thishh 
.hh 
Userhh 
.hh 
IsInRolehh #
(hh# $
Roleshh$ )
.hh) *
Administratorhh* 7
)hh7 8
&&hh9 ;
currentUserhh< G
.hhG H
UserIdhhH N
!=hhO Q
idhhR T
)hhT U
{ii 
returnjj 
Contentjj 
(jj 
HttpStatusCodejj -
.jj- .
	Forbiddenjj. 7
,jj7 8
Messagesjj9 A
.jjA B
AccsesDeniedjjB N
)jjN O
;jjO P
}kk 
varmm 
tmpmm 
=mm 
dbmm 
.mm 
Usersmm 
.mm 
Findmm #
(mm# $
idmm$ &
)mm& '
;mm' (
ifoo 
(oo 
tmpoo 
==oo 
nulloo 
)oo 
{pp 
returnqq 
NotFoundqq 
(qq  
)qq  !
;qq! "
}rr 
tmptt 
.tt 
Namett 
=tt 
usertt 
.tt 
Namett  
;tt  !
tmpuu 
.uu 
Surnameuu 
=uu 
useruu 
.uu 
Surnameuu &
;uu& '
tmpvv 
.vv 
Phonevv 
=vv 
uservv 
.vv 
Phonevv "
;vv" #
tmpww 
.ww 
DateOfBirthww 
=ww 
userww "
.ww" #
DateOfBirthww# .
;ww. /
tmpxx 
.xx 
Addressxx 
=xx 
userxx 
.xx 
Addressxx &
;xx& '
tmpyy 
.yy 
Genderyy 
=yy 
useryy 
.yy 
Genderyy $
;yy$ %
db|| 
.|| 
Entry|| 
(|| 
tmp|| 
)|| 
.|| 
State|| 
=||  !
EntityState||" -
.||- .
Modified||. 6
;||6 7
try~~ 
{ 
db
ÄÄ 
.
ÄÄ 
SaveChanges
ÄÄ 
(
ÄÄ 
)
ÄÄ  
;
ÄÄ  !
}
ÅÅ 
catch
ÇÇ 
(
ÇÇ *
DbUpdateConcurrencyException
ÇÇ /
)
ÇÇ/ 0
{
ÉÉ 
if
ÑÑ 
(
ÑÑ 
!
ÑÑ 

UserExists
ÑÑ 
(
ÑÑ  
id
ÑÑ  "
)
ÑÑ" #
)
ÑÑ# $
{
ÖÖ 
return
ÜÜ 
NotFound
ÜÜ #
(
ÜÜ# $
)
ÜÜ$ %
;
ÜÜ% &
}
áá 
else
àà 
{
ââ 
throw
ää 
;
ää 
}
ãã 
}
åå 
catch
çç 
(
çç )
DbEntityValidationException
çç -
ex
çç. 0
)
çç0 1
{
éé 
return
èè 

BadRequest
èè !
(
èè! "
Messages
èè" *
.
èè* +
BadDataInFields
èè+ :
)
èè: ;
;
èè; <
}
êê 
catch
ëë 
(
ëë 
	Exception
ëë 
ex
ëë 
)
ëë  
{
íí 
return
ìì 

BadRequest
ìì  
(
ìì  !
ex
ìì! #
.
ìì# $
Message
ìì$ +
)
ìì+ ,
;
ìì, -
}
îî 
return
ññ 

StatusCode
ññ 
(
ññ 
HttpStatusCode
ññ ,
.
ññ, -
	NoContent
ññ- 6
)
ññ6 7
;
ññ7 8
}
óó 	
[
öö 	
HttpPost
öö	 
]
öö 
[
õõ 	
Route
õõ	 
(
õõ 
$str
õõ 
)
õõ 
]
õõ 
[
úú 	
ResponseType
úú	 
(
úú 
typeof
úú 
(
úú 
void
úú !
)
úú! "
)
úú" #
]
úú# $
public
ùù 
IHttpActionResult
ùù  "
PostRecoveryPassword
ùù! 5
(
ùù5 6
[
ùù6 7
FromUri
ùù7 >
]
ùù> ?
string
ùù? E
email
ùùF K
)
ùùK L
{
ûû 	
var
†† 
user
†† 
=
†† 
db
†† 
.
†† 
Users
†† 
.
††  
FirstOrDefault
††  .
(
††. /
x
††/ 0
=>
††1 3
x
††4 5
.
††5 6
Email
††6 ;
==
††< >
email
††? D
)
††D E
;
††E F
if
°° 
(
°° 
user
°° 
==
°° 
null
°° 
)
°° 
{
¢¢ 
return
££ 
NotFound
££ 
(
££  
)
££  !
;
££! "
}
§§ 
var
¶¶ 
newpass
¶¶ 
=
¶¶ 
System
¶¶  
.
¶¶  !
Web
¶¶! $
.
¶¶$ %
Security
¶¶% -
.
¶¶- .

Membership
¶¶. 8
.
¶¶8 9
GeneratePassword
¶¶9 I
(
¶¶I J
$num
¶¶J K
,
¶¶K L
$num
¶¶M N
)
¶¶N O
;
¶¶O P

EmailInput
©© 

emailInput
©© !
=
©©" #
new
©©$ '

EmailInput
©©( 2
(
©©2 3
)
©©3 4
;
©©4 5

emailInput
´´ 
.
´´ 
UserName
´´ 
=
´´  !
user
´´" &
.
´´& '
Name
´´' +
+
´´, -
$str
´´. 1
+
´´2 3
user
´´4 8
.
´´8 9
Surname
´´9 @
;
´´@ A

emailInput
¨¨ 
.
¨¨ 
Email
¨¨ 
=
¨¨ 
user
¨¨ #
.
¨¨# $
Email
¨¨$ )
;
¨¨) *

emailInput
≠≠ 
.
≠≠ 
Subject
≠≠ 
=
≠≠  
$str
≠≠! 5
;
≠≠5 6

emailInput
ØØ 
.
ØØ 
Body
ØØ 
=
ØØ 
$str
∞∞ O
+
∞∞P Q
newpass
∞∞R Y
+
∞∞Z [
$str
±± A
+
±±B C
$str
≤≤ ,
;
≤≤- .
try
≥≥ 
{
¥¥ 
user
∂∂ 
.
∂∂ 
Password
∂∂ 
=
∂∂ 

HashHelper
∂∂  *
.
∂∂* +
sha256_hash
∂∂+ 6
(
∂∂6 7
newpass
∂∂7 >
)
∂∂> ?
;
∂∂? @
db
∑∑ 
.
∑∑ 
Entry
∑∑ 
(
∑∑ 
user
∑∑ 
)
∑∑ 
.
∑∑ 
State
∑∑ $
=
∑∑% &
EntityState
∑∑' 2
.
∑∑2 3
Modified
∑∑3 ;
;
∑∑; <
db
∏∏ 
.
∏∏ 
SaveChanges
∏∏ 
(
∏∏ 
)
∏∏  
;
∏∏  !
return
ππ 
Ok
ππ 
(
ππ 
)
ππ 
;
ππ 
}
∫∫ 
catch
ªª 
(
ªª 
	Exception
ªª 
)
ªª 
{
ºº 
return
ΩΩ 

BadRequest
ΩΩ !
(
ΩΩ! "
)
ΩΩ" #
;
ΩΩ# $
}
ææ 
return
¿¿ 

StatusCode
¿¿ 
(
¿¿ 
HttpStatusCode
¿¿ ,
.
¿¿, -
	NoContent
¿¿- 6
)
¿¿6 7
;
¿¿7 8
}
¬¬ 	
[
∆∆ 	
	Authorize
∆∆	 
]
∆∆ 
[
«« 	
ResponseType
««	 
(
«« 
typeof
«« 
(
«« 
void
«« !
)
««! "
)
««" #
]
««# $
[
»» 	
HttpPut
»»	 
]
»» 
[
…… 	
Route
……	 
(
…… 
$str
…… $
,
……$ %
Name
……& *
=
……+ ,
$str
……- 9
)
……9 :
]
……: ;
public
   
IHttpActionResult
    
PutUser
  ! (
(
  ( )
int
  ) ,
id
  - /
,
  / 0

ChangePass
  1 ;
user
  < @
)
  @ A
{
ÀÀ 	
var
ÃÃ 
currentUser
ÃÃ 
=
ÃÃ 
db
ÃÃ  
.
ÃÃ  !
Users
ÃÃ! &
.
ÃÃ& '
FirstOrDefault
ÃÃ' 5
(
ÃÃ5 6
x
ÃÃ6 7
=>
ÃÃ8 :
x
ÃÃ; <
.
ÃÃ< =
Email
ÃÃ= B
==
ÃÃB D
this
ÃÃD H
.
ÃÃH I
User
ÃÃI M
.
ÃÃM N
Identity
ÃÃN V
.
ÃÃV W
Name
ÃÃW [
)
ÃÃ[ \
;
ÃÃ\ ]
if
ŒŒ 
(
ŒŒ 
currentUser
ŒŒ 
.
ŒŒ 
UserId
ŒŒ !
!=
ŒŒ" $
id
ŒŒ% '
)
ŒŒ' (
{
œœ 
return
–– 
Content
–– 
(
–– 
HttpStatusCode
–– -
.
––- .
	Forbidden
––. 7
,
––7 8
Messages
––9 A
.
––A B
AccsesDenied
––B N
)
––N O
;
––O P
}
—— 
var
”” 
tmp
”” 
=
”” 
db
”” 
.
”” 
Users
”” 
.
”” 
Find
”” #
(
””# $
id
””$ &
)
””& '
;
””' (
if
’’ 
(
’’ 
tmp
’’ 
==
’’ 
null
’’ 
)
’’ 
{
÷÷ 
return
◊◊ 
NotFound
◊◊ 
(
◊◊  
)
◊◊  !
;
◊◊! "
}
ÿÿ 
if
⁄⁄ 
(
⁄⁄ 
user
⁄⁄ 
.
⁄⁄ 
OldPass
⁄⁄ 
!=
⁄⁄ 
tmp
⁄⁄  #
.
⁄⁄# $
Password
⁄⁄$ ,
)
⁄⁄, -
{
€€ 
return
‹‹ 

BadRequest
‹‹ !
(
‹‹! "
)
‹‹" #
;
‹‹# $
}
›› 
tmp
ﬂﬂ 
.
ﬂﬂ 
Password
ﬂﬂ 
=
ﬂﬂ 
user
ﬂﬂ 
.
ﬂﬂ  
NewPass
ﬂﬂ  '
;
ﬂﬂ' (
db
·· 
.
·· 
Entry
·· 
(
·· 
tmp
·· 
)
·· 
.
·· 
State
·· 
=
··  !
EntityState
··" -
.
··- .
Modified
··. 6
;
··6 7
try
„„ 
{
‰‰ 
db
ÂÂ 
.
ÂÂ 
SaveChanges
ÂÂ 
(
ÂÂ 
)
ÂÂ  
;
ÂÂ  !
return
ÊÊ 
Ok
ÊÊ 
(
ÊÊ 
)
ÊÊ 
;
ÊÊ 
}
ÁÁ 
catch
ËË 
(
ËË *
DbUpdateConcurrencyException
ËË /
)
ËË/ 0
{
ÈÈ 
if
ÍÍ 
(
ÍÍ 
!
ÍÍ 

UserExists
ÍÍ 
(
ÍÍ  
id
ÍÍ  "
)
ÍÍ" #
)
ÍÍ# $
{
ÎÎ 
return
ÏÏ 
NotFound
ÏÏ #
(
ÏÏ# $
)
ÏÏ$ %
;
ÏÏ% &
}
ÌÌ 
else
ÓÓ 
{
ÔÔ 
throw
 
;
 
}
ÒÒ 
}
ÚÚ 
return
ÙÙ 

StatusCode
ÙÙ 
(
ÙÙ 
HttpStatusCode
ÙÙ ,
.
ÙÙ, -
	NoContent
ÙÙ- 6
)
ÙÙ6 7
;
ÙÙ7 8
}
ıı 	
[
¯¯ 	
ResponseType
¯¯	 
(
¯¯ 
typeof
¯¯ 
(
¯¯ 
User
¯¯ !
)
¯¯! "
)
¯¯" #
]
¯¯# $
public
˘˘ 
IHttpActionResult
˘˘  
PostUser
˘˘! )
(
˘˘) *
User
˘˘* .
user
˘˘/ 3
)
˘˘3 4
{
˙˙ 	
if
˚˚ 
(
˚˚ 
!
˚˚ 

ModelState
˚˚ 
.
˚˚ 
IsValid
˚˚ #
)
˚˚# $
{
¸¸ 
return
˝˝ 

BadRequest
˝˝ !
(
˝˝! "

ModelState
˝˝" ,
)
˝˝, -
;
˝˝- .
}
˛˛ 
db
ÄÄ 
.
ÄÄ 
Users
ÄÄ 
.
ÄÄ 
Add
ÄÄ 
(
ÄÄ 
user
ÄÄ 
)
ÄÄ 
;
ÄÄ 
db
ÅÅ 
.
ÅÅ 
SaveChanges
ÅÅ 
(
ÅÅ 
)
ÅÅ 
;
ÅÅ 
return
ÉÉ 
CreatedAtRoute
ÉÉ !
(
ÉÉ! "
$str
ÉÉ" .
,
ÉÉ. /
new
ÉÉ0 3
{
ÉÉ4 5
id
ÉÉ6 8
=
ÉÉ9 :
user
ÉÉ; ?
.
ÉÉ? @
UserId
ÉÉ@ F
}
ÉÉG H
,
ÉÉH I
user
ÉÉJ N
)
ÉÉN O
;
ÉÉO P
}
ÑÑ 	
	protected
áá 
override
áá 
void
áá 
Dispose
áá  '
(
áá' (
bool
áá( ,
	disposing
áá- 6
)
áá6 7
{
àà 	
if
ââ 
(
ââ 
	disposing
ââ 
)
ââ 
{
ää 
db
ãã 
.
ãã 
Dispose
ãã 
(
ãã 
)
ãã 
;
ãã 
}
åå 
base
çç 
.
çç 
Dispose
çç 
(
çç 
	disposing
çç "
)
çç" #
;
çç# $
}
éé 	
private
êê 
bool
êê 

UserExists
êê 
(
êê  
int
êê  #
id
êê$ &
)
êê& '
{
ëë 	
return
íí 
db
íí 
.
íí 
Users
íí 
.
íí 
Count
íí !
(
íí! "
e
íí" #
=>
íí$ &
e
íí' (
.
íí( )
UserId
íí) /
==
íí0 2
id
íí3 5
)
íí5 6
>
íí7 8
$num
íí9 :
;
íí: ;
}
ìì 	
}
îî 
}ïï ÇB
DH:\AlphaMedic\AlphaMedic\Rest\Controllers\VaccionationsController.cs
	namespace 	
Rest
 
. 
Controllers 
{ 
public 

class "
VaccinationsController '
:( )
ApiController* 7
{ 
private 
AlphaMedicContext !
db" $
=% &
new' *
AlphaMedicContext+ <
(< =
)= >
;> ?
public 

IQueryable 
GetProcedures '
(' (
)( )
{ 	
return 
db 
. 

Procedures  
;  !
} 	
[ 	
	Authorize	 
] 
[ 	
ResponseType	 
( 
typeof 
( 
Vaccination (
)( )
)) *
]* +
public 
IHttpActionResult  
GetVaccination! /
(/ 0
int0 3
id4 6
)6 7
{ 	
var 
currentUser 
= 
db  
.  !
Users! &
.& '
FirstOrDefault' 5
(5 6
x6 7
=>8 :
x; <
.< =
Email= B
==C E
thisF J
.J K
UserK O
.O P
IdentityP X
.X Y
NameY ]
)] ^
;^ _
Vaccination"" 
vaccination"" #
=""$ %
(""& '
Vaccination""' 2
)""2 3
db""3 5
.""5 6

Procedures""6 @
.""@ A
Find""A E
(""E F
id""F H
)""H I
;""I J
if$$ 
($$ 
this$$ 
.$$ 
User$$ 
.$$ 
IsInRole$$ !
($$! "
Roles$$" '
.$$' (
Patient$$( /
)$$/ 0
&&$$1 3
vaccination$$4 ?
.$$? @
Appointment$$@ K
.$$K L
	PatientId$$L U
!=$$U W
currentUser$$W b
.$$b c
UserId$$c i
)$$i j
{%% 
return&& 
Content&& 
(&& 
HttpStatusCode&& -
.&&- .
	Forbidden&&. 7
,&&7 8
Messages&&9 A
.&&A B
AccsesDenied&&B N
)&&N O
;&&O P
}'' 
if)) 
()) 
vaccination)) 
==)) 
null)) #
)))# $
{** 
return++ 
NotFound++ 
(++  
)++  !
;++! "
},, 
return.. 
Ok.. 
(.. 
vaccination.. !
)..! "
;.." #
}// 	
[22 	
	Authorize22	 
(22 
Roles22 
=22 
Roles22  
.22  !

AllDoctors22! +
)22+ ,
]22, -
[33 	
ResponseType33	 
(33 
typeof33 
(33 
void33 !
)33! "
)33" #
]33# $
public44 
IHttpActionResult44  
PutVaccination44! /
(44/ 0
int440 3
id444 6
,446 7
Vaccination448 C
vaccination44D O
)44O P
{55 	
if66 
(66 
!66 

ModelState66 
.66 
IsValid66 #
)66# $
{77 
return88 

BadRequest88 !
(88! "

ModelState88" ,
)88, -
;88- .
}99 
if;; 
(;; 
id;; 
!=;; 
vaccination;; !
.;;! "
ProcedureId;;" -
);;- .
{<< 
return== 

BadRequest== !
(==! "
)==" #
;==# $
}>> 
db@@ 
.@@ 
Entry@@ 
(@@ 
vaccination@@  
)@@  !
.@@! "
State@@" '
=@@( )
EntityState@@* 5
.@@5 6
Modified@@6 >
;@@> ?
tryBB 
{CC 
dbDD 
.DD 
SaveChangesDD 
(DD 
)DD  
;DD  !
}EE 
catchFF 
(FF (
DbUpdateConcurrencyExceptionFF /
)FF/ 0
{GG 
ifHH 
(HH 
!HH 
VaccinationExistsHH &
(HH& '
idHH' )
)HH) *
)HH* +
{II 
returnJJ 
NotFoundJJ #
(JJ# $
)JJ$ %
;JJ% &
}KK 
elseLL 
{MM 
throwNN 
;NN 
}OO 
}PP 
returnRR 

StatusCodeRR 
(RR 
HttpStatusCodeRR ,
.RR, -
	NoContentRR- 6
)RR6 7
;RR7 8
}SS 	
[VV 	
	AuthorizeVV	 
(VV 
RolesVV 
=VV 
RolesVV 
.VV  

AllDoctorsVV  *
)VV* +
]VV+ ,
[WW 	
ResponseTypeWW	 
(WW 
typeofWW 
(WW 
VaccinationWW (
)WW( )
)WW) *
]WW* +
publicXX 
IHttpActionResultXX  
PostVaccinationXX! 0
(XX0 1
VaccinationXX1 <
vaccinationXX= H
)XXH I
{YY 	
ifZZ 
(ZZ 
!ZZ 

ModelStateZZ 
.ZZ 
IsValidZZ #
)ZZ# $
{[[ 
return\\ 

BadRequest\\ !
(\\! "

ModelState\\" ,
)\\, -
;\\- .
}]] 
ifaa 
(aa 
dbaa 
.aa 

Proceduresaa 
.aa 
FirstOrDefaultaa ,
(aa, -
xaa- .
=>aa/ 1
xaa2 3
.aa3 4
ProcedureIdaa4 ?
==aa@ B
vaccinationaaC N
.aaN O
ProcedureIdaaO Z
)aaZ [
!=aa\ ^
nullaa_ c
)aac d
returnbb 
Contentbb 
(bb 
HttpStatusCodebb -
.bb- .
Conflictbb. 6
,bb6 7
$strbb8 L
)bbL M
;bbM N
dbee 
.ee 

Proceduresee 
.ee 
Addee 
(ee 
vaccinationee )
)ee) *
;ee* +
trygg 
{hh 
dbii 
.ii 
SaveChangesii 
(ii 
)ii  
;ii  !
}kk 
catchll 
(ll 
DbUpdateExceptionll $
)ll$ %
{mm 
ifnn 
(nn 
VaccinationExistsnn %
(nn% &
(nn& '
intnn' *
)nn* +
vaccinationnn+ 6
.nn6 7
ProcedureIdnn7 B
)nnB C
)nnC D
{oo 
returnpp 
Conflictpp #
(pp# $
)pp$ %
;pp% &
}qq 
elserr 
{ss 
throwtt 
;tt 
}uu 
}vv 
returnxx 
CreatedAtRoutexx !
(xx! "
$strxx" .
,xx. /
newxx0 3
{xx4 5
idxx6 8
=xx9 :
vaccinationxx; F
.xxF G
ProcedureIdxxG R
}xxS T
,xxT U
vaccinationxxV a
)xxa b
;xxb c
}yy 	
	protected
ãã 
override
ãã 
void
ãã 
Dispose
ãã  '
(
ãã' (
bool
ãã( ,
	disposing
ãã- 6
)
ãã6 7
{
åå 	
if
çç 
(
çç 
	disposing
çç 
)
çç 
{
éé 
db
èè 
.
èè 
Dispose
èè 
(
èè 
)
èè 
;
èè 
}
êê 
base
ëë 
.
ëë 
Dispose
ëë 
(
ëë 
	disposing
ëë "
)
ëë" #
;
ëë# $
}
íí 	
private
îî 
bool
îî 
VaccinationExists
îî &
(
îî& '
int
îî' *
id
îî+ -
)
îî- .
{
ïï 	
return
ññ 
db
ññ 
.
ññ 

Procedures
ññ  
.
ññ  !
Count
ññ! &
(
ññ& '
e
ññ' (
=>
ññ) +
e
ññ, -
.
ññ- .
ProcedureId
ññ. 9
==
ññ: <
id
ññ= ?
)
ññ? @
>
ññA B
$num
ññC D
;
ññD E
}
óó 	
}
òò 
}ôô ΩN
DH:\AlphaMedic\AlphaMedic\Rest\Controllers\WarningLabelsController.cs
	namespace 	
Rest
 
. 
Controllers 
{ 
public 

class #
WarningLabelsController (
:) *
ApiController+ 8
{ 
private 
AlphaMedicContext !
db" $
=% &
new' *
AlphaMedicContext+ <
(< =
)= >
;> ?
public 

IQueryable 
< 
WarningLabel &
>& '
GetWarningLabels( 8
(8 9
)9 :
{ 	
return 
db 
. 
WarningLabels #
;# $
} 	
[ 	
	Authorize	 
] 
[ 	
ResponseType	 
( 
typeof 
( 
WarningLabel )
)) *
)* +
]+ ,
public 
IHttpActionResult  
GetWarningLabel! 0
(0 1
int1 4
id5 7
)7 8
{ 	
var!! 
currentUser!! 
=!! 
db!!  
.!!  !
Users!!! &
.!!& '
FirstOrDefault!!' 5
(!!5 6
x!!6 7
=>!!8 :
x!!; <
.!!< =
Email!!= B
==!!C E
this!!F J
.!!J K
User!!K O
.!!O P
Identity!!P X
.!!X Y
Name!!Y ]
)!!] ^
;!!^ _
if## 
(## 
currentUser## 
==## 
null## #
)### $
{$$ 
return%% 
NotFound%% 
(%%  
)%%  !
;%%! "
}&& 
WarningLabel(( 
warningLabel(( %
=((& '
db((( *
.((* +
WarningLabels((+ 8
.((8 9
Find((9 =
(((= >
id((> @
)((@ A
;((A B
if)) 
()) 
warningLabel)) 
==)) 
null))  $
)))$ %
{** 
return++ 
NotFound++ 
(++  
)++  !
;++! "
},, 
if.. 
(.. 
Tools.. 
... 
AnyRole.. 
(.. 
this.. "
..." #
User..# '
,..' (
Roles..( -
...- .
DoctorRoles... 9
)..9 :
&&..; =
!..> ?
warningLabel..? K
...K L
MedicalHistory..L Z
...Z [
Patient..[ b
...b c
Appointments..c o
...o p
Any..p s
(..s t
x..t u
=>..v x
x..y z
...z {
DoctorId	..{ É
==
..Ñ Ü
currentUser
..á í
.
..í ì
UserId
..ì ô
)
..ô ö
)
..ö õ
{// 
return00 
Content00 
(00 
HttpStatusCode00 -
.00- .
	Forbidden00. 7
,007 8
Messages009 A
.00A B
AccsesDenied00B N
)00N O
;00O P
}11 
if22 
(22 
this22 
.22 
User22 
.22 
IsInRole22 "
(22" #
Roles22# (
.22( )
Patient22) 0
)220 1
&&222 4
warningLabel226 B
.22B C
MedicalHistory22C Q
.22Q R
Patient22R Y
.22Y Z
UserId22Z `
!=22a c
currentUser22d o
.22o p
UserId22p v
)22v w
{33 
return44 
Content44 
(44 
HttpStatusCode44 -
.44- .
	Forbidden44. 7
,447 8
Messages449 A
.44A B
AccsesDenied44B N
)44N O
;44O P
}55 
return99 
Ok99 
(99 
warningLabel99 "
)99" #
;99# $
}?? 	
[BB 	
	AuthorizeBB	 
(BB 
RolesBB 
=BB 
RolesBB 
.BB 

AllDoctorsBB )
)BB) *
]BB* +
[CC 	
ResponseTypeCC	 
(CC 
typeofCC 
(CC 
voidCC !
)CC! "
)CC" #
]CC# $
publicDD 
IHttpActionResultDD  
PutWarningLabelDD! 0
(DD0 1
intDD1 4
idDD5 7
,DD7 8
WarningLabelDD9 E
warningLabelDDF R
)DDR S
{EE 	
ifFF 
(FF 
!FF 

ModelStateFF 
.FF 
IsValidFF #
)FF# $
{GG 
returnHH 

BadRequestHH !
(HH! "

ModelStateHH" ,
)HH, -
;HH- .
}II 
ifKK 
(KK 
idKK 
!=KK 
warningLabelKK "
.KK" #
WarningLabelIdKK# 1
)KK1 2
{LL 
returnMM 

BadRequestMM !
(MM! "
)MM" #
;MM# $
}NN 
dbRR 
.RR 
EntryRR 
(RR 
warningLabelRR !
)RR! "
.RR" #
StateRR# (
=RR) *
EntityStateRR+ 6
.RR6 7
ModifiedRR7 ?
;RR? @
tryTT 
{UU 
dbVV 
.VV 
SaveChangesVV 
(VV 
)VV  
;VV  !
}WW 
catchXX 
(XX (
DbUpdateConcurrencyExceptionXX /
)XX/ 0
{YY 
ifZZ 
(ZZ 
!ZZ 
WarningLabelExistsZZ '
(ZZ' (
idZZ( *
)ZZ* +
)ZZ+ ,
{[[ 
return\\ 
NotFound\\ #
(\\# $
)\\$ %
;\\% &
}]] 
else^^ 
{__ 
throw`` 
;`` 
}aa 
}bb 
returndd 

StatusCodedd 
(dd 
HttpStatusCodedd ,
.dd, -
	NoContentdd- 6
)dd6 7
;dd7 8
}ee 	
[hh 	
	Authorizehh	 
(hh 
Roleshh 
=hh 
Roleshh 
.hh 

AllDoctorshh )
)hh) *
]hh* +
publicjj 
IHttpActionResultjj  
PostWarningLabeljj! 1
(jj1 2
WarningLabeljj2 >
warningLabeljj? K
)jjK L
{kk 	
ifll 
(ll 
!ll 

ModelStatell 
.ll 
IsValidll #
)ll# $
{mm 
returnnn 

BadRequestnn !
(nn! "

ModelStatenn" ,
)nn, -
;nn- .
}oo 
varpp 
currentUserpp 
=pp 
dbpp  
.pp  !
Userspp! &
.pp& '
FirstOrDefaultpp' 5
(pp5 6
xpp6 7
=>pp8 :
xpp; <
.pp< =
Emailpp= B
==ppC E
thisppF J
.ppJ K
UserppK O
.ppO P
IdentityppP X
.ppX Y
NameppY ]
)pp] ^
;pp^ _
varqq 
medHistqq 
=qq 
dbqq 
.qq 
MedicalHistorysqq ,
.qq, -
Findqq- 1
(qq1 2
warningLabelqq2 >
.qq> ?
MedicalHistoryIdqq? O
)qqO P
;qqP Q
ifss 
(ss 
currentUserss 
==ss 
nullss #
)ss# $
{tt 
returnuu 
NotFounduu 
(uu  
)uu  !
;uu! "
}vv 
ifww 
(ww 
medHistww 
==ww 
nullww 
||ww  "
!ww$ %
medHistww% ,
.ww, -
Patientww- 4
.ww4 5
Appointmentsww5 A
.wwA B
AnywwB E
(wwE F
xwwF G
=>wwH J
xwwK L
.wwL M
DoctorIdwwM U
==wwV X
currentUserwwY d
.wwd e
UserIdwwe k
)wwk l
)wwl m
{xx 
returnyy 
Contentyy 
(yy 
HttpStatusCodeyy -
.yy- .
	Forbiddenyy. 7
,yy7 8
Messagesyy8 @
.yy@ A
AccsesDeniedyyA M
)yyM N
;yyN O
}zz 
db|| 
.|| 
WarningLabels|| 
.|| 
Add||  
(||  !
warningLabel||! -
)||- .
;||. /
db}} 
.}} 
SaveChanges}} 
(}} 
)}} 
;}} 
return 
Ok 
( 
new 
{ 
warningLabel (
.( )
Description) 4
,4 5
warningLabel6 B
.B C
WarningLabelIdC Q
,Q R
warningLabelR ^
.^ _
MedicalHistoryId_ o
}o p
)p q
;q r
}
ÅÅ 	
	protected
ìì 
override
ìì 
void
ìì 
Dispose
ìì  '
(
ìì' (
bool
ìì( ,
	disposing
ìì- 6
)
ìì6 7
{
îî 	
if
ïï 
(
ïï 
	disposing
ïï 
)
ïï 
{
ññ 
db
óó 
.
óó 
Dispose
óó 
(
óó 
)
óó 
;
óó 
}
òò 
base
ôô 
.
ôô 
Dispose
ôô 
(
ôô 
	disposing
ôô "
)
ôô" #
;
ôô# $
}
öö 	
private
úú 
bool
úú  
WarningLabelExists
úú '
(
úú' (
int
úú( +
id
úú, .
)
úú. /
{
ùù 	
return
ûû 
db
ûû 
.
ûû 
WarningLabels
ûû #
.
ûû# $
Count
ûû$ )
(
ûû) *
e
ûû* +
=>
ûû, .
e
ûû/ 0
.
ûû0 1
WarningLabelId
ûû1 ?
==
ûû@ B
id
ûûC E
)
ûûE F
>
ûûG H
$num
ûûI J
;
ûûJ K
}
üü 	
}
†† 
}°° ê
4H:\AlphaMedic\AlphaMedic\Rest\Dtos\AppointmentDto.cs
	namespace 	
Rest
 
. 
Dtos 
{ 
public 

class 
AppointmentDto 
{ 
public 
int 
AppointmentId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
ProcedureName #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
DoctorFullName $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
int 
DoctorId 
{ 
get !
;! "
set# &
;& '
}( )
public		 
int		 
DepartmentId		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
}

 
} €
0H:\AlphaMedic\AlphaMedic\Rest\Dtos\PatientDto.cs
	namespace 	
Rest
 
. 
Dtos 
{ 
public 

class 

PatientDto 
: 
ShortUserDto *
{		 
public

 
string

 
URLImage

 
{

  
get

! $
;

$ %
set

& )
;

) *
}

+ ,
public 
AppointmentDto 
	Procedure '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
} 
} ’
3H:\AlphaMedic\AlphaMedic\Rest\Dtos\DateFilterDto.cs
	namespace 	
Rest
 
. 
Dtos 
{ 
public 

class 
DateFilterDto 
{		 
public

 
DateTime

 
?

 

periodFrom

 #
{

$ %
get

& )
;

) *
set

+ .
;

. /
}

0 1
public 
DateTime 
? 

periodTill #
{$ %
get& )
;) *
set+ .
;. /
}0 1
} 
} ¶
3H:\AlphaMedic\AlphaMedic\Rest\Dtos\DepartmentDto.cs
	namespace 	
Rest
 
. 
Dtos 
{ 
public 

class 
DepartmentDto 
{ 
public 
int 
DepartmentId 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
} 
public

 

class

 
DepartmentFullDto

 "
{ 
public 
int 
DepartmentId 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
ShortUserDto 
HeadDepartment *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
public 
FeedbackDto 
[ 
] 
	Feedbacks &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
int 
FeedbacksCount !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
URLImage 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ˙
/H:\AlphaMedic\AlphaMedic\Rest\Dtos\DoctorDto.cs
	namespace 	
Rest
 
. 
Dtos 
{ 
public		 

class		 
	DoctorDto		 
:		 
ShortUserDto		 )
{

 
public 
int 
DepartmentId 
{  !
get" %
;% &
set' *
;* +
}, -
public 
int 
DoctorId 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
DepartmentName $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
string 
Degree 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
	Education 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 

DoctorType  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
TimeSpan 
StartWorkingTime (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
TimeSpan 
FinishWorkingTime )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
public 
string 
URLImage 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
bool 
? 
Active 
{ 
get !
;! "
set# &
;& '
}( )
public 

DoctorType 
DoctorTypeInt '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
} 
} ˙
2H:\AlphaMedic\AlphaMedic\Rest\Dtos\EmailPostDto.cs
	namespace 	
Rest
 
. 
Dtos 
{ 
public

 

enum

 
EmailPostState

 
{ 
confirm 
, 
delete 
, 
change 
} 
public 

class 
EmailPostDto 
{ 
public 
Appointment 
appointment &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
EmailPostState 

EmailState (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
} 
} ﬂ
1H:\AlphaMedic\AlphaMedic\Rest\Dtos\EmployeeDto.cs
	namespace 	
Rest
 
. 
Dtos 
{ 
public		 

class		 
EmployeeDto		 
:		 
UserDto		 $
{

 
public 
DateTime 
EmploymentDate &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
string &
EmploymentRecordBookNumber 0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
public 
DateTime 
? 
DismissalDate &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
EmployeeType 
EmployeeType (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
void 
UpateEmployee !
(! "
Employee" *
emp+ .
). /
{ 	
emp 
. 
Name 
= 
Name 
; 
emp 
. 
Surname 
= 
Surname !
;! "
emp 
. 
Phone 
= 
Phone 
; 
emp 
. 
Email 
= 
Email 
; 
emp 
. &
EmploymentRecordBookNumber *
=+ ,&
EmploymentRecordBookNumber- G
;G H
emp 
. 
Address 
= 
Address !
;! "
emp 
. 
EmployeeType 
= 
EmployeeType +
;+ ,
} 	
} 
} »	
1H:\AlphaMedic\AlphaMedic\Rest\Dtos\FeedbackDto.cs
	namespace 	
Rest
 
. 
Dtos 
{ 
public 

class 
FeedbackDto 
{ 
public 
int 

FeedbackId 
{ 
get  #
;# $
set% (
;( )
}* +
public 
int 
? 
DepartmentId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public		 
DateTime		 
?		 
Date		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
public

 
string

 
Description

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
public 
string 
PatientFullName %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 
string 
PatientURLImage '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
} 
} û
-H:\AlphaMedic\AlphaMedic\Rest\Dtos\JsonDto.cs
	namespace 	
Rest
 
. 
Dtos 
{ 
public		 

class		 
JsonDto		 
{

 
public 
int 
count 
{ 
get 
; 
set  #
;# $
}% &
public 
ICollection 
data 
{  !
get" %
;% &
set' *
;* +
}, -
} 
} Õ
3H:\AlphaMedic\AlphaMedic\Rest\Dtos\MedicationDto.cs
	namespace 	
Rest
 
. 
Dtos 
{ 
public 

class 
MedicationDto 
{ 
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
decimal 
Price 
{ 
get "
;" #
set$ '
;' (
}) *
public		 
int		 
MedicationId		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
}

 
} §
2H:\AlphaMedic\AlphaMedic\Rest\Dtos\ProcedureDto.cs
	namespace 	
Rest
 
. 
Dtos 
{ 
public 

class 
ProcedureDto 
{ 
public		 
int		 
ProcedureId		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
public

 
string

 
Name

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
DateTime 
Date 
{ 
get "
;" #
set$ '
;' (
}) *
public 
decimal 
? 
Price 
{ 
get  #
;# $
set% (
;( )
}* +
public 
ShortUserDto 
Doctor "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
virtual 
string 
Type "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
AppointmentState 
State  %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
} 
public 

class 
ExaminationDto 
:  !
ProcedureDto" .
{ 
public 
	Diagnosis 
	Diagnosis "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
override 
string 
Type #
{$ %
get& )
{* +
return, 2
$str3 @
;@ A
}B C
}D E
} 
public 

class 
VaccinationDto 
:  !
ProcedureDto" .
{ 
public 
override 
string 
Type #
{$ %
get& )
{* +
return, 2
$str3 @
;@ A
}B C
}D E
} 
public 

class 
TreatmentDto 
: 
ProcedureDto  ,
{ 
public   
IEnumerable   
<   
MedicationDto   (
>  ( )
Medications  * 5
{  6 7
get  8 ;
;  ; <
set  = @
;  @ A
}  B C
public"" 
string"" 
Result"" 
{"" 
get"" "
;""" #
set""$ '
;""' (
}"") *
public$$ 
override$$ 
string$$ 
Type$$ #
{$$$ %
get$$& )
{$$* +
return$$, 2
$str$$3 >
;$$> ?
}$$@ A
}$$B C
}%% 
}&& ß
0H:\AlphaMedic\AlphaMedic\Rest\Dtos\ChangePass.cs
	namespace 	
Rest
 
. 
Dtos 
{ 
public		 

class		 

ChangePass		 
{

 
public 
string 
OldPass 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
NewPass 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} ±
-H:\AlphaMedic\AlphaMedic\Rest\Dtos\UserDto.cs
	namespace 	
Rest
 
. 
Dtos 
{ 
public 

class 
UserDto 
{ 
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
public		 
string		 
Name		 
{		 
get		  
;		  !
set		" %
;		% &
}		' (
public

 
string

 
Surname

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
public 

GenderType 
Gender  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
DateTime 
? 
DateOfBirth $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
string 
Phone 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Address 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
URLImage 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
} 
public 

class 
ShortUserDto 
{ 
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Surname 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} ä
,H:\AlphaMedic\AlphaMedic\Rest\Global.asax.cs
	namespace		 	
Rest		
 
{

 
public 

class 
WebApiApplication "
:# $
System% +
.+ ,
Web, /
./ 0
HttpApplication0 ?
{ 
	protected 
void 
Application_Start (
(( )
)) *
{ 	
GlobalConfiguration 
.  
	Configure  )
() *
WebApiConfig* 6
.6 7
Register7 ?
)? @
;@ A
GlobalConfiguration 
.  
Configuration  -
.- .

Formatters. 8
.8 9
JsonFormatter9 F
.F G
SerializerSettingsG Y
.Y Z!
ReferenceLoopHandlingZ o
=p q

Newtonsoftr |
.| }
Json	} Å
.
Å Ç#
ReferenceLoopHandling
Ç ó
.
ó ò
Ignore
ò û
;
û ü
GlobalConfiguration 
.  
Configuration  -
.- .

Formatters. 8
.8 9
Remove9 ?
(? @
GlobalConfiguration@ S
.S T
ConfigurationT a
.a b

Formattersb l
.l m
XmlFormatterm y
)y z
;z {
} 	
} 
} Ó)
4H:\AlphaMedic\AlphaMedic\Rest\Helpers\EMailHelper.cs
	namespace 	
Rest
 
. 
Helpers 
{ 
public 

class 
EMailHelper 
{ 
private 
const 
string 
Email "
=# $
$str% 7
;7 8
private 
const 
string 
fromPassword )
=* +
$str, 9
;9 :
public 
static 
void 
SendNotification +
(+ ,

EmailInput, 6

emailInput7 A
)A B
{ 	
var 
fromAddress 
= 
new !
MailAddress" -
(- .
Email. 3
,3 4
$str5 @
)@ A
;A B
var 
	toAddress 
= 
new 
MailAddress  +
(+ ,

emailInput, 6
.6 7
Email7 <
,< =

emailInput> H
.H I
UserNameI Q
)Q R
;R S
var 
smtp 
= 
new 

SmtpClient %
{ 
Host 
=	 

$str 
, 
Port 
=	 

$num 
, 
	EnableSsl 
= 
true 
, 
DeliveryMethod   
=    
SmtpDeliveryMethod  ! 3
.  3 4
Network  4 ;
,  ; <
Credentials!! 
=!! 
new!! !
NetworkCredential!!" 3
(!!3 4
fromAddress!!4 ?
.!!? @
Address!!@ G
,!!G H
fromPassword!!I U
)!!U V
}"" 
;"" 
using$$ 
($$ 
var$$ 
message$$ 
=$$  
new$$! $
MailMessage$$% 0
($$0 1
fromAddress$$1 <
,$$< =
	toAddress$$> G
)$$G H
{%% 
Subject&& 
=&& 

emailInput&& $
.&&$ %
Subject&&% ,
,&&, -
Body'' 
='' 

emailInput'' !
.''! "
Body''" &
,''& '
}(( 
)(( 
{)) 
smtp** 
.** 
Send** 
(** 
message** !
)**! "
;**" #
smtp++ 
.++ 
Dispose++ 
(++ 
)++ 
;++ 
},, 
}-- 	
public00 
static00 
void00 +
SendConfirmRegisterNotification00 :
(00: ;

EmailInput00; E

emailInput00F P
,00P Q
int00R U
idUser00V \
)00\ ]
{11 	
var22 
fromAddress22 
=22 
new22 !
MailAddress22" -
(22- .
Email22. 3
,223 4
$str225 @
)22@ A
;22A B
var33 
	toAddress33 
=33 
new33 
MailAddress33  +
(33+ ,

emailInput33, 6
.336 7
Email337 <
,33< =

emailInput33> H
.33H I
UserName33I Q
)33Q R
;33R S
string44 
html44 
=44 
$str44 Y
+44Z [
	Constants44\ e
.44e f
MyClient44f n
+55 
$str55 *
+55+ ,
idUser55- 3
+554 5
$str556 H
;55H I
var77 
smtp77 
=77 
new77 

SmtpClient77 %
{88 
Host99 
=99 
$str99 %
,99% &
Port:: 
=:: 
$num:: 
,:: 
	EnableSsl;; 
=;; 
true;; 
,;; 
DeliveryMethod<< 
=<<  
SmtpDeliveryMethod<<! 3
.<<3 4
Network<<4 ;
,<<; <
Credentials== 
=== 
new== !
NetworkCredential==" 3
(==3 4
fromAddress==4 ?
.==? @
Address==@ G
,==G H
fromPassword==I U
)==U V
}>> 
;>> 
var@@ 
message@@ 
=@@ 
new@@ 
MailMessage@@ )
(@@) *
fromAddress@@* 5
,@@5 6
	toAddress@@7 @
)@@@ A
;@@A B
messageAA 
.AA 
SubjectAA 
=AA 

emailInputAA (
.AA( )
SubjectAA) 0
;AA0 1
messageBB 
.BB 
AlternateViewsBB "
.BB" #
AddBB# &
(BB& '
AlternateViewBB' 4
.BB4 5)
CreateAlternateViewFromStringBB5 R
(BBR S
htmlBBS W
,BBW X
nullBBY ]
,BB] ^
MediaTypeNamesBB_ m
.BBm n
TextBBn r
.BBr s
HtmlBBs w
)BBw x
)BBx y
;BBy z
smtpDD 
.DD 
SendDD 
(DD 
messageDD 
)DD 
;DD 
smtpEE 
.EE 
DisposeEE 
(EE 
)EE 
;EE 
messageFF 
.FF 
DisposeFF 
(FF 
)FF 
;FF 
}GG 	
}JJ 
}KK Á
3H:\AlphaMedic\AlphaMedic\Rest\Helpers\HashHelper.cs
	namespace 	
Rest
 
. 
Helpers 
{		 
public

 

static

 
class

 

HashHelper

 "
{ 
private 
static 
SHA256 
hash "
=# $
SHA256% +
.+ ,
Create, 2
(2 3
)3 4
;4 5
public 
static 
string 
sha256_hash (
(( )
string) /
value0 5
)5 6
{ 	
StringBuilder 
Sb 
= 
new "
StringBuilder# 0
(0 1
)1 2
;2 3
Encoding 
enc 
= 
Encoding #
.# $
UTF8$ (
;( )
byte 
[ 
] 
result 
= 
hash  
.  !
ComputeHash! ,
(, -
enc- 0
.0 1
GetBytes1 9
(9 :
value: ?
)? @
)@ A
;A B
foreach 
( 
byte 
b 
in 
result %
)% &
Sb 
. 
Append 
( 
b 
. 
ToString $
($ %
$str% )
)) *
)* +
;+ ,
return 
Sb 
. 
ToString 
( 
)  
;  !
} 	
} 
} Å
5H:\AlphaMedic\AlphaMedic\Rest\Models\Administrator.cs
	namespace 	
Rest
 
. 
Models 
{		 
[

 
Table

 

(


 
$str

 
)

 
]

 
public 

class 
Administrator 
:  
Employee! )
{ 
} 
} ∑'
KH:\AlphaMedic\AlphaMedic\Rest\Models\AlphaMedicContext\AlphaMedicContext.cs
	namespace 	
Rest
 
. 
Models 
. 
AlphaMedicContext '
{ 
public		 

class		 
AlphaMedicContext		 "
:		# $
	DbContext		% .
{

 
public 
AlphaMedicContext  
(  !
)! "
:# $
base% )
() *
$str	* Å
)
Å Ç
{
É Ñ
}
Ö Ü
public 
virtual 
DbSet 
< 
Appointment (
>( )
Appointments* 6
{7 8
get9 <
;< =
set> A
;A B
}C D
public 
virtual 
DbSet 
< 

Department '
>' (
Departments) 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
public 
DbSet 
< 
	Diagnosis 
> 

Diagnosiss  *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
public 
virtual 
DbSet 
< 
Doctor #
># $
Doctors% ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
public 
DbSet 
< 
Employee 
> 
	Employees (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
DbSet 
< 
Examination  
>  !
Examinations" .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
public 
DbSet 
< 
Feedback 
> 
	Feedbacks (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
DbSet 
< 
MedicalHistory #
># $
MedicalHistorys% 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
public 
virtual 
DbSet 
< 

Medication '
>' (
Medications) 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
public 
virtual 
DbSet 
< 
Patient $
>$ %
Patients& .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
public 
DbSet 
< 
	Procedure 
> 

Procedures  *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
public 
DbSet 
< 
Schedule 
> 
	Schedules (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
DbSet 
< 
	Treatment 
> 

Treatments  *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
public 
virtual 
DbSet 
< 
User !
>! "
Users# (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public   
DbSet   
<   
	UserClaim   
>   

UserClaims    *
{  + ,
get  - 0
;  0 1
set  2 5
;  5 6
}  7 8
public!! 
DbSet!! 
<!! 
Vaccination!!  
>!!  !
Vaccinations!!" .
{!!/ 0
get!!1 4
;!!4 5
set!!6 9
;!!9 :
}!!; <
public"" 
DbSet"" 
<"" 
WarningLabel"" !
>""! "
WarningLabels""# 0
{""1 2
get""3 6
;""6 7
set""8 ;
;""; <
}""= >
public## 
DbSet## 
<## !
MobileAuthentificator## *
>##* +"
MobileAuthentificators##, B
{##C D
get##E H
;##H I
set##J M
;##M N
}##O P
	protected00 
override00 
void00 
OnModelCreating00  /
(00/ 0
DbModelBuilder000 >
modelBuilder00? K
)00K L
{11 	
base22 
.22 
OnModelCreating22  
(22  !
modelBuilder22! -
)22- .
;22. /
}33 	
public55 
DbSet55 
<55 

BloodGroup55 
>55  
BloodGroups55! ,
{55- .
get55/ 2
;552 3
set554 7
;557 8
}559 :
}66 
}77 ö
3H:\AlphaMedic\AlphaMedic\Rest\Models\Appointment.cs
	namespace 	
Rest
 
. 
Models 
{		 
public

 

enum

 
AppointmentState

  
{ 
Unconfirmed 
, 
Accepted 
, 
Finished 
} 
public 

class 
Appointment 
{ 
[ 	
DatabaseGenerated	 
( #
DatabaseGeneratedOption 2
.2 3
Identity3 ;
); <
]< =
[ 	
Key	 
] 
public 
int 
AppointmentId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
AppointmentState 
State  %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
[ 	

ForeignKey	 
( 
$str 
) 
] 
public 
int 
? 
DoctorId 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	

ForeignKey	 
( 
$str 
) 
] 
public 
int 
	PatientId 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public!! 
DateTime!! 
?!! 
Date!! 
{!! 
get!!  #
;!!# $
set!!% (
;!!( )
}!!* +
[## 	
DataType##	 
(## 
DataType## 
.## 
Time## 
)##  
]##  !
public$$ 
TimeSpan$$ 
?$$ 
Duration$$ !
{$$" #
get$$$ '
;$$' (
set$$) ,
;$$, -
}$$. /
public&& 
bool&& 
?&& 
Checked&& 
{&& 
get&& "
;&&" #
set&&$ '
;&&' (
}&&) *
public(( 
virtual(( 
Doctor(( 
Doctor(( $
{((% &
get((' *
;((* +
set((, /
;((/ 0
}((1 2
public)) 
virtual)) 
	Procedure))  
	Procedure))! *
{))+ ,
get))- 0
;))0 1
set))2 5
;))5 6
}))7 8
public** 
virtual** 
Patient** 
Patient** &
{**' (
get**) ,
;**, -
set**. 1
;**1 2
}**3 4
},, 
}-- ÿ
2H:\AlphaMedic\AlphaMedic\Rest\Models\BloodGroup.cs
	namespace 	
Rest
 
. 
Models 
{		 
public

 

class

 

BloodGroup

 
{ 
public 

BloodGroup 
( 
) 
{ 
} 
[ 	
Key	 
, 
DatabaseGenerated 
(  #
DatabaseGeneratedOption  7
.7 8
Identity8 @
)@ A
]A B
public 
int 
BloodGroupId 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
Group 
{ 
get !
;! "
set# &
;& '
}( )
} 
} ˜
1H:\AlphaMedic\AlphaMedic\Rest\Models\Constants.cs
	namespace 	
Rest
 
. 
Models 
{ 
public 

struct 
Messages 
{		 
public

 
const

 
string

 
AccsesDenied

 )
=

) *
$str

+ :
;

: ;
public 
const 
string 
AppointmentNotFound 0
=1 2
$str3 J
;J K
public 
const 
string 
UserNotFound (
=) *
$str+ ;
;; <
public 
const 
string 
BadDataInFields +
=, -
$str. M
;M N
} 
public 

class 
Roles 
{ 
public 
const 
string 
Administrator +
=, -
$str. =
;= >
public 
const 
string 
Doctor "
=# $
$str% -
;- .
public 
const 
string 

AllDoctors &
=' (
$str) M
;M N
public 
const 
string 
HospitalDean (
=) *
$str+ 9
;9 :
public 
const 
string 
DepartmentHead *
=+ ,
$str- =
;= >
public 
const 
string 
Receptionist (
=) *
$str+ 9
;9 :
public 
const 
string 
Patient #
=$ %
$str& /
;/ 0
public 
static 
List 
< 
string !
>! "
DoctorRoles# .
=/ 0
new1 4
List5 9
<9 :
string: @
>@ A
{B C
$strD L
,L M
$strN \
,\ ]
$str^ n
}o p
;p q
} 
public 

static 
class 
	Constants !
{ 
public 
const 
string 

ThisServer '
=( )
$str* D
;D E
public   
const   
string   
MyClient   $
=  % &
$str  ' @
;  @ A
public!! 
const!! 
string!! 
DefaultDoctorImage!! .
=!!/ 0
$str!!1 N
;!!N O
public"" 
const"" 
string"" 
DefaultPatientImage"" 0
=""1 2
$str""3 T
;""T U
}%% 
}&& Æ
2H:\AlphaMedic\AlphaMedic\Rest\Models\Department.cs
	namespace 	
Rest
 
. 
Models 
{		 
public

 

class

 

Department

 
:

 
IFeedbackObject

 +
{ 
public 

Department 
( 
) 
{ 	
Doctors 
= 
new 
List 
< 
Doctor %
>% &
(& '
)' (
;( )
	Feedbacks 
= 
new 
List  
<  !
Feedback! )
>) *
(* +
)+ ,
;, -
} 	
[ 	
DatabaseGenerated	 
( #
DatabaseGeneratedOption 2
.2 3
Identity3 ;
); <
]< =
[ 	
Key	 
] 
public 
int 
DepartmentId 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	
Required	 
] 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
Required	 
] 
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
URLImage 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
virtual 
ICollection "
<" #
Doctor# )
>) *
Doctors+ 2
{3 4
get5 8
;8 9
set: =
;= >
}? @
public 
virtual 
ICollection "
<" #
Feedback# +
>+ ,
	Feedbacks- 6
{7 8
get9 <
;< =
set> A
;A B
}C D
[   	
	NotMapped  	 
]   
public!! 
Doctor!! 
HeadDepartment!! $
{!!% &
get!!' *
;!!* +
set!!, /
;!!/ 0
}!!1 2
}"" 
}## Œ
1H:\AlphaMedic\AlphaMedic\Rest\Models\Diagnosis.cs
	namespace 	
Rest
 
. 
Models 
{ 
public 

class 
	Diagnosis 
{ 
[		 	
DatabaseGenerated			 
(		 #
DatabaseGeneratedOption		 2
.		2 3
Identity		3 ;
)		; <
]		< =
[

 	
Key

	 
]

 
public 
int 
DiagnosisId 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
Required	 
] 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
} 
} ˇ
.H:\AlphaMedic\AlphaMedic\Rest\Models\Doctor.cs
	namespace 	
Rest
 
. 
Models 
{ 
public 

enum 

DoctorType 
{ 
Doctor		 
=		 
$num		 
,		 
HeadDepartment

 
=

 
$num

 
,

 
HospitalDean 
= 
$num 
} 
[ 
Table 

(
 
$str 
) 
] 
public 

class 
Doctor 
: 
Employee "
{ 
public 
Doctor 
( 
) 
{ 	
	Feedbacks 
= 
new 
List  
<  !
Feedback! )
>) *
(* +
)+ ,
;, -
} 	
public 
string 
Degree 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
	Education 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	

ForeignKey	 
( 
$str 
) 
]  
public 
int 
? 

ScheduleId 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
int 
DepartmentId 
{  !
get" %
;% &
set' *
;* +
}, -
public 

DoctorType 

DoctorType $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public   
virtual   
Schedule   
Schedule    (
{  ) *
get  + .
;  . /
set  0 3
;  3 4
}  5 6
public!! 
virtual!! 

Department!! !

Department!!" ,
{!!- .
get!!/ 2
;!!2 3
set!!4 7
;!!7 8
}!!9 :
public## 
virtual## 
ICollection## "
<##" #
Feedback### +
>##+ ,
	Feedbacks##- 6
{##7 8
get##9 <
;##< =
set##> A
;##A B
}##C D
[&& 	
	NotMapped&&	 
]&& 
public'' 
string'' 
FullName'' 
{''  
get''! $
{''% &
return''' -
this''. 2
.''2 3
Name''3 7
+''8 9
$str'': =
+''> ?
this''@ D
.''D E
Surname''E L
;''L M
}''N O
}''P Q
})) 
}** ›
2H:\AlphaMedic\AlphaMedic\Rest\Models\EmailInput.cs
	namespace 	
Rest
 
. 
Models 
{ 
public 

class 

EmailInput 
{		 
public

 
string

 
UserName

 
{

  
get

! $
;

$ %
set

& )
;

) *
}

+ ,
public 
string 
Email 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
Body 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Subject 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} ¯	
0H:\AlphaMedic\AlphaMedic\Rest\Models\Employee.cs
	namespace 	
Rest
 
. 
Models 
{ 
public

 

enum

 
EmployeeType

 
{ 
Administrator 
, 
Receptionist 
, 
Doctor 
} 
[ 
Table 

(
 
$str 
) 
] 
public 

abstract 
class 
Employee "
:# $
User% )
{ 
public 
DateTime 
EmploymentDate '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 
string &
EmploymentRecordBookNumber 1
{2 3
get4 7
;7 8
set9 <
;< =
}> ?
public 
DateTime 
? 
DismissalDate '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 
EmployeeType 
EmployeeType )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
} 
} ﬁ
3H:\AlphaMedic\AlphaMedic\Rest\Models\Examination.cs
	namespace 	
Rest
 
. 
Models 
{ 
[		 
Table		 

(		
 
$str		 
)		 
]		 
public

 

class

 
Examination

 
:

 
	Procedure

 (
{ 
public 
int 
? 
DiagnosisId 
{  !
get" %
;% &
set' *
;* +
}, -
public 
virtual 
	Diagnosis  
	Diagnosis! *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
} 
} á
0H:\AlphaMedic\AlphaMedic\Rest\Models\Feedback.cs
	namespace 	
Rest
 
. 
Models 
{		 
public

 

	interface

 
IFeedbackObject

 $
{ 
ICollection 
< 
Feedback 
> 
	Feedbacks '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
} 
public 

class 
Feedback 
{ 
[ 	
Key	 
, 
DatabaseGenerated 
(  #
DatabaseGeneratedOption  7
.7 8
Identity8 @
)@ A
]A B
public 
int 

FeedbackId 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	

ForeignKey	 
( 
$str 
) 
] 
public 
int 
? 
	PatientId 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	

ForeignKey	 
( 
$str  
)  !
]! "
public 
int 
? 
DepartmentId  
{! "
get# &
;& '
set( +
;+ ,
}- .
[ 	

ForeignKey	 
( 
$str 
) 
] 
public 
int 
? 
DoctorId 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
DateTime 
? 
Date 
{ 
get  #
;# $
set% (
;( )
}* +
public   
virtual   

Department   !

Department  " ,
{  - .
get  / 2
;  2 3
set  4 7
;  7 8
}  9 :
public!! 
virtual!! 
Doctor!! 
Doctor!! $
{!!% &
get!!' *
;!!* +
set!!, /
;!!/ 0
}!!1 2
public"" 
virtual"" 
Patient"" 
Patient"" &
{""' (
get"") ,
;"", -
set"". 1
;""1 2
}""3 4
}$$ 
}%% ˝
6H:\AlphaMedic\AlphaMedic\Rest\Models\HeadDepartment.cs
	namespace 	
Rest
 
. 
Models 
{ 
public

 

class

 
HeadDepartment

 
{ 
} 
} ˘
4H:\AlphaMedic\AlphaMedic\Rest\Models\HospitalDean.cs
	namespace 	
Rest
 
. 
Models 
{ 
public

 

class

 
HospitalDean

 
{ 
} 
} ˇ
6H:\AlphaMedic\AlphaMedic\Rest\Models\MedicalHistory.cs
	namespace 	
Rest
 
. 
Models 
{ 
public		 

class		 
MedicalHistory		 
{

 
public 
MedicalHistory 
( 
) 
{ 	

Procedures 
= 
new 
List !
<! "
	Procedure" +
>+ ,
(, -
)- .
;. /
WarningLabels 
= 
new 
List  $
<$ %
WarningLabel% 1
>1 2
(2 3
)3 4
;4 5
} 	
[ 	
Key	 
, 

ForeignKey 
( 
$str !
)! "
]" #
public 
int 
MedicalHistoryId #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
virtual 
Patient 
Patient &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
virtual 
ICollection "
<" #
WarningLabel# /
>/ 0
WarningLabels1 >
{? @
getA D
;D E
setF I
;I J
}K L
public 
virtual 
ICollection "
<" #
	Procedure# ,
>, -

Procedures. 8
{9 :
get; >
;> ?
set@ C
;C D
}E F
} 
} ≤
2H:\AlphaMedic\AlphaMedic\Rest\Models\Medication.cs
	namespace 	
Rest
 
. 
Models 
{ 
public 

class 

Medication 
{ 
public

 

Medication

 
(

 
)

 
{ 	
this 
. 

Treatments 
= 
new !
List" &
<& '
	Treatment' 0
>0 1
(1 2
)2 3
;3 4
} 	
[ 	
Key	 
, 
DatabaseGenerated 
(  #
DatabaseGeneratedOption  7
.7 8
Identity8 @
)@ A
]A B
public 
int 
MedicationId 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
decimal 
Price 
{ 
get "
;" #
set$ '
;' (
}) *
public 
virtual 
ICollection "
<" #
	Treatment# ,
>, -

Treatments. 8
{9 :
get; >
;> ?
set@ C
;C D
}E F
} 
} ò
=H:\AlphaMedic\AlphaMedic\Rest\Models\MobileAuthentificator.cs
	namespace 	
Rest
 
. 
Models 
{ 
public		 

class		 !
MobileAuthentificator		 &
{

 
[ 	
Key	 
] 
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
public 
bool 
? 
	IsUseAuth 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
	MacAdress 
{  !
get" %
;% &
set' *
;* +
}, -
} 
} ⁄
/H:\AlphaMedic\AlphaMedic\Rest\Models\Patient.cs
	namespace 	
Rest
 
. 
Models 
{		 
[

 
Table

 

(


 
$str

 
)

 
]

 
public 

class 
Patient 
: 
User 
{ 
public 
Patient 
( 
) 
{ 	
Appointments 
= 
new 
List #
<# $
Appointment$ /
>/ 0
(0 1
)1 2
;2 3
	Feedbacks 
= 
new 
List  
<  !
Feedback! )
>) *
(* +
)+ ,
;, -
} 	
public 
int 
? 
MedicalHistoryId $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
int 
? 
BloodGroupId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
virtual 
MedicalHistory %
MedicalHistory& 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
public 
virtual 

BloodGroup !

BloodGroup" ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
public 
virtual 
ICollection "
<" #
Appointment# .
>. /
Appointments0 <
{= >
get? B
;B C
setD G
;G H
}I J
public 
virtual 
ICollection "
<" #
Feedback# +
>+ ,
	Feedbacks- 6
{7 8
get9 <
;< =
set> A
;A B
}C D
[ 	
	NotMapped	 
] 
public 
string 
FullName 
{  
get! $
{% &
return' -
this. 2
.2 3
Name3 7
+8 9
$str: =
+> ?
this@ D
.D E
SurnameE L
;L M
}N O
}P Q
} 
}   Ω
1H:\AlphaMedic\AlphaMedic\Rest\Models\Procedure.cs
	namespace 	
Rest
 
. 
Models 
{ 
[ 
Table 

(
 
$str 
) 
] 
public		 

abstract		 
class		 
	Procedure		 #
{

 
[ 	
Key	 
, 

ForeignKey 
( 
$str &
)& '
]' (
public 
int 
? 
ProcedureId 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
int 
? 
MedicalHistoryId $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
DateTime 
Date 
{ 
get "
;" #
set$ '
;' (
}) *
public 
decimal 
? 
Price 
{ 
get  #
;# $
set% (
;( )
}* +
public 
virtual 
MedicalHistory %
MedicalHistory& 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
public 
virtual 
Appointment "
Appointment# .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
} 
} ˇ
4H:\AlphaMedic\AlphaMedic\Rest\Models\Reseptionist.cs
	namespace 	
Rest
 
. 
Models 
{ 
[		 
Table		 

(		
 
$str		 
)		 
]		 
public

 

class

 
Receptionist

 
:

 
Employee

 '
{ 
} 
} Ÿ
0H:\AlphaMedic\AlphaMedic\Rest\Models\Schedule.cs
	namespace 	
Rest
 
. 
Models 
{ 
public 

class 
Schedule 
{		 
public

 
int

 

ScheduleId

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
public 
TimeSpan 
StartWorkingTime (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
TimeSpan 
FinishWorkingTime )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
} 
} ´
-H:\AlphaMedic\AlphaMedic\Rest\Models\Tools.cs
	namespace 	
Rest
 
. 
Models 
{ 
public		 

static		 
class		 
Tools		 
{

 
public 
static 
bool 
AnyRole !
(! "

IPrincipal" ,
user- 1
,1 2
List2 6
<6 7
string7 =
>= >
roles? D
)D E
{ 	
foreach 
( 
var 
r 
in 
roles "
)" #
{ 
if 
( 
user 
. 
IsInRole !
(! "
r" #
)# $
)$ %
return& ,
true- 1
;1 2
} 
return 
false 
; 
} 	
} 
} ò
1H:\AlphaMedic\AlphaMedic\Rest\Models\Treatment.cs
	namespace 	
Rest
 
. 
Models 
{ 
[		 
Table		 

(		
 
$str		 
)		 
]		 
public

 

class

 
	Treatment

 
:

 
	Procedure

 &
{ 
public 
	Treatment 
( 
) 
{ 	
Medications 
= 
new 
List "
<" #

Medication# -
>- .
(. /
)/ 0
;0 1
} 	
public 
string 
Result 
{ 
get "
;" #
set$ '
;' (
}) *
public 
virtual 
ICollection "
<" #

Medication# -
>- .
Medications/ :
{; <
get= @
;@ A
setB E
;E F
}G H
} 
} £
,H:\AlphaMedic\AlphaMedic\Rest\Models\User.cs
	namespace 	
Rest
 
. 
Models 
{		 
public 

enum 

GenderType 
{ 
Male 
, 
Female 
} 
public 

abstract 
class 
User 
{ 
[ 	
Key	 
, 
DatabaseGenerated 
(  #
DatabaseGeneratedOption  7
.7 8
Identity8 @
)@ A
]A B
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
[ 	
Required	 
] 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
Required	 
] 
public 
string 
Surname 
{ 
get  #
;# $
set% (
;( )
}* +
public 

GenderType 
Gender  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
DateTime 
? 
DateOfBirth $
{% &
get' *
;* +
set, /
;/ 0
}1 2
[ 	

ForeignKey	 
( 
$str 
)  
]  !
public 
int 
UserClaimId 
{  
get! $
;$ %
set& )
;) *
}+ ,
[!! 
Required!! 
]!! 
public"" 
string"" 
Phone"" 
{"" 
get"" !
;""! "
set""# &
;""& '
}""( )
[%% 	
DisplayFormat%%	 
(%% $
ConvertEmptyStringToNull%% /
=%%0 1
false%%2 7
)%%7 8
]%%8 9
public&& 
string&& 
Address&& 
{&& 
get&&  #
;&&# $
set&&% (
;&&( )
}&&* +
[(( 	
DataType((	 
((( 
DataType(( 
.(( 
EmailAddress(( '
)((' (
]((( )
[)) 	
Required))	 
])) 
public** 
string** 
Email** 
{** 
get** !
;**! "
set**# &
;**& '
}**( )
[++ 	
Required++	 
]++ 
public,, 
string,, 
Password,, 
{,,  
get,,! $
;,,$ %
set,,& )
;,,) *
},,+ ,
public.. 
bool.. 
?.. 
Active.. 
{.. 
get.. !
;..! "
set..# &
;..& '
}..( )
[00 	
DisplayFormat00	 
(00 $
ConvertEmptyStringToNull00 /
=000 1
false002 7
)007 8
]008 9
public11 
string11 
URLImage11 
{11  
get11! $
;11$ %
set11& )
;11) *
}11+ ,
public33 
virtual33 
	UserClaim33  
	UserClaim33! *
{33+ ,
get33- 0
;330 1
set332 5
;335 6
}337 8
}44 
}55 í

1H:\AlphaMedic\AlphaMedic\Rest\Models\UserClaim.cs
	namespace 	
Rest
 
. 
Models 
{		 
public

 

class

 
	UserClaim

 
{ 
public 
	UserClaim 
( 
) 
{ 	
Users 
= 
new 
List 
< 
User !
>! "
(" #
)# $
;$ %
} 	
[ 	
Key	 
] 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
	ClaimType 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 

ClaimValue  
{! "
get# &
;& '
set( +
;+ ,
}- .
[ 	

JsonIgnore	 
] 
public 
virtual 
ICollection "
<" #
User# '
>' (
Users) .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
} 
} ˛
3H:\AlphaMedic\AlphaMedic\Rest\Models\Vaccination.cs
	namespace 	
Rest
 
. 
Models 
{ 
[		 
Table		 

(		
 
$str		 
)		 
]		 
public

 

class

 
Vaccination

 
:

 
	Procedure

 (
{ 
} 
} ‹
4H:\AlphaMedic\AlphaMedic\Rest\Models\WarningLabel.cs
	namespace 	
Rest
 
. 
Models 
{ 
public 

class 
WarningLabel 
{ 
[ 	
Key	 
, 
DatabaseGenerated 
(  #
DatabaseGeneratedOption  7
.7 8
Identity8 @
)@ A
]A B
public		 
int		 
WarningLabelId		 !
{		" #
get		$ '
;		' (
set		) ,
;		, -
}		. /
public

 
int

 
MedicalHistoryId

 #
{

$ %
get

& )
;

) *
set

+ .
;

. /
}

0 1
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
virtual 
MedicalHistory %
MedicalHistory& 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
} 
} ‹y
SH:\AlphaMedic\AlphaMedic\Rest\OAuthServerProvider\ApplicationOAuthServerProvider.cs
	namespace 	
Rest
 
. 
OAuthServerProvider "
{ 
public 

class *
ApplicationOAuthServerProvider /
:0 1,
 OAuthAuthorizationServerProvider (
{ 
private 

HttpClient 
client !
;! "
private 
string 
urlParameters $
=% &
$str' 1
;1 2
public *
ApplicationOAuthServerProvider -
(- .
). /
{ 	
client 
= 
new 

HttpClient #
(# $
)$ %
;% &
client 
. 
BaseAddress 
=  
new! $
Uri% (
(( )
$str) D
)D E
;E F
client 
. !
DefaultRequestHeaders (
.( )
Accept) /
./ 0
Add0 3
(3 4
new +
MediaTypeWithQualityHeaderValue /
(/ 0
$str0 B
)B C
)C D
;D E
} 	
private   
class   
TimeResponce   "
{!! 	
public"" 
string"" 

dateString"" $
{""% &
get""' *
;""* +
set"", /
;""/ 0
}""1 2
}## 	
private&& 
string&& 
getchar&& 
(&& 
long&& #
number&&$ *
)&&* +
{'' 	
var(( 
a(( 
=(( 
number(( 
%(( 
$num(( 
;((  
if)) 
()) 
a)) 
<)) 
$num)) 
))) 
{** 
return++ 
a++ 
.++ 
ToString++ !
(++! "
)++" #
;++# $
},, 
switch-- 
(-- 
a-- 
)-- 
{.. 
case// 
$num// 
:// 
return// 
$str//  #
;//# $
case00 
$num00 
:00 
return00 
$str00  #
;00# $
case11 
$num11 
:11 
return11 
$str11  #
;11# $
case22 
$num22 
:22 
return22 
$str22  #
;22# $
case33 
$num33 
:33 
return33 
$str33  #
;33# $
case44 
$num44 
:44 
return44 
$str44  #
;44# $
}55 
return66 
string66 
.66 
Empty66 
;66  
}77 	
private99 
string99 
hash99 
(99 
long99  
number99! '
)99' (
{:: 	
var;; 
res;; 
=;; 
string;; 
.;; 
Empty;; "
;;;" #
long<< 
rest<< 
=<< 
number<< 
;<< 
for== 
(== 
var== 
i== 
=== 
$num== 
;== 
i== 
<== 
$num==  !
;==! "
i==# $
++==$ &
)==& '
{>> 
var?? 
a?? 
=?? 
rest?? 
/?? 
(??  
long??  $
)??$ %
Math??% )
.??) *
Pow??* -
(??- .
$num??. 0
,??0 1
$num??2 3
-??4 5
i??6 7
)??7 8
;??8 9
rest@@ 
=@@ 
rest@@ 
%@@ 
(@@ 
long@@ #
)@@# $
Math@@$ (
.@@( )
Pow@@) ,
(@@, -
$num@@- /
,@@/ 0
$num@@1 2
-@@3 4
i@@5 6
)@@6 7
;@@7 8
resAA 
+=AA 
getcharAA 
(AA 
aAA  
)AA  !
;AA! "
}BB 
returnCC 
resCC 
;CC 
}DD 	
publicGG 
overrideGG 
asyncGG 
TaskGG "(
ValidateClientAuthenticationGG# ?
(GG? @4
(OAuthValidateClientAuthenticationContextHH 4
contextHH5 <
)HH< =
{II 	
stringJJ 
keyJJ 
;JJ 
varKK 
userNameKK 
=KK 
contextKK "
.KK" #

ParametersKK# -
.KK- .
GetKK. 1
(KK1 2
$strKK2 <
)KK< =
;KK= >
varLL 
userProviderLL 
=LL 
newLL "
UserProviderLL# /
(LL/ 0
newLL0 3
ModelsLL4 :
.LL: ;
AlphaMedicContextLL; L
.LLL M
AlphaMedicContextLLM ^
(LL^ _
)LL_ `
)LL` a
;LLa b
varMM 
userMM 
=MM 
awaitMM 
userProviderMM )
.MM) *
FindByEmailAsyncMM* :
(MM: ;
userNameMM; C
)MMC D
;MMD E
varNN 
mAuthNN 
=NN 
awaitNN 
userProviderNN *
.NN* +
FindMAuthByIdAsyncNN+ =
(NN= >
userNN> B
.NNB C
UserIdNNC I
)NNI J
;NNJ K
tryOO 
{PP 
keyQQ 
=QQ 
contextQQ 
.QQ 

ParametersQQ (
.QQ( )
GetQQ) ,
(QQ, -
$strQQ- 5
)QQ5 6
;QQ6 7
ifRR 
(RR 
keyRR 
==RR 
nullRR 
)RR  
throwRR! &
newRR' *
	ExceptionRR+ 4
(RR4 5
)RR5 6
;RR6 7
}SS 
catchTT 
(TT 
	ExceptionTT 
)TT 
{UU 
contextVV 
.VV 
SetErrorVV  
(VV  !
$strWW #
,WW# $
$strXX 1
)YY 
;YY 
contextZZ 
.ZZ 
RejectedZZ  
(ZZ  !
)ZZ! "
;ZZ" #
return[[ 
;[[ 
}\\ 
switch]] 
(]] 
key]] 
)]] 
{^^ 
case__ 
$str__ 
:__ 
{`` 
ifaa 
(aa 
mAuthaa !
==aa" $
nullaa% )
||aa) +
(aa, -
boolaa- 1
)aa1 2
!aa2 3
mAuthaa3 8
.aa8 9
	IsUseAuthaa9 B
)aaB C
{bb 
awaitcc !
Taskcc" &
.cc& '

FromResultcc' 1
(cc1 2
contextcc2 9
.cc9 :
	Validatedcc: C
(ccC D
)ccD E
)ccE F
;ccF G
returndd "
;dd" #
}ee 
elseff 
{gg 
varhh 
machh  #
=hh$ %
longhh& *
.hh* +
Parsehh+ 0
(hh0 1
mAuthhh1 6
.hh6 7
	MacAdresshh7 @
)hh@ A
;hhA B
varii 
currentMinuteii  -
=ii. /
DateTimeii0 8
.ii8 9
Parseii9 >
(ii> ?
DateTimeii? G
.iiG H
NowiiH K
.iiK L
ToStringiiL T
(iiT U
$striiU X
)iiX Y
)iiY Z
.iiZ [
Ticksii[ `
;ii` a
varkk 
hashkk  $
=kk% &
thiskk' +
.kk+ ,
hashkk, 0
(kk0 1
currentMinutekk1 >
/kk? @
mackkA D
)kkD E
;kkE F
ifll 
(ll  
hashll  $
==ll% '
contextll( /
.ll/ 0

Parametersll0 :
.ll: ;
Getll; >
(ll> ?
$strll? E
)llE F
)llF G
{mm 
awaitnn  %
Tasknn& *
.nn* +

FromResultnn+ 5
(nn5 6
contextnn6 =
.nn= >
	Validatednn> G
(nnG H
)nnH I
)nnI J
;nnJ K
returnoo  &
;oo& '
}pp 
elseqq  
{rr 
contextss  '
.ss' (
SetErrorss( 0
(ss0 1
$strtt$ 3
,tt3 4
$struu$ J
)vv$ %
;vv% &
contextww  '
.ww' (
Rejectedww( 0
(ww0 1
)ww1 2
;ww2 3
returnxx  &
;xx& '
}yy 
}zz 
}{{ 
case|| 
$str|| 
:|| 
{}} 
if~~ 
(~~ 
mAuth~~ !
==~~" $
null~~% )
)~~) *
{ 
try
ÄÄ 
{
ÅÅ 
var
ÇÇ  #
	macAdress
ÇÇ$ -
=
ÇÇ. /
context
ÇÇ0 7
.
ÇÇ7 8

Parameters
ÇÇ8 B
.
ÇÇB C
Get
ÇÇC F
(
ÇÇF G
$str
ÇÇG L
)
ÇÇL M
;
ÇÇM N
if
ÉÉ  "
(
ÉÉ# $
	macAdress
ÉÉ$ -
==
ÉÉ. 0
null
ÉÉ1 5
)
ÉÉ5 6
throw
ÑÑ$ )
new
ÑÑ* -
	Exception
ÑÑ. 7
(
ÑÑ7 8
)
ÑÑ8 9
;
ÑÑ9 :
await
ÜÜ  %
userProvider
ÜÜ& 2
.
ÜÜ2 3+
AddMobileAuthentificatorAsync
ÜÜ3 P
(
ÜÜP Q
new
áá$ '#
MobileAuthentificator
áá( =
{
àà$ %
UserId
ââ( .
=
ââ/ 0
user
ââ1 5
.
ââ5 6
UserId
ââ6 <
,
ââ< =
	IsUseAuth
ää( 1
=
ää2 3
false
ää4 9
,
ää9 :
	MacAdress
ãã( 1
=
ãã2 3
	macAdress
ãã4 =
}
åå$ %
)
çç$ %
;
çç% &
await
éé  %
Task
éé& *
.
éé* +

FromResult
éé+ 5
(
éé5 6
context
éé6 =
.
éé= >
	Validated
éé> G
(
ééG H
)
ééH I
)
ééI J
;
ééJ K
return
èè  &
;
èè& '
}
êê 
catch
ëë !
(
ëë" #
	Exception
ëë# ,
)
ëë, -
{
íí 
context
ìì  '
.
ìì' (
SetError
ìì( 0
(
ìì0 1
$str
îî$ 3
,
îî3 4
$str
ïï$ >
)
ññ  !
;
ññ! "
context
óó  '
.
óó' (
Rejected
óó( 0
(
óó0 1
)
óó1 2
;
óó2 3
return
òò  &
;
òò& '
}
ôô 
}
öö 
break
õõ 
;
õõ 
}
úú 
await
ùù 
Task
ùù 
.
ùù 

FromResult
ùù )
(
ùù) *
context
ùù* 1
.
ùù1 2
	Validated
ùù2 ;
(
ùù; <
)
ùù< =
)
ùù= >
;
ùù> ?
}
ûû !
HttpResponseMessage
†† 
result
††  &
=
††' (
client
††) /
.
††/ 0
GetAsync
††0 8
(
††8 9
urlParameters
††9 F
)
††F G
.
††G H
Result
††H N
;
††N O
if
°° 
(
°° 
result
°° 
.
°° !
IsSuccessStatusCode
°° *
)
°°* +
{
¢¢ 
TimeResponce
££ 
time
££ !
=
££" #
result
££$ *
.
££* +
Content
££+ 2
.
££2 3
ReadAsAsync
££3 >
<
££> ?
TimeResponce
££? K
>
££K L
(
££L M
)
££M N
.
££N O
Result
££O U
;
££U V
}
§§ 
await
¥¥ 
Task
¥¥ 
.
¥¥ 

FromResult
¥¥ !
(
¥¥! "
context
¥¥" )
.
¥¥) *
	Validated
¥¥* 3
(
¥¥3 4
)
¥¥4 5
)
¥¥5 6
;
¥¥6 7
}
µµ 	
public
∑∑ 
override
∑∑ 
async
∑∑ 
Task
∑∑ "+
GrantResourceOwnerCredentials
∑∑# @
(
∑∑@ A7
)OAuthGrantResourceOwnerCredentialsContext
∏∏ 5
context
∏∏6 =
)
∏∏= >
{
ππ 	
var
∫∫ 
userProvider
∫∫ 
=
∫∫ 
new
∫∫ "
UserProvider
∫∫# /
(
∫∫/ 0
new
∫∫0 3
Models
∫∫4 :
.
∫∫: ;
AlphaMedicContext
∫∫; L
.
∫∫L M
AlphaMedicContext
∫∫M ^
(
∫∫^ _
)
∫∫_ `
)
∫∫` a
;
∫∫a b
var
ªª 
user
ªª 
=
ªª 
await
ªª 
userProvider
ªª )
.
ªª) *
FindByEmailAsync
ªª* :
(
ªª: ;
context
ªª; B
.
ªªB C
UserName
ªªC K
)
ªªK L
;
ªªL M
if
ºº 
(
ºº 
user
ºº 
==
ºº 
null
ºº 
||
ºº 
user
ºº  $
.
ºº$ %
Password
ºº% -
!=
ºº. 0
context
ºº1 8
.
ºº8 9
Password
ºº9 A
||
ººB D
user
ººE I
.
ººI J
Active
ººJ P
==
ººQ S
false
ººT Y
)
ººY Z
{
ΩΩ 
context
ææ 
.
ææ 
SetError
ææ  
(
ææ  !
$str
øø #
,
øø# $
$str
¿¿ Y
)
¡¡ 
;
¡¡ 
context
¬¬ 
.
¬¬ 
Rejected
¬¬  
(
¬¬  !
)
¬¬! "
;
¬¬" #
return
√√ 
;
√√ 
}
ƒƒ 
var
«« 
identity
«« 
=
«« 
new
«« 
ClaimsIdentity
«« -
(
««- .
$str
««. 3
)
««3 4
;
««4 5
identity
»» 
.
»» 
AddClaim
»» 
(
»» 
new
»» !
Claim
»»" '
(
»»' (

ClaimTypes
»»( 2
.
»»2 3
Name
»»3 7
,
»»7 8
context
»»9 @
.
»»@ A
UserName
»»A I
)
»»I J
)
»»J K
;
»»K L
identity
…… 
.
…… 
AddClaim
…… 
(
…… 
new
…… !
Claim
……" '
(
……' (
$str
……( ,
,
……, -
user
……. 2
.
……2 3
UserId
……3 9
.
……9 :
ToString
……: B
(
……B C
)
……C D
)
……D E
)
……E F
;
……F G
identity
   
.
   
AddClaim
   
(
   
new
   !
Claim
  " '
(
  ' (
$str
  ( -
,
  - .
context
  / 6
.
  6 7
UserName
  7 ?
)
  ? @
)
  @ A
;
  A B
identity
ÀÀ 
.
ÀÀ 
AddClaim
ÀÀ 
(
ÀÀ 
new
ÀÀ !
Claim
ÀÀ" '
(
ÀÀ' (

ClaimTypes
ÀÀ( 2
.
ÀÀ2 3
Role
ÀÀ3 7
,
ÀÀ7 8
user
ÀÀ9 =
.
ÀÀ= >
	UserClaim
ÀÀ> G
.
ÀÀG H

ClaimValue
ÀÀH R
)
ÀÀR S
)
ÀÀS T
;
ÀÀT U
context
ŒŒ 
.
ŒŒ 
	Validated
ŒŒ 
(
ŒŒ 
identity
ŒŒ &
)
ŒŒ& '
;
ŒŒ' (
}
œœ 	
public
—— 
override
—— 
Task
—— $
GrantAuthorizationCode
—— 3
(
——3 40
"OAuthGrantAuthorizationCodeContext
——4 V
context
——W ^
)
——^ _
{
““ 	
return
‘‘ 
base
‘‘ 
.
‘‘ $
GrantAuthorizationCode
‘‘ .
(
‘‘. /
context
‘‘/ 6
)
‘‘6 7
;
‘‘7 8
}
’’ 	
}
÷÷ 
}◊◊ Ä)
AH:\AlphaMedic\AlphaMedic\Rest\OAuthServerProvider\UserProvider.cs
	namespace

 	
Rest


 
.

 
OAuthServerProvider

 "
{ 
public 

class 
UserProvider 
{ 
AlphaMedicContext 
_db 
; 
public 
UserProvider 
( 
AlphaMedicContext -
context. 5
)5 6
{ 	
_db 
= 
context 
; 
} 	
public 
async 
Task 
AddUserAsync &
(& '
User' +
user, 0
,0 1
string2 8
password9 A
)A B
{ 	
if 
( 
await 

UserExists  
(  !
user! %
)% &
)& '
{ 
throw 
new 
	Exception #
(# $
$str C
)C D
;D E
} 
_db 
. 
Users 
. 
Add 
( 
user 
) 
;  
await 
_db 
. 
SaveChangesAsync &
(& '
)' (
;( )
} 	
public   
async   
Task   
<   !
MobileAuthentificator   /
>  / 0
FindMAuthByIdAsync  1 C
(  C D
int  D G
id  H J
)  J K
{!! 	
try"" 
{## 
return$$ 
await$$ 
_db$$  
.$$  !"
MobileAuthentificators$$! 7
.$$7 8
FirstOrDefaultAsync$$8 K
($$K L
u%% 
=>%% 
u%% 
.%% 
UserId%% !
==%%" $
id%%% '
)%%' (
;%%( )
}&& 
catch'' 
('' 
	Exception'' 
)'' 
{(( 
return)) 
null)) 
;)) 
}** 
}++ 	
public-- 
async-- 
Task-- )
AddMobileAuthentificatorAsync-- 7
(--7 8!
MobileAuthentificator--8 M
mAuth--N S
)--S T
{.. 	
_db// 
.// "
MobileAuthentificators// &
.//& '
Add//' *
(//* +
mAuth//+ 0
)//0 1
;//1 2
await00 
_db00 
.00 
SaveChangesAsync00 &
(00& '
)00' (
;00( )
}11 	
public33 
async33 
Task33 
<33 
User33 
>33 
FindByEmailAsync33  0
(330 1
string331 7
email338 =
)33= >
{44 	
return55 
await55 
_db55 
.55 
Users55 "
.66 
FirstOrDefaultAsync66  
(66  !
u66! "
=>66# %
u66& '
.66' (
Email66( -
==66. 0
email661 6
)666 7
;667 8
}77 	
public:: 
async:: 
Task:: 
<:: 
User:: 
>:: 
FindByIdAsync::  -
(::- .
int::. 1
userId::2 8
)::8 9
{;; 	
return<< 
await<< 
_db<< 
.<< 
Users<< "
.== 
FirstOrDefaultAsync== $
(==$ %
u==% &
=>==' )
u==* +
.==+ ,
UserId==, 2
====3 5
userId==6 <
)==< =
;=== >
}>> 	
publicAA 
asyncAA 
TaskAA 
<AA 
boolAA 
>AA 

UserExistsAA  *
(AA* +
UserAA+ /
userAA0 4
)AA4 5
{BB 	
returnCC 
awaitCC 
_dbCC 
.CC 
UsersCC "
.DD 
AnyAsyncDD 
(DD 
uDD 
=>DD 
uDD  
.DD  !
UserIdDD! '
==DD( *
userDD+ /
.DD/ 0
UserIdDD0 6
||DD7 9
uDD: ;
.DD; <
EmailDD< A
==DDB D
userDDE I
.DDI J
EmailDDJ O
)DDO P
;DDP Q
}EE 	
publicHH 
asyncHH 
TaskHH 
AddClaimAsyncHH '
(HH' (
intHH( +
UserIdHH, 2
,HH2 3
	UserClaimHH4 =
claimHH> C
)HHC D
{II 	
varJJ 
userJJ 
=JJ 
awaitJJ 
FindByIdAsyncJJ *
(JJ* +
UserIdJJ+ 1
)JJ1 2
;JJ2 3
ifKK 
(KK 
userKK 
==KK 
nullKK 
)KK 
{LL 
throwMM 
newMM 
	ExceptionMM #
(MM# $
$strMM$ 9
)MM9 :
;MM: ;
}NN 
userOO 
.OO 
	UserClaimOO 
=OO 
claimOO  
;OO  !
awaitPP 
_dbPP 
.PP 
SaveChangesAsyncPP &
(PP& '
)PP' (
;PP( )
}QQ 	
}SS 
}TT „
8H:\AlphaMedic\AlphaMedic\Rest\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str 
)  
]  !
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str !
)! "
]" #
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
["" 
assembly"" 	
:""	 

AssemblyVersion"" 
("" 
$str"" $
)""$ %
]""% &
[## 
assembly## 	
:##	 

AssemblyFileVersion## 
(## 
$str## (
)##( )
]##) *˝
<H:\AlphaMedic\AlphaMedic\Rest\Providers\CustomJwtProvider.cs
public 
class 
CustomJwtFormat 
: 
ISecureDataFormat 0
<0 1 
AuthenticationTicket1 E
>E F
{		 
private 
readonly 
string 
_issuer #
=$ %
string& ,
., -
Empty- 2
;2 3
public 

CustomJwtFormat 
( 
string !
issuer" (
)( )
{ 
_issuer 
= 
issuer 
; 
} 
public 

string 
Protect 
(  
AuthenticationTicket .
data/ 3
)3 4
{ 
if 

( 
data 
== 
null 
) 
{ 	
throw 
new !
ArgumentNullException +
(+ ,
$str, 2
)2 3
;3 4
} 	
string 

audienceId 
=  
ConfigurationManager 0
.0 1
AppSettings1 <
[< =
$str= L
]L M
;M N
string  
symmetricKeyAsBase64 #
=$ % 
ConfigurationManager& :
.: ;
AppSettings; F
[F G
$strG Z
]Z [
;[ \
var 
keyByteArray 
= 
TextEncodings (
.( )
	Base64Url) 2
.2 3
Decode3 9
(9 : 
symmetricKeyAsBase64: N
)N O
;O P
var 

signingKey 
= 
new "
HmacSigningCredentials 3
(3 4
keyByteArray4 @
)@ A
;A B
var!! 
issued!! 
=!! 
data!! 
.!! 

Properties!! $
.!!$ %
	IssuedUtc!!% .
;!!. /
var## 
expires## 
=## 
data## 
.## 

Properties## %
.##% &

ExpiresUtc##& 0
;##0 1
var%% 
a%% 
=%% 
new%% 

JwtPayload%% 
(%% 
data%% #
.%%# $
Identity%%$ ,
.%%, -
Claims%%- 3
)%%3 4
;%%4 5
var(( 
token(( 
=(( 
new(( 
JwtSecurityToken(( (
(((( )
_issuer(() 0
,((0 1

audienceId((2 <
,((< =
data((> B
.((B C
Identity((C K
.((K L
Claims((L R
,((R S
issued((T Z
.((Z [
Value(([ `
.((` a
UtcDateTime((a l
,((l m
expires((n u
.((u v
Value((v {
.(({ |
UtcDateTime	((| á
,
((á à

signingKey
((â ì
)
((ì î
;
((î ï
var** 
handler** 
=** 
new** #
JwtSecurityTokenHandler** 1
(**1 2
)**2 3
;**3 4
var,, 
jwt,, 
=,, 
handler,, 
.,, 

WriteToken,, $
(,,$ %
token,,% *
),,* +
;,,+ ,
return.. 
jwt.. 
;.. 
}// 
public11 
 
AuthenticationTicket11 
	Unprotect11  )
(11) *
string11* 0
protectedText111 >
)11> ?
{22 
throw33 
new33 #
NotImplementedException33 )
(33) *
)33* +
;33+ ,
}44 
}55 Ì

(H:\AlphaMedic\AlphaMedic\Rest\Startup.cs
[ 
assembly 	
:	 

OwinStartup 
( 
typeof 
( 
Rest "
." #
Startup# *
)* +
)+ ,
], -
	namespace 	
Rest
 
{ 
public 

partial 
class 
Startup  
{		 
public

 
void

 
Configuration

 !
(

! "
IAppBuilder

" -
app

. 1
)

1 2
{ 	
ConfigureAuth 
( 
app 
) 
; 
} 	
private 
HttpConfiguration !
ConfigureWebApi" 1
(1 2
)2 3
{ 	
var 
config 
= 
new 
HttpConfiguration .
(. /
)/ 0
;0 1
config 
. 
Routes 
. 
MapHttpRoute &
(& '
$str 
, 
$str '
,' (
new 
{ 
id 
= 
RouteParameter )
.) *
Optional* 2
}3 4
)4 5
;5 6
return 
config 
; 
} 	
} 
}   ê	
5H:\AlphaMedic\AlphaMedic\Rest\Tests\ClosureExample.cs
	namespace 	
Rest
 
. 
Tests 
{ 
public 

class 
ClosureExample 
{		 
public

 
static

 
Func

 
<

 
string

 !
,

! "
string

" (
>

( )
Hello

* /
(

/ 0
)

0 1
{ 	
string 
previous 
= 
$str $
;$ %
Func 
< 
string 
, 
string 
>  
func! %
=& '
(( )
name) -
)- .
=>/ 1
{ 
var 
res 
= 
$str "
+# $
name% )
+* +
$str, =
+> ?
previous@ H
;H I
previous 
= 
name 
;  
return 
res 
; 
} 
; 
return 
func 
; 
} 	
} 
} 